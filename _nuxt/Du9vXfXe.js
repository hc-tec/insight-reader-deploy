import{u as Ve,e as Ss,_ as As}from"./DfW_KrGd.js";import{i as Ms,p as Es,e as oe,g as uo,f as fo,s as Kt,r as le,h as ue,j as Le,k as Ts,n as Be,l as M,m as ge,q as st,v as B,x as g,y as Ls,z as po,A as Bs,B as Is,C as Qe,D as P,E as Ke,F as Dt,G as hn,H as j,o as _,w as T,I as Y,J as ve,K as L,T as Rs,L as se,c as C,M as te,N as ie,O as go,P as it,Q as Os,b as O,a as n,d as ne,R as Yt,S as _e,U as Ps,V as Hs,t as E,W as $n,X as Xt,Y as Jt,Z as zs,$ as ye,a0 as xe,a1 as Ct,a2 as D,a3 as me,a4 as Me,_ as Se,a5 as de,a6 as js,a7 as bn,a8 as qt,u as Ds,a9 as qs}from"#entry";import{r as Ns,P as he,c as Ie,a as Vs,_ as Sn}from"./CR-T6FEM.js";import{u as U,a as pt}from"./Cd2Mrs8-.js";import{m as tt,u as Fs}from"./BWKh7jvb.js";import{_ as Nt,a as Vt}from"./Dh0Zgqt2.js";import"./C3LQ35JC.js";function Ws(e,t=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY){return Math.min(o,Math.max(t,e))}function Ue(e,t){const o=typeof e=="string"&&!t?`${e}Context`:t,s=Symbol(o);return[l=>{const i=Ms(s,l);if(i||i===null)return i;throw new Error(`Injection \`${s.toString()}\` not found. Component must be used within ${Array.isArray(e)?`one of the following components: ${e.join(", ")}`:`\`${e}\``}`)},l=>(Es(s,l),l)]}function vo(e,t,o){const s=o.originalEvent.target,r=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:o});t&&s.addEventListener(e,t,{once:!0}),s.dispatchEvent(r)}const[mo]=Ue("ConfigProvider");function Us(e,t){var o;const s=Kt();return Le(()=>{s.value=e()},{...t,flush:(o=void 0)!=null?o:"sync"}),le(s)}function $t(e){return uo()?(fo(e),!0):!1}function Gs(){const e=new Set,t=a=>{e.delete(a)};return{on:a=>{e.add(a);const l=()=>t(a);return $t(l),{off:l}},off:t,trigger:(...a)=>Promise.all(Array.from(e).map(l=>l(...a))),clear:()=>{e.clear()}}}const St=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ks=e=>typeof e<"u",Ys=Object.prototype.toString,Xs=e=>Ys.call(e)==="[object Object]",Dn=()=>{};function Js(e,t){function o(...s){return new Promise((r,a)=>{Promise.resolve(e(()=>t.apply(this,s),{fn:t,thisArg:this,args:s})).then(r).catch(a)})}return o}function Qs(e,t={}){let o,s,r=Dn;const a=v=>{clearTimeout(v),r(),r=Dn};let l;return v=>{const f=ue(e),u=ue(t.maxWait);return o&&a(o),f<=0||u!==void 0&&u<=0?(s&&(a(s),s=null),Promise.resolve(v())):new Promise((p,d)=>{r=t.rejectOnCancel?d:p,l=v,u&&!s&&(s=setTimeout(()=>{o&&a(o),s=null,p(l())},u)),o=setTimeout(()=>{s&&a(s),s=null,p(v())},f)})}}function pn(e){return Array.isArray(e)?e:[e]}function Zs(e,t=1e4){return Ts((o,s)=>{let r=ue(e),a;const l=()=>setTimeout(()=>{r=ue(e),s()},ue(t));return $t(()=>{clearTimeout(a)}),{get(){return o(),r},set(i){r=i,s(),clearTimeout(a),a=l()}}})}function ho(e,t=200,o={}){return Js(Qs(t,o),e)}const er=ue;function bo(e,t,o={}){const{immediate:s=!0,immediateCallback:r=!1}=o,a=Kt(!1);let l=null;function i(){l&&(clearTimeout(l),l=null)}function v(){a.value=!1,i()}function f(...u){r&&e(),i(),a.value=!0,l=setTimeout(()=>{a.value=!1,l=null,e(...u)},ue(t))}return s&&(a.value=!0,St&&f()),$t(v),{isPending:le(a),start:f,stop:v}}function tr(e,t,o){return oe(e,t,{...o,immediate:!0})}function nr(e,t,o){const s=oe(e,(...r)=>(Be(()=>s()),t(...r)),o);return s}const Qt=St?window:void 0;function Ye(e){var t;const o=ue(e);return(t=o?.$el)!=null?t:o}function yn(...e){const t=[],o=()=>{t.forEach(i=>i()),t.length=0},s=(i,v,f,u)=>(i.addEventListener(v,f,u),()=>i.removeEventListener(v,f,u)),r=M(()=>{const i=pn(ue(e[0])).filter(v=>v!=null);return i.every(v=>typeof v!="string")?i:void 0}),a=tr(()=>{var i,v;return[(v=(i=r.value)==null?void 0:i.map(f=>Ye(f)))!=null?v:[Qt].filter(f=>f!=null),pn(ue(r.value?e[1]:e[0])),pn(g(r.value?e[2]:e[1])),ue(r.value?e[3]:e[2])]},([i,v,f,u])=>{if(o(),!i?.length||!v?.length||!f?.length)return;const p=Xs(u)?{...u}:u;t.push(...i.flatMap(d=>v.flatMap(c=>f.map(y=>s(d,c,y,p)))))},{flush:"post"}),l=()=>{a(),o()};return $t(o),l}function yo(){const e=Kt(!1),t=st();return t&&ge(()=>{e.value=!0},t),e}function or(e){const t=yo();return M(()=>(t.value,!!e()))}function sr(e){return typeof e=="function"?e:typeof e=="string"?t=>t.key===e:Array.isArray(e)?t=>e.includes(t.key):()=>!0}function rr(...e){let t,o,s={};e.length===3?(t=e[0],o=e[1],s=e[2]):e.length===2?typeof e[1]=="object"?(t=!0,o=e[0],s=e[1]):(t=e[0],o=e[1]):(t=!0,o=e[0]);const{target:r=Qt,eventName:a="keydown",passive:l=!1,dedupe:i=!1}=s,v=sr(t);return yn(r,a,u=>{u.repeat&&ue(i)||v(u)&&o(u)},l)}function ar(e){return JSON.parse(JSON.stringify(e))}function ut(e,t,o={}){const{window:s=Qt,...r}=o;let a;const l=or(()=>s&&"ResizeObserver"in s),i=()=>{a&&(a.disconnect(),a=void 0)},v=M(()=>{const p=ue(e);return Array.isArray(p)?p.map(d=>Ye(d)):[Ye(p)]}),f=oe(v,p=>{if(i(),l.value&&s){a=new ResizeObserver(t);for(const d of p)d&&a.observe(d,r)}},{immediate:!0,flush:"post"}),u=()=>{i(),f()};return $t(u),{isSupported:l,stop:u}}function xo(e,t,o,s={}){var r,a,l;const{clone:i=!1,passive:v=!1,eventName:f,deep:u=!1,defaultValue:p,shouldEmit:d}=s,c=st(),y=o||c?.emit||((r=c?.$emit)==null?void 0:r.bind(c))||((l=(a=c?.proxy)==null?void 0:a.$emit)==null?void 0:l.bind(c?.proxy));let x=f;t||(t="modelValue"),x=x||`update:${t.toString()}`;const w=b=>i?typeof i=="function"?i(b):ar(b):b,h=()=>Ks(e[t])?w(e[t]):p,m=b=>{d?d(b)&&y(x,b):y(x,b)};if(v){const b=h(),k=B(b);let $=!1;return oe(()=>e[t],I=>{$||($=!0,k.value=w(I),Be(()=>$=!1))}),oe(k,I=>{!$&&(I!==e[t]||u)&&m(I)},{deep:u}),k}else return M({get(){return h()},set(b){m(b)}})}function lr(e){const t=mo({dir:B("ltr")});return M(()=>e?.value||t.dir?.value||"ltr")}function ir(e){const t=st(),o=t?.type.emits,s={};return o?.length||console.warn(`No emitted event found. Please check component: ${t?.type.__name}`),o?.forEach(r=>{s[Ls(po(r))]=(...a)=>e(r,...a)}),s}function cr(e){return M(()=>er(e)?!!Ye(e)?.closest("form"):!0)}function ce(){const e=st(),t=B(),o=M(()=>["#text","#comment"].includes(t.value?.$el.nodeName)?t.value?.$el.nextElementSibling:Ye(t)),s=Object.assign({},e.exposed),r={};for(const l in e.props)Object.defineProperty(r,l,{enumerable:!0,configurable:!0,get:()=>e.props[l]});if(Object.keys(s).length>0)for(const l in s)Object.defineProperty(r,l,{enumerable:!0,configurable:!0,get:()=>s[l]});Object.defineProperty(r,"$el",{enumerable:!0,configurable:!0,get:()=>e.vnode.el}),e.exposed=r;function a(l){t.value=l,l&&(Object.defineProperty(r,"$el",{enumerable:!0,configurable:!0,get:()=>l instanceof Element?l:l.$el}),e.exposed=r)}return{forwardRef:a,currentRef:t,currentElement:o}}function wo(e){const t=st(),o=Object.keys(t?.type.props??{}).reduce((r,a)=>{const l=(t?.type.props[a]).default;return l!==void 0&&(r[a]=l),r},{}),s=Bs(e);return M(()=>{const r={},a=t?.vnode.props??{};return Object.keys(a).forEach(l=>{r[po(l)]=a[l]}),Object.keys({...o,...r}).reduce((l,i)=>(s.value[i]!==void 0&&(l[i]=s.value[i]),l),{})})}function Zt(e,t){const o=wo(e),s=t?ir(t):{};return M(()=>({...o.value,...s}))}function dr(e,t){const o=Zs(!1,300),s=B(null),r=Gs();function a(){s.value=null,o.value=!1}function l(i,v){const f=i.currentTarget,u={x:i.clientX,y:i.clientY},p=ur(u,f.getBoundingClientRect()),d=fr(u,p),c=pr(v.getBoundingClientRect()),y=vr([...d,...c]);s.value=y,o.value=!0}return Le(i=>{if(e.value&&t.value){const v=u=>l(u,t.value),f=u=>l(u,e.value);e.value.addEventListener("pointerleave",v),t.value.addEventListener("pointerleave",f),i(()=>{e.value?.removeEventListener("pointerleave",v),t.value?.removeEventListener("pointerleave",f)})}}),Le(i=>{if(s.value){const v=f=>{if(!s.value||!(f.target instanceof HTMLElement))return;const u=f.target,p={x:f.clientX,y:f.clientY},d=e.value?.contains(u)||t.value?.contains(u),c=!gr(p,s.value),y=!!u.closest("[data-grace-area-trigger]");d?a():(c||y)&&(a(),r.trigger())};e.value?.ownerDocument.addEventListener("pointermove",v),i(()=>e.value?.ownerDocument.removeEventListener("pointermove",v))}}),{isPointerInTransit:o,onPointerExit:r.on}}function ur(e,t){const o=Math.abs(t.top-e.y),s=Math.abs(t.bottom-e.y),r=Math.abs(t.right-e.x),a=Math.abs(t.left-e.x);switch(Math.min(o,s,r,a)){case a:return"left";case r:return"right";case o:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function fr(e,t,o=5){const s=[];switch(t){case"top":s.push({x:e.x-o,y:e.y+o},{x:e.x+o,y:e.y+o});break;case"bottom":s.push({x:e.x-o,y:e.y-o},{x:e.x+o,y:e.y-o});break;case"left":s.push({x:e.x+o,y:e.y-o},{x:e.x+o,y:e.y+o});break;case"right":s.push({x:e.x-o,y:e.y-o},{x:e.x-o,y:e.y+o});break}return s}function pr(e){const{top:t,right:o,bottom:s,left:r}=e;return[{x:r,y:t},{x:o,y:t},{x:o,y:s},{x:r,y:s}]}function gr(e,t){const{x:o,y:s}=e;let r=!1;for(let a=0,l=t.length-1;a<t.length;l=a++){const i=t[a].x,v=t[a].y,f=t[l].x,u=t[l].y;v>s!=u>s&&o<(f-i)*(s-v)/(u-v)+i&&(r=!r)}return r}function vr(e){const t=e.slice();return t.sort((o,s)=>o.x<s.x?-1:o.x>s.x?1:o.y<s.y?-1:o.y>s.y?1:0),mr(t)}function mr(e){if(e.length<=1)return e.slice();const t=[];for(let s=0;s<e.length;s++){const r=e[s];for(;t.length>=2;){const a=t[t.length-1],l=t[t.length-2];if((a.x-l.x)*(r.y-l.y)>=(a.y-l.y)*(r.x-l.x))t.pop();else break}t.push(r)}t.pop();const o=[];for(let s=e.length-1;s>=0;s--){const r=e[s];for(;o.length>=2;){const a=o[o.length-1],l=o[o.length-2];if((a.x-l.x)*(r.y-l.y)>=(a.y-l.y)*(r.x-l.x))o.pop();else break}o.push(r)}return o.pop(),t.length===1&&o.length===1&&t[0].x===o[0].x&&t[0].y===o[0].y?t:t.concat(o)}function hr(e,t="reka"){return`${t}-${Is?.()}`}function br(e){const t=B(),o=M(()=>t.value?.width??0),s=M(()=>t.value?.height??0);return ge(()=>{const r=Ye(e);if(r){t.value={width:r.offsetWidth,height:r.offsetHeight};const a=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const i=l[0];let v,f;if("borderBoxSize"in i){const u=i.borderBoxSize,p=Array.isArray(u)?u[0]:u;v=p.inlineSize,f=p.blockSize}else v=r.offsetWidth,f=r.offsetHeight;t.value={width:v,height:f}});return a.observe(r,{box:"border-box"}),()=>a.unobserve(r)}else t.value=void 0}),{width:o,height:s}}function _o(e,t){const o=B(e);function s(a){return t[o.value][a]??o.value}return{state:o,dispatch:a=>{o.value=s(a)}}}function yr(e,t){const o=B({}),s=B("none"),r=B(e),a=e.value?"mounted":"unmounted";let l;const i=t.value?.ownerDocument.defaultView??Qt,{state:v,dispatch:f}=_o(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}}),u=w=>{if(St){const h=new CustomEvent(w,{bubbles:!1,cancelable:!1});t.value?.dispatchEvent(h)}};oe(e,async(w,h)=>{const m=h!==w;if(await Be(),m){const b=s.value,k=Bt(t.value);w?(f("MOUNT"),u("enter"),k==="none"&&u("after-enter")):k==="none"||k==="undefined"||o.value?.display==="none"?(f("UNMOUNT"),u("leave"),u("after-leave")):h&&b!==k?(f("ANIMATION_OUT"),u("leave")):(f("UNMOUNT"),u("after-leave"))}},{immediate:!0});const p=w=>{const h=Bt(t.value),m=h.includes(CSS.escape(w.animationName)),b=v.value==="mounted"?"enter":"leave";if(w.target===t.value&&m&&(u(`after-${b}`),f("ANIMATION_END"),!r.value)){const k=t.value.style.animationFillMode;t.value.style.animationFillMode="forwards",l=i?.setTimeout(()=>{t.value?.style.animationFillMode==="forwards"&&(t.value.style.animationFillMode=k)})}w.target===t.value&&h==="none"&&f("ANIMATION_END")},d=w=>{w.target===t.value&&(s.value=Bt(t.value))},c=oe(t,(w,h)=>{w?(o.value=getComputedStyle(w),w.addEventListener("animationstart",d),w.addEventListener("animationcancel",p),w.addEventListener("animationend",p)):(f("ANIMATION_END"),l!==void 0&&i?.clearTimeout(l),h?.removeEventListener("animationstart",d),h?.removeEventListener("animationcancel",p),h?.removeEventListener("animationend",p))},{immediate:!0}),y=oe(v,()=>{const w=Bt(t.value);s.value=v.value==="mounted"?w:"none"});return Qe(()=>{c(),y()}),{isPresent:M(()=>["mounted","unmountSuspended"].includes(v.value))}}function Bt(e){return e&&getComputedStyle(e).animationName||"none"}var en=P({name:"Presence",props:{present:{type:Boolean,required:!0},forceMount:{type:Boolean}},slots:{},setup(e,{slots:t,expose:o}){const{present:s,forceMount:r}=Ke(e),a=B(),{isPresent:l}=yr(s,a);o({present:l});let i=t.default({present:l.value});i=Ns(i||[]);const v=st();if(i&&i?.length>1){const f=v?.parent?.type.name?`<${v.parent.type.name} />`:"component";throw new Error([`Detected an invalid children for \`${f}\` for  \`Presence\` component.`,"","Note: Presence works similarly to `v-if` directly, but it waits for animation/transition to finished before unmounting. So it expect only one direct child of valid VNode type.","You can apply a few solutions:",["Provide a single child element so that `presence` directive attach correctly.","Ensure the first child is an actual element instead of a raw text node or comment node."].map(u=>`  - ${u}`).join(`
`)].join(`
`))}return()=>r.value||s.value||l.value?Dt(t.default({present:l.value})[0],{ref:f=>{const u=Ye(f);return typeof u?.hasAttribute>"u"||(u?.hasAttribute("data-reka-popper-content-wrapper")?a.value=u.firstElementChild:a.value=u),u}}):null}});function xr(){const e=B(),t=M(()=>["#text","#comment"].includes(e.value?.$el.nodeName)?e.value?.$el.nextElementSibling:Ye(e));return{primitiveElement:e,currentElement:t}}const wr="dismissableLayer.pointerDownOutside",_r="dismissableLayer.focusOutside";function ko(e,t){const o=t.closest("[data-dismissable-layer]"),s=e.dataset.dismissableLayer===""?e:e.querySelector("[data-dismissable-layer]"),r=Array.from(e.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(o&&(s===o||r.indexOf(s)<r.indexOf(o)))}function kr(e,t,o=!0){const s=t?.value?.ownerDocument??globalThis?.document,r=B(!1),a=B(()=>{});return Le(l=>{if(!St||!ue(o))return;const i=async f=>{const u=f.target;if(!(!t?.value||!u)){if(ko(t.value,u)){r.value=!1;return}if(f.target&&!r.value){let d=function(){vo(wr,e,p)};const p={originalEvent:f};f.pointerType==="touch"?(s.removeEventListener("click",a.value),a.value=d,s.addEventListener("click",a.value,{once:!0})):d()}else s.removeEventListener("click",a.value);r.value=!1}},v=window.setTimeout(()=>{s.addEventListener("pointerdown",i)},0);l(()=>{window.clearTimeout(v),s.removeEventListener("pointerdown",i),s.removeEventListener("click",a.value)})}),{onPointerDownCapture:()=>{ue(o)&&(r.value=!0)}}}function Cr(e,t,o=!0){const s=t?.value?.ownerDocument??globalThis?.document,r=B(!1);return Le(a=>{if(!St||!ue(o))return;const l=async i=>{if(!t?.value)return;await Be(),await Be();const v=i.target;!t.value||!v||ko(t.value,v)||i.target&&!r.value&&vo(_r,e,{originalEvent:i})};s.addEventListener("focusin",l),a(()=>s.removeEventListener("focusin",l))}),{onFocusCapture:()=>{ue(o)&&(r.value=!0)},onBlurCapture:()=>{ue(o)&&(r.value=!1)}}}const qe=hn({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set});var $r=P({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(e,{emit:t}){const o=e,s=t,{forwardRef:r,currentElement:a}=ce(),l=M(()=>a.value?.ownerDocument??globalThis.document),i=M(()=>qe.layersRoot),v=M(()=>a.value?Array.from(i.value).indexOf(a.value):-1),f=M(()=>qe.layersWithOutsidePointerEventsDisabled.size>0),u=M(()=>{const y=Array.from(i.value),[x]=[...qe.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(x);return v.value>=w}),p=kr(async y=>{const x=[...qe.branches].some(w=>w?.contains(y.target));!u.value||x||(s("pointerDownOutside",y),s("interactOutside",y),await Be(),y.defaultPrevented||s("dismiss"))},a),d=Cr(y=>{[...qe.branches].some(w=>w?.contains(y.target))||(s("focusOutside",y),s("interactOutside",y),y.defaultPrevented||s("dismiss"))},a);rr("Escape",y=>{v.value===i.value.size-1&&(s("escapeKeyDown",y),y.defaultPrevented||s("dismiss"))});let c;return Le(y=>{a.value&&(o.disableOutsidePointerEvents&&(qe.layersWithOutsidePointerEventsDisabled.size===0&&(c=l.value.body.style.pointerEvents,l.value.body.style.pointerEvents="none"),qe.layersWithOutsidePointerEventsDisabled.add(a.value)),i.value.add(a.value),y(()=>{o.disableOutsidePointerEvents&&qe.layersWithOutsidePointerEventsDisabled.size===1&&(l.value.body.style.pointerEvents=c)}))}),Le(y=>{y(()=>{a.value&&(i.value.delete(a.value),qe.layersWithOutsidePointerEventsDisabled.delete(a.value))})}),(y,x)=>(_(),j(g(he),{ref:g(r),"as-child":y.asChild,as:y.as,"data-dismissable-layer":"",style:ve({pointerEvents:f.value?u.value?"auto":"none":void 0}),onFocusCapture:g(d).onFocusCapture,onBlurCapture:g(d).onBlurCapture,onPointerdownCapture:g(p).onPointerDownCapture},{default:T(()=>[Y(y.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}}),Sr=$r,Ar=P({__name:"Teleport",props:{to:{type:null,required:!1,default:"body"},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(e){const t=yo();return(o,s)=>g(t)||o.forceMount?(_(),j(Rs,{key:0,to:o.to,disabled:o.disabled,defer:o.defer},[Y(o.$slots,"default")],8,["to","disabled","defer"])):L("v-if",!0)}}),Mr=Ar,Er=P({__name:"VisuallyHidden",props:{feature:{type:String,required:!1,default:"focusable"},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){return(t,o)=>(_(),j(g(he),{as:t.as,"as-child":t.asChild,"aria-hidden":t.feature==="focusable"?"true":void 0,"data-hidden":t.feature==="fully-hidden"?"":void 0,tabindex:t.feature==="fully-hidden"?"-1":void 0,style:{position:"absolute",border:0,width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",whiteSpace:"nowrap",wordWrap:"normal",top:"-1px",left:"-1px"}},{default:T(()=>[Y(t.$slots,"default")]),_:3},8,["as","as-child","aria-hidden","data-hidden","tabindex"]))}}),Co=Er,Tr=P({inheritAttrs:!1,__name:"VisuallyHiddenInputBubble",props:{name:{type:String,required:!0},value:{type:null,required:!0},checked:{type:Boolean,required:!1,default:void 0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},feature:{type:String,required:!1,default:"fully-hidden"}},setup(e){const t=e,{primitiveElement:o,currentElement:s}=xr(),r=M(()=>t.checked??t.value);return oe(r,(a,l)=>{if(!s.value)return;const i=s.value,v=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(v,"value").set;if(u&&a!==l){const p=new Event("input",{bubbles:!0}),d=new Event("change",{bubbles:!0});u.call(i,a),i.dispatchEvent(p),i.dispatchEvent(d)}}),(a,l)=>(_(),j(Co,se({ref_key:"primitiveElement",ref:o},{...t,...a.$attrs},{as:"input"}),null,16))}}),qn=Tr,Lr=P({inheritAttrs:!1,__name:"VisuallyHiddenInput",props:{name:{type:String,required:!0},value:{type:null,required:!0},checked:{type:Boolean,required:!1,default:void 0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},feature:{type:String,required:!1,default:"fully-hidden"}},setup(e){const t=e,o=M(()=>typeof t.value=="object"&&Array.isArray(t.value)&&t.value.length===0&&t.required),s=M(()=>typeof t.value=="string"||typeof t.value=="number"||typeof t.value=="boolean"||t.value===null||t.value===void 0?[{name:t.name,value:t.value}]:typeof t.value=="object"&&Array.isArray(t.value)?t.value.flatMap((r,a)=>typeof r=="object"?Object.entries(r).map(([l,i])=>({name:`${t.name}[${a}][${l}]`,value:i})):{name:`${t.name}[${a}]`,value:r}):t.value!==null&&typeof t.value=="object"&&!Array.isArray(t.value)?Object.entries(t.value).map(([r,a])=>({name:`${t.name}[${r}]`,value:a})):[]);return(r,a)=>(_(),C(te,null,[L(" We render single input if it's required "),o.value?(_(),j(qn,se({key:r.name},{...t,...r.$attrs},{name:r.name,value:r.value}),null,16,["name","value"])):(_(!0),C(te,{key:1},ie(s.value,l=>(_(),j(qn,se({key:l.name},{ref_for:!0},{...t,...r.$attrs},{name:l.name,value:l.value}),null,16,["name","value"]))),128))],2112))}}),Br=Lr;const[$o,Ir]=Ue("PopperRoot");var Rr=P({inheritAttrs:!1,__name:"PopperRoot",setup(e){const t=B();return Ir({anchor:t,onAnchorChange:o=>t.value=o}),(o,s)=>Y(o.$slots,"default")}}),Or=Rr,Pr=P({__name:"PopperAnchor",props:{reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const t=e,{forwardRef:o,currentElement:s}=ce(),r=$o();return go(()=>{r.onAnchorChange(t.reference??s.value)}),(a,l)=>(_(),j(g(he),{ref:g(o),as:a.as,"as-child":a.asChild},{default:T(()=>[Y(a.$slots,"default")]),_:3},8,["as","as-child"]))}}),Hr=Pr;function zr(e){return e!==null}function jr(e){return{name:"transformOrigin",options:e,fn(t){const{placement:o,rects:s,middlewareData:r}=t,l=r.arrow?.centerOffset!==0,i=l?0:e.arrowWidth,v=l?0:e.arrowHeight,[f,u]=xn(o),p={start:"0%",center:"50%",end:"100%"}[u],d=(r.arrow?.x??0)+i/2,c=(r.arrow?.y??0)+v/2;let y="",x="";return f==="bottom"?(y=l?p:`${d}px`,x=`${-v}px`):f==="top"?(y=l?p:`${d}px`,x=`${s.floating.height+v}px`):f==="right"?(y=`${-v}px`,x=l?p:`${c}px`):f==="left"&&(y=`${s.floating.width+v}px`,x=l?p:`${c}px`),{data:{x:y,y:x}}}}}function xn(e){const[t,o="center"]=e.split("-");return[t,o]}const Dr=["top","right","bottom","left"],Xe=Math.min,be=Math.max,Ft=Math.round,It=Math.floor,Te=e=>({x:e,y:e}),qr={left:"right",right:"left",bottom:"top",top:"bottom"},Nr={start:"end",end:"start"};function wn(e,t,o){return be(e,Xe(t,o))}function Fe(e,t){return typeof e=="function"?e(t):e}function We(e){return e.split("-")[0]}function gt(e){return e.split("-")[1]}function An(e){return e==="x"?"y":"x"}function Mn(e){return e==="y"?"height":"width"}const Vr=new Set(["top","bottom"]);function Ee(e){return Vr.has(We(e))?"y":"x"}function En(e){return An(Ee(e))}function Fr(e,t,o){o===void 0&&(o=!1);const s=gt(e),r=En(e),a=Mn(r);let l=r==="x"?s===(o?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[a]>t.floating[a]&&(l=Wt(l)),[l,Wt(l)]}function Wr(e){const t=Wt(e);return[_n(e),t,_n(t)]}function _n(e){return e.replace(/start|end/g,t=>Nr[t])}const Nn=["left","right"],Vn=["right","left"],Ur=["top","bottom"],Gr=["bottom","top"];function Kr(e,t,o){switch(e){case"top":case"bottom":return o?t?Vn:Nn:t?Nn:Vn;case"left":case"right":return t?Ur:Gr;default:return[]}}function Yr(e,t,o,s){const r=gt(e);let a=Kr(We(e),o==="start",s);return r&&(a=a.map(l=>l+"-"+r),t&&(a=a.concat(a.map(_n)))),a}function Wt(e){return e.replace(/left|right|bottom|top/g,t=>qr[t])}function Xr(e){return{top:0,right:0,bottom:0,left:0,...e}}function So(e){return typeof e!="number"?Xr(e):{top:e,right:e,bottom:e,left:e}}function Ut(e){const{x:t,y:o,width:s,height:r}=e;return{width:s,height:r,top:o,left:t,right:t+s,bottom:o+r,x:t,y:o}}function Fn(e,t,o){let{reference:s,floating:r}=e;const a=Ee(t),l=En(t),i=Mn(l),v=We(t),f=a==="y",u=s.x+s.width/2-r.width/2,p=s.y+s.height/2-r.height/2,d=s[i]/2-r[i]/2;let c;switch(v){case"top":c={x:u,y:s.y-r.height};break;case"bottom":c={x:u,y:s.y+s.height};break;case"right":c={x:s.x+s.width,y:p};break;case"left":c={x:s.x-r.width,y:p};break;default:c={x:s.x,y:s.y}}switch(gt(t)){case"start":c[l]-=d*(o&&f?-1:1);break;case"end":c[l]+=d*(o&&f?-1:1);break}return c}const Jr=async(e,t,o)=>{const{placement:s="bottom",strategy:r="absolute",middleware:a=[],platform:l}=o,i=a.filter(Boolean),v=await(l.isRTL==null?void 0:l.isRTL(t));let f=await l.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:p}=Fn(f,s,v),d=s,c={},y=0;for(let x=0;x<i.length;x++){const{name:w,fn:h}=i[x],{x:m,y:b,data:k,reset:$}=await h({x:u,y:p,initialPlacement:s,placement:d,strategy:r,middlewareData:c,rects:f,platform:l,elements:{reference:e,floating:t}});u=m??u,p=b??p,c={...c,[w]:{...c[w],...k}},$&&y<=50&&(y++,typeof $=="object"&&($.placement&&(d=$.placement),$.rects&&(f=$.rects===!0?await l.getElementRects({reference:e,floating:t,strategy:r}):$.rects),{x:u,y:p}=Fn(f,d,v)),x=-1)}return{x:u,y:p,placement:d,strategy:r,middlewareData:c}};async function _t(e,t){var o;t===void 0&&(t={});const{x:s,y:r,platform:a,rects:l,elements:i,strategy:v}=e,{boundary:f="clippingAncestors",rootBoundary:u="viewport",elementContext:p="floating",altBoundary:d=!1,padding:c=0}=Fe(t,e),y=So(c),w=i[d?p==="floating"?"reference":"floating":p],h=Ut(await a.getClippingRect({element:(o=await(a.isElement==null?void 0:a.isElement(w)))==null||o?w:w.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(i.floating)),boundary:f,rootBoundary:u,strategy:v})),m=p==="floating"?{x:s,y:r,width:l.floating.width,height:l.floating.height}:l.reference,b=await(a.getOffsetParent==null?void 0:a.getOffsetParent(i.floating)),k=await(a.isElement==null?void 0:a.isElement(b))?await(a.getScale==null?void 0:a.getScale(b))||{x:1,y:1}:{x:1,y:1},$=Ut(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:m,offsetParent:b,strategy:v}):m);return{top:(h.top-$.top+y.top)/k.y,bottom:($.bottom-h.bottom+y.bottom)/k.y,left:(h.left-$.left+y.left)/k.x,right:($.right-h.right+y.right)/k.x}}const Qr=e=>({name:"arrow",options:e,async fn(t){const{x:o,y:s,placement:r,rects:a,platform:l,elements:i,middlewareData:v}=t,{element:f,padding:u=0}=Fe(e,t)||{};if(f==null)return{};const p=So(u),d={x:o,y:s},c=En(r),y=Mn(c),x=await l.getDimensions(f),w=c==="y",h=w?"top":"left",m=w?"bottom":"right",b=w?"clientHeight":"clientWidth",k=a.reference[y]+a.reference[c]-d[c]-a.floating[y],$=d[c]-a.reference[c],I=await(l.getOffsetParent==null?void 0:l.getOffsetParent(f));let S=I?I[b]:0;(!S||!await(l.isElement==null?void 0:l.isElement(I)))&&(S=i.floating[b]||a.floating[y]);const A=k/2-$/2,R=S/2-x[y]/2-1,V=Xe(p[h],R),G=Xe(p[m],R),F=V,Q=S-x[y]-G,K=S/2-x[y]/2+A,ee=wn(F,K,Q),W=!v.arrow&&gt(r)!=null&&K!==ee&&a.reference[y]/2-(K<F?V:G)-x[y]/2<0,z=W?K<F?K-F:K-Q:0;return{[c]:d[c]+z,data:{[c]:ee,centerOffset:K-ee-z,...W&&{alignmentOffset:z}},reset:W}}}),Zr=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var o,s;const{placement:r,middlewareData:a,rects:l,initialPlacement:i,platform:v,elements:f}=t,{mainAxis:u=!0,crossAxis:p=!0,fallbackPlacements:d,fallbackStrategy:c="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:x=!0,...w}=Fe(e,t);if((o=a.arrow)!=null&&o.alignmentOffset)return{};const h=We(r),m=Ee(i),b=We(i)===i,k=await(v.isRTL==null?void 0:v.isRTL(f.floating)),$=d||(b||!x?[Wt(i)]:Wr(i)),I=y!=="none";!d&&I&&$.push(...Yr(i,x,y,k));const S=[i,...$],A=await _t(t,w),R=[];let V=((s=a.flip)==null?void 0:s.overflows)||[];if(u&&R.push(A[h]),p){const K=Fr(r,l,k);R.push(A[K[0]],A[K[1]])}if(V=[...V,{placement:r,overflows:R}],!R.every(K=>K<=0)){var G,F;const K=(((G=a.flip)==null?void 0:G.index)||0)+1,ee=S[K];if(ee&&(!(p==="alignment"?m!==Ee(ee):!1)||V.every(q=>Ee(q.placement)===m?q.overflows[0]>0:!0)))return{data:{index:K,overflows:V},reset:{placement:ee}};let W=(F=V.filter(z=>z.overflows[0]<=0).sort((z,q)=>z.overflows[1]-q.overflows[1])[0])==null?void 0:F.placement;if(!W)switch(c){case"bestFit":{var Q;const z=(Q=V.filter(q=>{if(I){const Z=Ee(q.placement);return Z===m||Z==="y"}return!0}).map(q=>[q.placement,q.overflows.filter(Z=>Z>0).reduce((Z,J)=>Z+J,0)]).sort((q,Z)=>q[1]-Z[1])[0])==null?void 0:Q[0];z&&(W=z);break}case"initialPlacement":W=i;break}if(r!==W)return{reset:{placement:W}}}return{}}}};function Wn(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Un(e){return Dr.some(t=>e[t]>=0)}const ea=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:o}=t,{strategy:s="referenceHidden",...r}=Fe(e,t);switch(s){case"referenceHidden":{const a=await _t(t,{...r,elementContext:"reference"}),l=Wn(a,o.reference);return{data:{referenceHiddenOffsets:l,referenceHidden:Un(l)}}}case"escaped":{const a=await _t(t,{...r,altBoundary:!0}),l=Wn(a,o.floating);return{data:{escapedOffsets:l,escaped:Un(l)}}}default:return{}}}}},Ao=new Set(["left","top"]);async function ta(e,t){const{placement:o,platform:s,elements:r}=e,a=await(s.isRTL==null?void 0:s.isRTL(r.floating)),l=We(o),i=gt(o),v=Ee(o)==="y",f=Ao.has(l)?-1:1,u=a&&v?-1:1,p=Fe(t,e);let{mainAxis:d,crossAxis:c,alignmentAxis:y}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return i&&typeof y=="number"&&(c=i==="end"?y*-1:y),v?{x:c*u,y:d*f}:{x:d*f,y:c*u}}const na=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var o,s;const{x:r,y:a,placement:l,middlewareData:i}=t,v=await ta(t,e);return l===((o=i.offset)==null?void 0:o.placement)&&(s=i.arrow)!=null&&s.alignmentOffset?{}:{x:r+v.x,y:a+v.y,data:{...v,placement:l}}}}},oa=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:o,y:s,placement:r}=t,{mainAxis:a=!0,crossAxis:l=!1,limiter:i={fn:w=>{let{x:h,y:m}=w;return{x:h,y:m}}},...v}=Fe(e,t),f={x:o,y:s},u=await _t(t,v),p=Ee(We(r)),d=An(p);let c=f[d],y=f[p];if(a){const w=d==="y"?"top":"left",h=d==="y"?"bottom":"right",m=c+u[w],b=c-u[h];c=wn(m,c,b)}if(l){const w=p==="y"?"top":"left",h=p==="y"?"bottom":"right",m=y+u[w],b=y-u[h];y=wn(m,y,b)}const x=i.fn({...t,[d]:c,[p]:y});return{...x,data:{x:x.x-o,y:x.y-s,enabled:{[d]:a,[p]:l}}}}}},sa=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:o,y:s,placement:r,rects:a,middlewareData:l}=t,{offset:i=0,mainAxis:v=!0,crossAxis:f=!0}=Fe(e,t),u={x:o,y:s},p=Ee(r),d=An(p);let c=u[d],y=u[p];const x=Fe(i,t),w=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(v){const b=d==="y"?"height":"width",k=a.reference[d]-a.floating[b]+w.mainAxis,$=a.reference[d]+a.reference[b]-w.mainAxis;c<k?c=k:c>$&&(c=$)}if(f){var h,m;const b=d==="y"?"width":"height",k=Ao.has(We(r)),$=a.reference[p]-a.floating[b]+(k&&((h=l.offset)==null?void 0:h[p])||0)+(k?0:w.crossAxis),I=a.reference[p]+a.reference[b]+(k?0:((m=l.offset)==null?void 0:m[p])||0)-(k?w.crossAxis:0);y<$?y=$:y>I&&(y=I)}return{[d]:c,[p]:y}}}},ra=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var o,s;const{placement:r,rects:a,platform:l,elements:i}=t,{apply:v=()=>{},...f}=Fe(e,t),u=await _t(t,f),p=We(r),d=gt(r),c=Ee(r)==="y",{width:y,height:x}=a.floating;let w,h;p==="top"||p==="bottom"?(w=p,h=d===(await(l.isRTL==null?void 0:l.isRTL(i.floating))?"start":"end")?"left":"right"):(h=p,w=d==="end"?"top":"bottom");const m=x-u.top-u.bottom,b=y-u.left-u.right,k=Xe(x-u[w],m),$=Xe(y-u[h],b),I=!t.middlewareData.shift;let S=k,A=$;if((o=t.middlewareData.shift)!=null&&o.enabled.x&&(A=b),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(S=m),I&&!d){const V=be(u.left,0),G=be(u.right,0),F=be(u.top,0),Q=be(u.bottom,0);c?A=y-2*(V!==0||G!==0?V+G:be(u.left,u.right)):S=x-2*(F!==0||Q!==0?F+Q:be(u.top,u.bottom))}await v({...t,availableWidth:A,availableHeight:S});const R=await l.getDimensions(i.floating);return y!==R.width||x!==R.height?{reset:{rects:!0}}:{}}}};function tn(){return typeof window<"u"}function rt(e){return Tn(e)?(e.nodeName||"").toLowerCase():"#document"}function we(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Oe(e){var t;return(t=(Tn(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Tn(e){return tn()?e instanceof Node||e instanceof we(e).Node:!1}function Ce(e){return tn()?e instanceof Element||e instanceof we(e).Element:!1}function Re(e){return tn()?e instanceof HTMLElement||e instanceof we(e).HTMLElement:!1}function Gn(e){return!tn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof we(e).ShadowRoot}const aa=new Set(["inline","contents"]);function At(e){const{overflow:t,overflowX:o,overflowY:s,display:r}=$e(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+o)&&!aa.has(r)}const la=new Set(["table","td","th"]);function ia(e){return la.has(rt(e))}const ca=[":popover-open",":modal"];function nn(e){return ca.some(t=>{try{return e.matches(t)}catch{return!1}})}const da=["transform","translate","scale","rotate","perspective"],ua=["transform","translate","scale","rotate","perspective","filter"],fa=["paint","layout","strict","content"];function Ln(e){const t=Bn(),o=Ce(e)?$e(e):e;return da.some(s=>o[s]?o[s]!=="none":!1)||(o.containerType?o.containerType!=="normal":!1)||!t&&(o.backdropFilter?o.backdropFilter!=="none":!1)||!t&&(o.filter?o.filter!=="none":!1)||ua.some(s=>(o.willChange||"").includes(s))||fa.some(s=>(o.contain||"").includes(s))}function pa(e){let t=Je(e);for(;Re(t)&&!ft(t);){if(Ln(t))return t;if(nn(t))return null;t=Je(t)}return null}function Bn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ga=new Set(["html","body","#document"]);function ft(e){return ga.has(rt(e))}function $e(e){return we(e).getComputedStyle(e)}function on(e){return Ce(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Je(e){if(rt(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Gn(e)&&e.host||Oe(e);return Gn(t)?t.host:t}function Mo(e){const t=Je(e);return ft(t)?e.ownerDocument?e.ownerDocument.body:e.body:Re(t)&&At(t)?t:Mo(t)}function kt(e,t,o){var s;t===void 0&&(t=[]),o===void 0&&(o=!0);const r=Mo(e),a=r===((s=e.ownerDocument)==null?void 0:s.body),l=we(r);if(a){const i=kn(l);return t.concat(l,l.visualViewport||[],At(r)?r:[],i&&o?kt(i):[])}return t.concat(r,kt(r,[],o))}function kn(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Eo(e){const t=$e(e);let o=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const r=Re(e),a=r?e.offsetWidth:o,l=r?e.offsetHeight:s,i=Ft(o)!==a||Ft(s)!==l;return i&&(o=a,s=l),{width:o,height:s,$:i}}function In(e){return Ce(e)?e:e.contextElement}function dt(e){const t=In(e);if(!Re(t))return Te(1);const o=t.getBoundingClientRect(),{width:s,height:r,$:a}=Eo(t);let l=(a?Ft(o.width):o.width)/s,i=(a?Ft(o.height):o.height)/r;return(!l||!Number.isFinite(l))&&(l=1),(!i||!Number.isFinite(i))&&(i=1),{x:l,y:i}}const va=Te(0);function To(e){const t=we(e);return!Bn()||!t.visualViewport?va:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function ma(e,t,o){return t===void 0&&(t=!1),!o||t&&o!==we(e)?!1:t}function nt(e,t,o,s){t===void 0&&(t=!1),o===void 0&&(o=!1);const r=e.getBoundingClientRect(),a=In(e);let l=Te(1);t&&(s?Ce(s)&&(l=dt(s)):l=dt(e));const i=ma(a,o,s)?To(a):Te(0);let v=(r.left+i.x)/l.x,f=(r.top+i.y)/l.y,u=r.width/l.x,p=r.height/l.y;if(a){const d=we(a),c=s&&Ce(s)?we(s):s;let y=d,x=kn(y);for(;x&&s&&c!==y;){const w=dt(x),h=x.getBoundingClientRect(),m=$e(x),b=h.left+(x.clientLeft+parseFloat(m.paddingLeft))*w.x,k=h.top+(x.clientTop+parseFloat(m.paddingTop))*w.y;v*=w.x,f*=w.y,u*=w.x,p*=w.y,v+=b,f+=k,y=we(x),x=kn(y)}}return Ut({width:u,height:p,x:v,y:f})}function sn(e,t){const o=on(e).scrollLeft;return t?t.left+o:nt(Oe(e)).left+o}function Lo(e,t){const o=e.getBoundingClientRect(),s=o.left+t.scrollLeft-sn(e,o),r=o.top+t.scrollTop;return{x:s,y:r}}function ha(e){let{elements:t,rect:o,offsetParent:s,strategy:r}=e;const a=r==="fixed",l=Oe(s),i=t?nn(t.floating):!1;if(s===l||i&&a)return o;let v={scrollLeft:0,scrollTop:0},f=Te(1);const u=Te(0),p=Re(s);if((p||!p&&!a)&&((rt(s)!=="body"||At(l))&&(v=on(s)),Re(s))){const c=nt(s);f=dt(s),u.x=c.x+s.clientLeft,u.y=c.y+s.clientTop}const d=l&&!p&&!a?Lo(l,v):Te(0);return{width:o.width*f.x,height:o.height*f.y,x:o.x*f.x-v.scrollLeft*f.x+u.x+d.x,y:o.y*f.y-v.scrollTop*f.y+u.y+d.y}}function ba(e){return Array.from(e.getClientRects())}function ya(e){const t=Oe(e),o=on(e),s=e.ownerDocument.body,r=be(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),a=be(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let l=-o.scrollLeft+sn(e);const i=-o.scrollTop;return $e(s).direction==="rtl"&&(l+=be(t.clientWidth,s.clientWidth)-r),{width:r,height:a,x:l,y:i}}const Kn=25;function xa(e,t){const o=we(e),s=Oe(e),r=o.visualViewport;let a=s.clientWidth,l=s.clientHeight,i=0,v=0;if(r){a=r.width,l=r.height;const u=Bn();(!u||u&&t==="fixed")&&(i=r.offsetLeft,v=r.offsetTop)}const f=sn(s);if(f<=0){const u=s.ownerDocument,p=u.body,d=getComputedStyle(p),c=u.compatMode==="CSS1Compat"&&parseFloat(d.marginLeft)+parseFloat(d.marginRight)||0,y=Math.abs(s.clientWidth-p.clientWidth-c);y<=Kn&&(a-=y)}else f<=Kn&&(a+=f);return{width:a,height:l,x:i,y:v}}const wa=new Set(["absolute","fixed"]);function _a(e,t){const o=nt(e,!0,t==="fixed"),s=o.top+e.clientTop,r=o.left+e.clientLeft,a=Re(e)?dt(e):Te(1),l=e.clientWidth*a.x,i=e.clientHeight*a.y,v=r*a.x,f=s*a.y;return{width:l,height:i,x:v,y:f}}function Yn(e,t,o){let s;if(t==="viewport")s=xa(e,o);else if(t==="document")s=ya(Oe(e));else if(Ce(t))s=_a(t,o);else{const r=To(e);s={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return Ut(s)}function Bo(e,t){const o=Je(e);return o===t||!Ce(o)||ft(o)?!1:$e(o).position==="fixed"||Bo(o,t)}function ka(e,t){const o=t.get(e);if(o)return o;let s=kt(e,[],!1).filter(i=>Ce(i)&&rt(i)!=="body"),r=null;const a=$e(e).position==="fixed";let l=a?Je(e):e;for(;Ce(l)&&!ft(l);){const i=$e(l),v=Ln(l);!v&&i.position==="fixed"&&(r=null),(a?!v&&!r:!v&&i.position==="static"&&!!r&&wa.has(r.position)||At(l)&&!v&&Bo(e,l))?s=s.filter(u=>u!==l):r=i,l=Je(l)}return t.set(e,s),s}function Ca(e){let{element:t,boundary:o,rootBoundary:s,strategy:r}=e;const l=[...o==="clippingAncestors"?nn(t)?[]:ka(t,this._c):[].concat(o),s],i=l[0],v=l.reduce((f,u)=>{const p=Yn(t,u,r);return f.top=be(p.top,f.top),f.right=Xe(p.right,f.right),f.bottom=Xe(p.bottom,f.bottom),f.left=be(p.left,f.left),f},Yn(t,i,r));return{width:v.right-v.left,height:v.bottom-v.top,x:v.left,y:v.top}}function $a(e){const{width:t,height:o}=Eo(e);return{width:t,height:o}}function Sa(e,t,o){const s=Re(t),r=Oe(t),a=o==="fixed",l=nt(e,!0,a,t);let i={scrollLeft:0,scrollTop:0};const v=Te(0);function f(){v.x=sn(r)}if(s||!s&&!a)if((rt(t)!=="body"||At(r))&&(i=on(t)),s){const c=nt(t,!0,a,t);v.x=c.x+t.clientLeft,v.y=c.y+t.clientTop}else r&&f();a&&!s&&r&&f();const u=r&&!s&&!a?Lo(r,i):Te(0),p=l.left+i.scrollLeft-v.x-u.x,d=l.top+i.scrollTop-v.y-u.y;return{x:p,y:d,width:l.width,height:l.height}}function gn(e){return $e(e).position==="static"}function Xn(e,t){if(!Re(e)||$e(e).position==="fixed")return null;if(t)return t(e);let o=e.offsetParent;return Oe(e)===o&&(o=o.ownerDocument.body),o}function Io(e,t){const o=we(e);if(nn(e))return o;if(!Re(e)){let r=Je(e);for(;r&&!ft(r);){if(Ce(r)&&!gn(r))return r;r=Je(r)}return o}let s=Xn(e,t);for(;s&&ia(s)&&gn(s);)s=Xn(s,t);return s&&ft(s)&&gn(s)&&!Ln(s)?o:s||pa(e)||o}const Aa=async function(e){const t=this.getOffsetParent||Io,o=this.getDimensions,s=await o(e.floating);return{reference:Sa(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function Ma(e){return $e(e).direction==="rtl"}const Ea={convertOffsetParentRelativeRectToViewportRelativeRect:ha,getDocumentElement:Oe,getClippingRect:Ca,getOffsetParent:Io,getElementRects:Aa,getClientRects:ba,getDimensions:$a,getScale:dt,isElement:Ce,isRTL:Ma};function Ro(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Ta(e,t){let o=null,s;const r=Oe(e);function a(){var i;clearTimeout(s),(i=o)==null||i.disconnect(),o=null}function l(i,v){i===void 0&&(i=!1),v===void 0&&(v=1),a();const f=e.getBoundingClientRect(),{left:u,top:p,width:d,height:c}=f;if(i||t(),!d||!c)return;const y=It(p),x=It(r.clientWidth-(u+d)),w=It(r.clientHeight-(p+c)),h=It(u),b={rootMargin:-y+"px "+-x+"px "+-w+"px "+-h+"px",threshold:be(0,Xe(1,v))||1};let k=!0;function $(I){const S=I[0].intersectionRatio;if(S!==v){if(!k)return l();S?l(!1,S):s=setTimeout(()=>{l(!1,1e-7)},1e3)}S===1&&!Ro(f,e.getBoundingClientRect())&&l(),k=!1}try{o=new IntersectionObserver($,{...b,root:r.ownerDocument})}catch{o=new IntersectionObserver($,b)}o.observe(e)}return l(!0),a}function La(e,t,o,s){s===void 0&&(s={});const{ancestorScroll:r=!0,ancestorResize:a=!0,elementResize:l=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:v=!1}=s,f=In(e),u=r||a?[...f?kt(f):[],...kt(t)]:[];u.forEach(h=>{r&&h.addEventListener("scroll",o,{passive:!0}),a&&h.addEventListener("resize",o)});const p=f&&i?Ta(f,o):null;let d=-1,c=null;l&&(c=new ResizeObserver(h=>{let[m]=h;m&&m.target===f&&c&&(c.unobserve(t),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var b;(b=c)==null||b.observe(t)})),o()}),f&&!v&&c.observe(f),c.observe(t));let y,x=v?nt(e):null;v&&w();function w(){const h=nt(e);x&&!Ro(x,h)&&o(),x=h,y=requestAnimationFrame(w)}return o(),()=>{var h;u.forEach(m=>{r&&m.removeEventListener("scroll",o),a&&m.removeEventListener("resize",o)}),p?.(),(h=c)==null||h.disconnect(),c=null,v&&cancelAnimationFrame(y)}}const Ba=na,Ia=oa,Jn=Zr,Ra=ra,Oa=ea,Pa=Qr,Ha=sa,za=(e,t,o)=>{const s=new Map,r={platform:Ea,...o},a={...r.platform,_c:s};return Jr(e,t,{...r,platform:a})};function ja(e){return e!=null&&typeof e=="object"&&"$el"in e}function Cn(e){if(ja(e)){const t=e.$el;return Tn(t)&&rt(t)==="#comment"?null:t}return e}function ct(e){return typeof e=="function"?e():g(e)}function Da(e){return{name:"arrow",options:e,fn(t){const o=Cn(ct(e.element));return o==null?{}:Pa({element:o,padding:e.padding}).fn(t)}}}function Oo(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Qn(e,t){const o=Oo(e);return Math.round(t*o)/o}function qa(e,t,o){o===void 0&&(o={});const s=o.whileElementsMounted,r=M(()=>{var S;return(S=ct(o.open))!=null?S:!0}),a=M(()=>ct(o.middleware)),l=M(()=>{var S;return(S=ct(o.placement))!=null?S:"bottom"}),i=M(()=>{var S;return(S=ct(o.strategy))!=null?S:"absolute"}),v=M(()=>{var S;return(S=ct(o.transform))!=null?S:!0}),f=M(()=>Cn(e.value)),u=M(()=>Cn(t.value)),p=B(0),d=B(0),c=B(i.value),y=B(l.value),x=Kt({}),w=B(!1),h=M(()=>{const S={position:c.value,left:"0",top:"0"};if(!u.value)return S;const A=Qn(u.value,p.value),R=Qn(u.value,d.value);return v.value?{...S,transform:"translate("+A+"px, "+R+"px)",...Oo(u.value)>=1.5&&{willChange:"transform"}}:{position:c.value,left:A+"px",top:R+"px"}});let m;function b(){if(f.value==null||u.value==null)return;const S=r.value;za(f.value,u.value,{middleware:a.value,placement:l.value,strategy:i.value}).then(A=>{p.value=A.x,d.value=A.y,c.value=A.strategy,y.value=A.placement,x.value=A.middlewareData,w.value=S!==!1})}function k(){typeof m=="function"&&(m(),m=void 0)}function $(){if(k(),s===void 0){b();return}if(f.value!=null&&u.value!=null){m=s(f.value,u.value,b);return}}function I(){r.value||(w.value=!1)}return oe([a,l,i,r],b,{flush:"sync"}),oe([f,u],$,{flush:"sync"}),oe(r,I,{flush:"sync"}),uo()&&fo(k),{x:it(p),y:it(d),strategy:it(c),placement:it(y),middlewareData:it(x),isPositioned:it(w),floatingStyles:h,update:b}}const Na={side:"bottom",sideOffset:0,sideFlip:!0,align:"center",alignOffset:0,alignFlip:!0,arrowPadding:0,avoidCollisions:!0,collisionBoundary:()=>[],collisionPadding:0,sticky:"partial",hideWhenDetached:!1,positionStrategy:"fixed",updatePositionStrategy:"optimized",prioritizePosition:!1},[Rg,Va]=Ue("PopperContent");var Fa=P({inheritAttrs:!1,__name:"PopperContent",props:Os({side:{type:null,required:!1},sideOffset:{type:Number,required:!1},sideFlip:{type:Boolean,required:!1},align:{type:null,required:!1},alignOffset:{type:Number,required:!1},alignFlip:{type:Boolean,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},arrowPadding:{type:Number,required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1},disableUpdateOnLayoutShift:{type:Boolean,required:!1},prioritizePosition:{type:Boolean,required:!1},reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},{...Na}),emits:["placed"],setup(e,{emit:t}){const o=e,s=t,r=$o(),{forwardRef:a,currentElement:l}=ce(),i=B(),v=B(),{width:f,height:u}=br(v),p=M(()=>o.side+(o.align!=="center"?`-${o.align}`:"")),d=M(()=>typeof o.collisionPadding=="number"?o.collisionPadding:{top:0,right:0,bottom:0,left:0,...o.collisionPadding}),c=M(()=>Array.isArray(o.collisionBoundary)?o.collisionBoundary:[o.collisionBoundary]),y=M(()=>({padding:d.value,boundary:c.value.filter(zr),altBoundary:c.value.length>0})),x=M(()=>({mainAxis:o.sideFlip,crossAxis:o.alignFlip})),w=Us(()=>[Ba({mainAxis:o.sideOffset+u.value,alignmentAxis:o.alignOffset}),o.prioritizePosition&&o.avoidCollisions&&Jn({...y.value,...x.value}),o.avoidCollisions&&Ia({mainAxis:!0,crossAxis:!!o.prioritizePosition,limiter:o.sticky==="partial"?Ha():void 0,...y.value}),!o.prioritizePosition&&o.avoidCollisions&&Jn({...y.value,...x.value}),Ra({...y.value,apply:({elements:F,rects:Q,availableWidth:K,availableHeight:ee})=>{const{width:W,height:z}=Q.reference,q=F.floating.style;q.setProperty("--reka-popper-available-width",`${K}px`),q.setProperty("--reka-popper-available-height",`${ee}px`),q.setProperty("--reka-popper-anchor-width",`${W}px`),q.setProperty("--reka-popper-anchor-height",`${z}px`)}}),v.value&&Da({element:v.value,padding:o.arrowPadding}),jr({arrowWidth:f.value,arrowHeight:u.value}),o.hideWhenDetached&&Oa({strategy:"referenceHidden",...y.value})]),h=M(()=>o.reference??r.anchor.value),{floatingStyles:m,placement:b,isPositioned:k,middlewareData:$}=qa(h,i,{strategy:o.positionStrategy,placement:p,whileElementsMounted:(...F)=>La(...F,{layoutShift:!o.disableUpdateOnLayoutShift,animationFrame:o.updatePositionStrategy==="always"}),middleware:w}),I=M(()=>xn(b.value)[0]),S=M(()=>xn(b.value)[1]);go(()=>{k.value&&s("placed")});const A=M(()=>$.value.arrow?.centerOffset!==0),R=B("");Le(()=>{l.value&&(R.value=window.getComputedStyle(l.value).zIndex)});const V=M(()=>$.value.arrow?.x??0),G=M(()=>$.value.arrow?.y??0);return Va({placedSide:I,onArrowChange:F=>v.value=F,arrowX:V,arrowY:G,shouldHideArrow:A}),(F,Q)=>(_(),C("div",{ref_key:"floatingRef",ref:i,"data-reka-popper-content-wrapper":"",style:ve({...g(m),transform:g(k)?g(m).transform:"translate(0, -200%)",minWidth:"max-content",zIndex:R.value,"--reka-popper-transform-origin":[g($).transformOrigin?.x,g($).transformOrigin?.y].join(" "),...g($).hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}})},[O(g(he),se({ref:g(a)},F.$attrs,{"as-child":o.asChild,as:F.as,"data-side":I.value,"data-align":S.value,style:{animation:g(k)?void 0:"none"}}),{default:T(()=>[Y(F.$slots,"default")]),_:3},16,["as-child","as","data-side","data-align","style"])],4))}}),Wa=Fa;function Ua(e){const t=mo({nonce:B()});return M(()=>e?.value||t.nonce?.value)}const[ke,Ga]=Ue("ScrollAreaRoot");var Ka=P({__name:"ScrollAreaRoot",props:{type:{type:String,required:!1,default:"hover"},dir:{type:String,required:!1},scrollHideDelay:{type:Number,required:!1,default:600},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e,{expose:t}){const o=e,s=B(0),r=B(0),a=B(),l=B(),i=B(),v=B(),f=B(!1),u=B(!1),{type:p,dir:d,scrollHideDelay:c}=Ke(o),y=lr(d);function x(){a.value?.scrollTo({top:0})}function w(){a.value?.scrollTo({top:0,left:0})}t({viewport:a,scrollTop:x,scrollTopLeft:w});const{forwardRef:h,currentElement:m}=ce();return Ga({type:p,dir:y,scrollHideDelay:c,scrollArea:m,viewport:a,onViewportChange:b=>{a.value=b||void 0},content:l,onContentChange:b=>{l.value=b},scrollbarX:i,scrollbarXEnabled:f,scrollbarY:v,scrollbarYEnabled:u,onScrollbarXChange:b=>{i.value=b||void 0},onScrollbarYChange:b=>{v.value=b||void 0},onScrollbarXEnabledChange:b=>{f.value=b},onScrollbarYEnabledChange:b=>{u.value=b},onCornerWidthChange:b=>{s.value=b},onCornerHeightChange:b=>{r.value=b}}),(b,k)=>(_(),j(g(he),{ref:g(h),"as-child":o.asChild,as:b.as,dir:g(y),style:ve({position:"relative","--reka-scroll-area-corner-width":`${s.value}px`,"--reka-scroll-area-corner-height":`${r.value}px`})},{default:T(()=>[Y(b.$slots,"default")]),_:3},8,["as-child","as","dir","style"]))}}),Ya=Ka,Xa=P({__name:"ScrollAreaCornerImpl",setup(e){const t=ke(),o=B(0),s=B(0),r=M(()=>!!o.value&&!!s.value);function a(){const i=t.scrollbarX.value?.offsetHeight||0;t.onCornerHeightChange(i),s.value=i}function l(){const i=t.scrollbarY.value?.offsetWidth||0;t.onCornerWidthChange(i),o.value=i}return ut(t.scrollbarX.value,a),ut(t.scrollbarY.value,l),oe(()=>t.scrollbarX.value,a),oe(()=>t.scrollbarY.value,l),(i,v)=>r.value?(_(),j(g(he),se({key:0,style:{width:`${o.value}px`,height:`${s.value}px`,position:"absolute",right:g(t).dir.value==="ltr"?0:void 0,left:g(t).dir.value==="rtl"?0:void 0,bottom:0}},i.$parent?.$props),{default:T(()=>[Y(i.$slots,"default")]),_:3},16,["style"])):L("v-if",!0)}}),Ja=Xa,Qa=P({__name:"ScrollAreaCorner",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const t=e,{forwardRef:o}=ce(),s=ke(),r=M(()=>!!s.scrollbarX.value&&!!s.scrollbarY.value),a=M(()=>s.type.value!=="scroll"&&r.value);return(l,i)=>a.value?(_(),j(Ja,se({key:0},t,{ref:g(o)}),{default:T(()=>[Y(l.$slots,"default")]),_:3},16)):L("v-if",!0)}}),Za=Qa;function Po(e,t){return o=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(e[1]-e[0]);return t[0]+s*(o-e[0])}}function rn(e){const t=Ho(e.viewport,e.content),o=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-o)*t;return Math.max(s,18)}function Ho(e,t){const o=e/t;return Number.isNaN(o)?0:o}function el(e,t=()=>{}){let o={left:e.scrollLeft,top:e.scrollTop},s=0;return(function r(){const a={left:e.scrollLeft,top:e.scrollTop},l=o.left!==a.left,i=o.top!==a.top;(l||i)&&t(),o=a,s=window.requestAnimationFrame(r)})(),()=>window.cancelAnimationFrame(s)}function Zn(e,t,o="ltr"){const s=rn(t),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-r,l=t.content-t.viewport,i=a-s,v=o==="ltr"?[0,l]:[l*-1,0],f=Ws(e,v[0],v[1]);return Po([0,l],[0,i])(f)}function Rt(e){return e?Number.parseInt(e,10):0}function tl(e,t,o,s="ltr"){const r=rn(o),a=r/2,l=t||a,i=r-l,v=o.scrollbar.paddingStart+l,f=o.scrollbar.size-o.scrollbar.paddingEnd-i,u=o.content-o.viewport,p=s==="ltr"?[0,u]:[u*-1,0];return Po([v,f],p)(e)}function eo(e,t){return e>0&&e<t}var nl=P({__name:"ScrollAreaScrollbarX",setup(e){const t=ke(),o=ln(),{forwardRef:s,currentElement:r}=ce();ge(()=>{r.value&&t.onScrollbarXChange(r.value)});const a=M(()=>o.sizes.value);return(l,i)=>(_(),j(jo,{ref:g(s),"is-horizontal":!0,"data-orientation":"horizontal",style:ve({bottom:0,left:g(t).dir.value==="rtl"?"var(--reka-scroll-area-corner-width)":0,right:g(t).dir.value==="ltr"?"var(--reka-scroll-area-corner-width)":0,"--reka-scroll-area-thumb-width":a.value?`${g(rn)(a.value)}px`:void 0}),onOnDragScroll:i[0]||(i[0]=v=>g(o).onDragScroll(v.x))},{default:T(()=>[Y(l.$slots,"default")]),_:3},8,["style"]))}}),ol=nl,sl=P({__name:"ScrollAreaScrollbarY",setup(e){const t=ke(),o=ln(),{forwardRef:s,currentElement:r}=ce();ge(()=>{r.value&&t.onScrollbarYChange(r.value)});const a=M(()=>o.sizes.value);return(l,i)=>(_(),j(jo,{ref:g(s),"is-horizontal":!1,"data-orientation":"vertical",style:ve({top:0,right:g(t).dir.value==="ltr"?0:void 0,left:g(t).dir.value==="rtl"?0:void 0,bottom:"var(--reka-scroll-area-corner-height)","--reka-scroll-area-thumb-height":a.value?`${g(rn)(a.value)}px`:void 0}),onOnDragScroll:i[0]||(i[0]=v=>g(o).onDragScroll(v.y))},{default:T(()=>[Y(l.$slots,"default")]),_:3},8,["style"]))}}),rl=sl,al=P({__name:"ScrollAreaScrollbarAuto",props:{forceMount:{type:Boolean,required:!1}},setup(e){const t=ke(),o=an(),{forwardRef:s}=ce(),r=B(!1),a=ho(()=>{if(t.viewport.value){const l=t.viewport.value.offsetWidth<t.viewport.value.scrollWidth,i=t.viewport.value.offsetHeight<t.viewport.value.scrollHeight;r.value=o.isHorizontal.value?l:i}},10);return ge(()=>a()),ut(t.viewport,a),ut(t.content,a),(l,i)=>(_(),j(g(en),{present:l.forceMount||r.value},{default:T(()=>[O(Rn,se(l.$attrs,{ref:g(s),"data-state":r.value?"visible":"hidden"}),{default:T(()=>[Y(l.$slots,"default")]),_:3},16,["data-state"])]),_:3},8,["present"]))}}),zo=al,ll=P({inheritAttrs:!1,__name:"ScrollAreaScrollbarHover",props:{forceMount:{type:Boolean,required:!1}},setup(e){const t=ke(),{forwardRef:o}=ce();let s;const r=B(!1);function a(){window.clearTimeout(s),r.value=!0}function l(){s=window.setTimeout(()=>{r.value=!1},t.scrollHideDelay.value)}return ge(()=>{const i=t.scrollArea.value;i&&(i.addEventListener("pointerenter",a),i.addEventListener("pointerleave",l))}),Qe(()=>{const i=t.scrollArea.value;i&&(window.clearTimeout(s),i.removeEventListener("pointerenter",a),i.removeEventListener("pointerleave",l))}),(i,v)=>(_(),j(g(en),{present:i.forceMount||r.value},{default:T(()=>[O(zo,se(i.$attrs,{ref:g(o),"data-state":r.value?"visible":"hidden"}),{default:T(()=>[Y(i.$slots,"default")]),_:3},16,["data-state"])]),_:3},8,["present"]))}}),il=ll,cl=P({__name:"ScrollAreaScrollbarScroll",props:{forceMount:{type:Boolean,required:!1}},setup(e){const t=ke(),o=an(),{forwardRef:s}=ce(),{state:r,dispatch:a}=_o("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}}),l=M(()=>r.value!=="hidden");Le(v=>{if(r.value==="idle"){const f=window.setTimeout(()=>a("HIDE"),t.scrollHideDelay.value);v(()=>{window.clearTimeout(f)})}});const i=ho(()=>a("SCROLL_END"),100);return Le(v=>{const f=t.viewport.value,u=o.isHorizontal.value?"scrollLeft":"scrollTop";if(f){let p=f[u];const d=()=>{const c=f[u];p!==c&&(a("SCROLL"),i()),p=c};f.addEventListener("scroll",d),v(()=>{f.removeEventListener("scroll",d)})}}),(v,f)=>(_(),j(g(en),{present:v.forceMount||l.value},{default:T(()=>[O(Rn,se(v.$attrs,{ref:g(s),"data-state":l.value?"visible":"hidden"}),{default:T(()=>[Y(v.$slots,"default")]),_:3},16,["data-state"])]),_:3},8,["present"]))}}),dl=cl;const[an,ul]=Ue("ScrollAreaScrollbar");var fl=P({inheritAttrs:!1,__name:"ScrollAreaScrollbar",props:{orientation:{type:String,required:!1,default:"vertical"},forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"div"}},setup(e){const t=e,{forwardRef:o}=ce(),s=ke(),r=M(()=>t.orientation==="horizontal");oe(r,()=>{r.value?s.onScrollbarXEnabledChange(!0):s.onScrollbarYEnabledChange(!0)},{immediate:!0}),Qe(()=>{s.onScrollbarXEnabledChange(!1),s.onScrollbarYEnabledChange(!1)});const{orientation:a,forceMount:l,asChild:i,as:v}=Ke(t);return ul({orientation:a,forceMount:l,isHorizontal:r,as:v,asChild:i}),(f,u)=>g(s).type.value==="hover"?(_(),j(il,se({key:0},f.$attrs,{ref:g(o),"force-mount":g(l)}),{default:T(()=>[Y(f.$slots,"default")]),_:3},16,["force-mount"])):g(s).type.value==="scroll"?(_(),j(dl,se({key:1},f.$attrs,{ref:g(o),"force-mount":g(l)}),{default:T(()=>[Y(f.$slots,"default")]),_:3},16,["force-mount"])):g(s).type.value==="auto"?(_(),j(zo,se({key:2},f.$attrs,{ref:g(o),"force-mount":g(l)}),{default:T(()=>[Y(f.$slots,"default")]),_:3},16,["force-mount"])):g(s).type.value==="always"?(_(),j(Rn,se({key:3},f.$attrs,{ref:g(o),"data-state":"visible"}),{default:T(()=>[Y(f.$slots,"default")]),_:3},16)):L("v-if",!0)}}),pl=fl;const[ln,gl]=Ue("ScrollAreaScrollbarVisible");var vl=P({__name:"ScrollAreaScrollbarVisible",setup(e){const t=ke(),o=an(),{forwardRef:s}=ce(),r=B({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),a=M(()=>{const h=Ho(r.value.viewport,r.value.content);return h>0&&h<1}),l=B(),i=B(0);function v(h,m){if(c.value){const b=t.viewport.value.scrollLeft+h.deltaY;t.viewport.value.scrollLeft=b,eo(b,m)&&h.preventDefault()}else{const b=t.viewport.value.scrollTop+h.deltaY;t.viewport.value.scrollTop=b,eo(b,m)&&h.preventDefault()}}function f(h,m){c.value?i.value=m.x:i.value=m.y}function u(h){i.value=0}function p(h){r.value=h}function d(h,m){return tl(h,i.value,r.value,m)}const c=M(()=>o.isHorizontal.value);function y(h){c.value?t.viewport.value.scrollLeft=d(h,t.dir.value):t.viewport.value.scrollTop=d(h)}function x(){if(c.value){if(t.viewport.value&&l.value){const h=t.viewport.value.scrollLeft,m=Zn(h,r.value,t.dir.value);l.value.style.transform=`translate3d(${m}px, 0, 0)`}}else if(t.viewport.value&&l.value){const h=t.viewport.value.scrollTop,m=Zn(h,r.value);l.value.style.transform=`translate3d(0, ${m}px, 0)`}}function w(h){l.value=h}return gl({sizes:r,hasThumb:a,handleWheelScroll:v,handleThumbDown:f,handleThumbUp:u,handleSizeChange:p,onThumbPositionChange:x,onThumbChange:w,onDragScroll:y}),(h,m)=>c.value?(_(),j(ol,se({key:0},h.$attrs,{ref:g(s)}),{default:T(()=>[Y(h.$slots,"default")]),_:3},16)):(_(),j(rl,se({key:1},h.$attrs,{ref:g(s)}),{default:T(()=>[Y(h.$slots,"default")]),_:3},16))}}),Rn=vl,ml=P({__name:"ScrollAreaScrollbarImpl",props:{isHorizontal:{type:Boolean,required:!0}},emits:["onDragScroll","onWheelScroll","onThumbPointerDown"],setup(e,{emit:t}){const o=e,s=t,r=ke(),a=ln(),l=an(),{forwardRef:i,currentElement:v}=ce(),f=B(""),u=B();function p(h){if(u.value){const m=h.clientX-u.value?.left,b=h.clientY-u.value?.top;s("onDragScroll",{x:m,y:b})}}function d(h){h.button===0&&(h.target.setPointerCapture(h.pointerId),u.value=v.value.getBoundingClientRect(),f.value=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",r.viewport&&(r.viewport.value.style.scrollBehavior="auto"),p(h))}function c(h){p(h)}function y(h){const m=h.target;m.hasPointerCapture(h.pointerId)&&m.releasePointerCapture(h.pointerId),document.body.style.webkitUserSelect=f.value,r.viewport&&(r.viewport.value.style.scrollBehavior=""),u.value=void 0}function x(h){const m=h.target,b=v.value?.contains(m),k=a.sizes.value.content-a.sizes.value.viewport;b&&a.handleWheelScroll(h,k)}ge(()=>{document.addEventListener("wheel",x,{passive:!1})}),Qe(()=>{document.removeEventListener("wheel",x)});function w(){v.value&&(o.isHorizontal?a.handleSizeChange({content:r.viewport.value?.scrollWidth??0,viewport:r.viewport.value?.offsetWidth??0,scrollbar:{size:v.value.clientWidth??0,paddingStart:Rt(getComputedStyle(v.value).paddingLeft),paddingEnd:Rt(getComputedStyle(v.value).paddingRight)}}):a.handleSizeChange({content:r.viewport.value?.scrollHeight??0,viewport:r.viewport.value?.offsetHeight??0,scrollbar:{size:v.value?.clientHeight??0,paddingStart:Rt(getComputedStyle(v.value).paddingLeft),paddingEnd:Rt(getComputedStyle(v.value).paddingRight)}}))}return ut(v,w),ut(r.content,w),(h,m)=>(_(),j(g(he),{ref:g(i),style:{position:"absolute"},"data-scrollbarimpl":"",as:g(l).as.value,"as-child":g(l).asChild.value,onPointerdown:d,onPointermove:c,onPointerup:y},{default:T(()=>[Y(h.$slots,"default")]),_:3},8,["as","as-child"]))}}),jo=ml,hl=P({__name:"ScrollAreaThumb",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const t=e,o=ke(),s=ln();function r(d){const y=d.target.getBoundingClientRect(),x=d.clientX-y.left,w=d.clientY-y.top;s.handleThumbDown(d,{x,y:w})}function a(d){s.handleThumbUp(d)}const{forwardRef:l,currentElement:i}=ce(),v=B(),f=M(()=>o.viewport.value);function u(){if(!v.value){const d=el(f.value,s.onThumbPositionChange);v.value=d,s.onThumbPositionChange()}}const p=M(()=>s.sizes.value);return nr(p,()=>{s.onThumbChange(i.value),f.value&&(s.onThumbPositionChange(),f.value.addEventListener("scroll",u))}),Qe(()=>{f.value.removeEventListener("scroll",u),o.viewport.value?.removeEventListener("scroll",u)}),(d,c)=>(_(),j(g(he),{ref:g(l),"data-state":g(s).hasThumb?"visible":"hidden",style:{width:"var(--reka-scroll-area-thumb-width)",height:"var(--reka-scroll-area-thumb-height)"},"as-child":t.asChild,as:d.as,onPointerdown:r,onPointerup:a},{default:T(()=>[Y(d.$slots,"default")]),_:3},8,["data-state","as-child","as"]))}}),bl=hl,yl=P({inheritAttrs:!1,__name:"ScrollAreaViewport",props:{nonce:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e,{expose:t}){const o=e,{nonce:s}=Ke(o),r=Ua(s),a=ke(),l=B();ge(()=>{a.onViewportChange(l.value),a.onContentChange(v.value)}),t({viewportElement:l});const{forwardRef:i,currentElement:v}=ce();return(f,u)=>(_(),C(te,null,[n("div",se({ref_key:"viewportElement",ref:l,"data-reka-scroll-area-viewport":"",style:{overflowX:g(a).scrollbarXEnabled.value?"scroll":"hidden",overflowY:g(a).scrollbarYEnabled.value?"scroll":"hidden"}},f.$attrs,{tabindex:0}),[O(g(he),{ref:g(i),style:ve({minWidth:g(a).scrollbarXEnabled.value?"fit-content":void 0}),"as-child":o.asChild,as:f.as},{default:T(()=>[Y(f.$slots,"default")]),_:3},8,["style","as-child","as"])],16),O(g(he),{as:"style",nonce:g(r)},{default:T(()=>u[0]||(u[0]=[ne(" /* Hide scrollbars cross-browser and enable momentum scroll for touch devices */ [data-reka-scroll-area-viewport] { scrollbar-width:none; -ms-overflow-style:none; -webkit-overflow-scrolling:touch; } [data-reka-scroll-area-viewport]::-webkit-scrollbar { display:none; } ")])),_:1,__:[0]},8,["nonce"])],64))}}),xl=yl;const[wl,_l]=Ue("SwitchRoot");var kl=P({__name:"SwitchRoot",props:{defaultValue:{type:Boolean,required:!1},modelValue:{type:[Boolean,null],required:!1,default:void 0},disabled:{type:Boolean,required:!1},id:{type:String,required:!1},value:{type:String,required:!1,default:"on"},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,s=t,{disabled:r}=Ke(o),a=xo(o,"modelValue",s,{defaultValue:o.defaultValue,passive:o.modelValue===void 0});function l(){r.value||(a.value=!a.value)}const{forwardRef:i,currentElement:v}=ce(),f=cr(v),u=M(()=>o.id&&v.value?document.querySelector(`[for="${o.id}"]`)?.innerText:void 0);return _l({modelValue:a,toggleCheck:l,disabled:r}),(p,d)=>(_(),j(g(he),se(p.$attrs,{id:p.id,ref:g(i),role:"switch",type:p.as==="button"?"button":void 0,value:p.value,"aria-label":p.$attrs["aria-label"]||u.value,"aria-checked":g(a),"aria-required":p.required,"data-state":g(a)?"checked":"unchecked","data-disabled":g(r)?"":void 0,"as-child":p.asChild,as:p.as,disabled:g(r),onClick:l,onKeydown:Yt(_e(l,["prevent"]),["enter"])}),{default:T(()=>[Y(p.$slots,"default",{modelValue:g(a)}),g(f)&&p.name?(_(),j(g(Br),{key:0,type:"checkbox",name:p.name,disabled:g(r),required:p.required,value:p.value,checked:!!g(a)},null,8,["name","disabled","required","value","checked"])):L("v-if",!0)]),_:3},16,["id","type","value","aria-label","aria-checked","aria-required","data-state","data-disabled","as-child","as","disabled","onKeydown"]))}}),Cl=kl,$l=P({__name:"SwitchThumb",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){const t=wl();return ce(),(o,s)=>(_(),j(g(he),{"data-state":g(t).modelValue?.value?"checked":"unchecked","data-disabled":g(t).disabled.value?"":void 0,"as-child":o.asChild,as:o.as},{default:T(()=>[Y(o.$slots,"default")]),_:3},8,["data-state","data-disabled","as-child","as"]))}}),Sl=$l;const[On,Al]=Ue("TooltipProvider");var Ml=P({inheritAttrs:!1,__name:"TooltipProvider",props:{delayDuration:{type:Number,required:!1,default:700},skipDelayDuration:{type:Number,required:!1,default:300},disableHoverableContent:{type:Boolean,required:!1,default:!1},disableClosingTrigger:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},ignoreNonKeyboardFocus:{type:Boolean,required:!1,default:!1}},setup(e){const t=e,{delayDuration:o,skipDelayDuration:s,disableHoverableContent:r,disableClosingTrigger:a,ignoreNonKeyboardFocus:l,disabled:i}=Ke(t);ce();const v=B(!0),f=B(!1),{start:u,stop:p}=bo(()=>{v.value=!0},s,{immediate:!1});return Al({isOpenDelayed:v,delayDuration:o,onOpen(){p(),v.value=!1},onClose(){u()},isPointerInTransitRef:f,disableHoverableContent:r,disableClosingTrigger:a,disabled:i,ignoreNonKeyboardFocus:l}),(d,c)=>Y(d.$slots,"default")}}),El=Ml;const Do="tooltip.open",[cn,Tl]=Ue("TooltipRoot");var Ll=P({__name:"TooltipRoot",props:{defaultOpen:{type:Boolean,required:!1,default:!1},open:{type:Boolean,required:!1,default:void 0},delayDuration:{type:Number,required:!1,default:void 0},disableHoverableContent:{type:Boolean,required:!1,default:void 0},disableClosingTrigger:{type:Boolean,required:!1,default:void 0},disabled:{type:Boolean,required:!1,default:void 0},ignoreNonKeyboardFocus:{type:Boolean,required:!1,default:void 0}},emits:["update:open"],setup(e,{emit:t}){const o=e,s=t;ce();const r=On(),a=M(()=>o.disableHoverableContent??r.disableHoverableContent.value),l=M(()=>o.disableClosingTrigger??r.disableClosingTrigger.value),i=M(()=>o.disabled??r.disabled.value),v=M(()=>o.delayDuration??r.delayDuration.value),f=M(()=>o.ignoreNonKeyboardFocus??r.ignoreNonKeyboardFocus.value),u=xo(o,"open",s,{defaultValue:o.defaultOpen,passive:o.open===void 0});oe(u,b=>{r.onClose&&(b?(r.onOpen(),document.dispatchEvent(new CustomEvent(Do))):r.onClose())});const p=B(!1),d=B(),c=M(()=>u.value?p.value?"delayed-open":"instant-open":"closed"),{start:y,stop:x}=bo(()=>{p.value=!0,u.value=!0},v,{immediate:!1});function w(){x(),p.value=!1,u.value=!0}function h(){x(),u.value=!1}function m(){y()}return Tl({contentId:"",open:u,stateAttribute:c,trigger:d,onTriggerChange(b){d.value=b},onTriggerEnter(){r.isOpenDelayed.value?m():w()},onTriggerLeave(){a.value?h():x()},onOpen:w,onClose:h,disableHoverableContent:a,disableClosingTrigger:l,disabled:i,ignoreNonKeyboardFocus:f}),(b,k)=>(_(),j(g(Or),null,{default:T(()=>[Y(b.$slots,"default",{open:g(u)})]),_:3}))}}),Bl=Ll,Il=P({__name:"TooltipContentImpl",props:{ariaLabel:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},side:{type:null,required:!1,default:"top"},sideOffset:{type:Number,required:!1,default:0},align:{type:null,required:!1,default:"center"},alignOffset:{type:Number,required:!1},avoidCollisions:{type:Boolean,required:!1,default:!0},collisionBoundary:{type:null,required:!1,default:()=>[]},collisionPadding:{type:[Number,Object],required:!1,default:0},arrowPadding:{type:Number,required:!1,default:0},sticky:{type:String,required:!1,default:"partial"},hideWhenDetached:{type:Boolean,required:!1,default:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1}},emits:["escapeKeyDown","pointerDownOutside"],setup(e,{emit:t}){const o=e,s=t,r=cn(),{forwardRef:a}=ce(),l=Ps(),i=M(()=>l.default?.({})),v=M(()=>{if(o.ariaLabel)return o.ariaLabel;let u="";function p(d){typeof d.children=="string"&&d.type!==Hs?u+=d.children:Array.isArray(d.children)&&d.children.forEach(c=>p(c))}return i.value?.forEach(d=>p(d)),u}),f=M(()=>{const{ariaLabel:u,...p}=o;return p});return ge(()=>{yn(window,"scroll",u=>{u.target?.contains(r.trigger.value)&&r.onClose()}),yn(window,Do,r.onClose)}),(u,p)=>(_(),j(g(Sr),{"as-child":"","disable-outside-pointer-events":!1,onEscapeKeyDown:p[0]||(p[0]=d=>s("escapeKeyDown",d)),onPointerDownOutside:p[1]||(p[1]=d=>{g(r).disableClosingTrigger.value&&g(r).trigger.value?.contains(d.target)&&d.preventDefault(),s("pointerDownOutside",d)}),onFocusOutside:p[2]||(p[2]=_e(()=>{},["prevent"])),onDismiss:p[3]||(p[3]=d=>g(r).onClose())},{default:T(()=>[O(g(Wa),se({ref:g(a),"data-state":g(r).stateAttribute.value},{...u.$attrs,...f.value},{style:{"--reka-tooltip-content-transform-origin":"var(--reka-popper-transform-origin)","--reka-tooltip-content-available-width":"var(--reka-popper-available-width)","--reka-tooltip-content-available-height":"var(--reka-popper-available-height)","--reka-tooltip-trigger-width":"var(--reka-popper-anchor-width)","--reka-tooltip-trigger-height":"var(--reka-popper-anchor-height)"}}),{default:T(()=>[Y(u.$slots,"default"),O(g(Co),{id:g(r).contentId,role:"tooltip"},{default:T(()=>[ne(E(v.value),1)]),_:1},8,["id"])]),_:3},16,["data-state"])]),_:3}))}}),qo=Il,Rl=P({__name:"TooltipContentHoverable",props:{ariaLabel:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},side:{type:null,required:!1},sideOffset:{type:Number,required:!1},align:{type:null,required:!1},alignOffset:{type:Number,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},arrowPadding:{type:Number,required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1}},setup(e){const o=wo(e),{forwardRef:s,currentElement:r}=ce(),{trigger:a,onClose:l}=cn(),i=On(),{isPointerInTransit:v,onPointerExit:f}=dr(a,r);return i.isPointerInTransitRef=v,f(()=>{l()}),(u,p)=>(_(),j(qo,se({ref:g(s)},g(o)),{default:T(()=>[Y(u.$slots,"default")]),_:3},16))}}),Ol=Rl,Pl=P({__name:"TooltipContent",props:{forceMount:{type:Boolean,required:!1},ariaLabel:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},side:{type:null,required:!1,default:"top"},sideOffset:{type:Number,required:!1},align:{type:null,required:!1},alignOffset:{type:Number,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},arrowPadding:{type:Number,required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1}},emits:["escapeKeyDown","pointerDownOutside"],setup(e,{emit:t}){const o=e,s=t,r=cn(),a=Zt(o,s),{forwardRef:l}=ce();return(i,v)=>(_(),j(g(en),{present:i.forceMount||g(r).open.value},{default:T(()=>[(_(),j($n(g(r).disableHoverableContent.value?qo:Ol),se({ref:g(l)},g(a)),{default:T(()=>[Y(i.$slots,"default")]),_:3},16))]),_:3},8,["present"]))}}),Hl=Pl,zl=P({__name:"TooltipPortal",props:{to:{type:null,required:!1},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(e){const t=e;return(o,s)=>(_(),j(g(Mr),Xt(Jt(t)),{default:T(()=>[Y(o.$slots,"default")]),_:3},16))}}),jl=zl,Dl=P({__name:"TooltipTrigger",props:{reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(e){const t=e,o=cn(),s=On();o.contentId||=hr(void 0,"reka-tooltip-content");const{forwardRef:r,currentElement:a}=ce(),l=B(!1),i=B(!1),v=M(()=>o.disabled.value?{}:{click:x,focus:c,pointermove:p,pointerleave:d,pointerdown:u,blur:y});ge(()=>{o.onTriggerChange(a.value)});function f(){setTimeout(()=>{l.value=!1},1)}function u(){o.open&&!o.disableClosingTrigger.value&&o.onClose(),l.value=!0,document.addEventListener("pointerup",f,{once:!0})}function p(w){w.pointerType!=="touch"&&!i.value&&!s.isPointerInTransitRef.value&&(o.onTriggerEnter(),i.value=!0)}function d(){o.onTriggerLeave(),i.value=!1}function c(w){l.value||o.ignoreNonKeyboardFocus.value&&!w.target.matches?.(":focus-visible")||o.onOpen()}function y(){o.onClose()}function x(){o.disableClosingTrigger.value||o.onClose()}return(w,h)=>(_(),j(g(Hr),{"as-child":"",reference:w.reference},{default:T(()=>[O(g(he),se({ref:g(r),"aria-describedby":g(o).open.value?g(o).contentId:void 0,"data-state":g(o).stateAttribute.value,as:w.as,"as-child":t.asChild,"data-grace-area-trigger":""},zs(v.value)),{default:T(()=>[Y(w.$slots,"default")]),_:3},16,["aria-describedby","data-state","as","as-child"])]),_:3},8,["reference"]))}}),ql=Dl;function Nl(e){if(!ye(e))return hn(e);const t=new Proxy({},{get(o,s,r){return g(Reflect.get(e.value,s,r))},set(o,s,r){return ye(e.value[s])&&!ye(r)?e.value[s].value=r:e.value[s]=r,!0},deleteProperty(o,s){return Reflect.deleteProperty(e.value,s)},has(o,s){return Reflect.has(e.value,s)},ownKeys(){return Object.keys(e.value)},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}}});return hn(t)}function Vl(e){return Nl(M(e))}function Mt(e,...t){const o=t.flat(),s=o[0];return Vl(()=>Object.fromEntries(typeof s=="function"?Object.entries(Ke(e)).filter(([r,a])=>!s(ue(a),r)):Object.entries(Ke(e)).filter(r=>!o.includes(r[0]))))}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Fl=e=>typeof e<"u";function Wl(e){return JSON.parse(JSON.stringify(e))}function Ul(e,t,o,s={}){var r,a,l;const{clone:i=!1,passive:v=!1,eventName:f,deep:u=!1,defaultValue:p,shouldEmit:d}=s,c=st(),y=o||c?.emit||((r=c?.$emit)==null?void 0:r.bind(c))||((l=(a=c?.proxy)==null?void 0:a.$emit)==null?void 0:l.bind(c?.proxy));let x=f;x=x||`update:${t.toString()}`;const w=b=>i?typeof i=="function"?i(b):Wl(b):b,h=()=>Fl(e[t])?w(e[t]):p,m=b=>{d?d(b)&&y(x,b):y(x,b)};if(v){const b=h(),k=B(b);let $=!1;return oe(()=>e[t],I=>{$||($=!0,k.value=w(I),Be(()=>$=!1))}),oe(k,I=>{!$&&(I!==e[t]||u)&&m(I)},{deep:u}),k}else return M({get(){return h()},set(b){m(b)}})}const Gl=P({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,r=Ul(o,"modelValue",t,{passive:!0,defaultValue:o.defaultValue});return(a,l)=>xe((_(),C("textarea",{"onUpdate:modelValue":l[0]||(l[0]=i=>ye(r)?r.value=i:null),class:D(g(Ie)("flex min-h-20 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o.class))},null,2)),[[Ct,g(r)]])}}),Kl=()=>{const t=me().public.apiBase,o=B(!1),s=B(null),r=async(a=10,l=0)=>{o.value=!0,s.value=null;try{const i=await $fetch("/api/v1/public/demo/articles",{baseURL:t,method:"GET",query:{limit:a,offset:l}});return console.log("[Demo] 获取示例文章列表成功:",i.total,"篇"),i}catch(i){return console.error("[Demo] 获取示例文章列表失败:",i),s.value=i.data?.detail||"获取失败",null}finally{o.value=!1}};return{loading:le(o),error:le(s),getDemoArticles:r}},Yl={class:"min-h-screen relative flex items-center justify-center overflow-hidden"},Xl={class:"relative z-10 w-full max-w-5xl mx-auto px-6 py-20"},Jl={class:"relative group"},Ql={class:"relative bg-white/80 backdrop-blur-xl rounded-2xl border border-gray-200/50 shadow-2xl shadow-gray-200/50 overflow-hidden"},Zl={class:"px-8 pt-8 pb-4"},ei={class:"flex flex-wrap gap-2"},ti=["onClick"],ni={class:"p-8"},oi={class:"relative"},si={class:"absolute bottom-4 left-4 flex items-center gap-4"},ri={class:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-sm"},ai={class:"text-xs font-medium text-gray-600"},li={key:0,class:"px-3 py-1.5 rounded-lg bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-sm"},ii={class:"flex items-center gap-2"},ci={class:"w-24 h-1 bg-gray-100 rounded-full overflow-hidden"},di={class:"text-xs font-medium text-gray-600"},ui={class:"px-8 pb-8"},fi={class:"flex items-center justify-between"},pi=["disabled"],gi={key:0,class:"flex items-center justify-center py-20"},vi={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},mi=["onClick"],hi={class:"relative h-full bg-white/50 backdrop-blur-sm rounded-2xl border border-gray-200/50 p-6 hover:bg-white/80 hover:shadow-xl hover:shadow-emerald-500/10 transition-all duration-300 hover:-translate-y-1"},bi={class:"flex items-center gap-2 mb-4"},yi={key:0,class:"px-2.5 py-0.5 bg-gradient-to-r from-amber-100 to-orange-100 text-amber-700 text-xs rounded-full font-bold border border-amber-200/50"},xi={class:"text-xl font-semibold text-gray-900 mb-3 group-hover:text-emerald-700 transition-colors line-clamp-2"},wi={key:0,class:"flex items-center gap-2 text-sm text-gray-600 mb-4"},_i={class:"flex items-center justify-between pt-4 border-t border-gray-200/50"},ki={class:"flex items-center gap-1.5 text-sm text-gray-500"},Ci={key:2,class:"text-center py-20"},$i=P({__name:"ArticleInput",emits:["submit","article-click"],setup(e,{emit:t}){const o=t,s=B(""),r=B(null),{getDemoArticles:a,loading:l}=Kl(),i=B([]),v=[{label:"🤖 AI 技术",content:"人工智能正在深刻改变我们的生活方式。从自动驾驶汽车到智能家居，从医疗诊断到金融分析，AI 技术的应用已经渗透到社会的各个角落。然而，随着 AI 能力的不断提升，我们也面临着诸多挑战：如何确保 AI 系统的安全性和可控性？如何处理 AI 可能带来的就业冲击？如何在享受 AI 便利的同时保护个人隐私？这些问题需要技术专家、政策制定者和全社会共同思考和解决。"},{label:"📚 教育变革",content:"在线教育的兴起正在重塑传统的教育模式。学习者不再受限于地理位置和时间，可以随时随地访问全球最优质的教育资源。个性化学习成为可能，AI 助教能够根据每个学生的学习进度和特点提供定制化的辅导。然而，这种转变也带来了新的问题：如何确保在线学习的质量？如何维持学生的学习动力？如何培养批判性思维而不仅仅是知识的灌输？"},{label:"🌍 气候行动",content:"气候变化已成为人类面临的最严峻挑战之一。全球平均气温持续上升，极端天气事件频发，生物多样性加速丧失。为应对这一危机，各国政府纷纷制定碳中和目标，推动可再生能源发展，促进产业绿色转型。但仅靠政府行动还不够，企业需要承担更多社会责任，个人也应该从日常生活做起，减少碳足迹。只有全社会共同努力，才能为子孙后代留下一个宜居的地球。"}],f=M(()=>s.value.length),u=M(()=>f.value>=50),p=h=>{s.value=h},d=()=>{u.value&&o("submit",s.value)},c=()=>{r.value&&r.value.scrollIntoView({behavior:"smooth",block:"start"})},y=h=>{o("article-click",h)},x=h=>h>=1e4?`${(h/1e4).toFixed(1)}万`:h.toString(),w=async()=>{const h=await a(6,0);h&&(i.value=h.articles)};return ge(()=>{w()}),(h,m)=>{const b=Gl;return _(),C("div",Yl,[m[20]||(m[20]=n("div",{class:"absolute inset-0 bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px] opacity-50"},null,-1)),m[21]||(m[21]=n("div",{class:"absolute top-0 left-1/4 w-96 h-96 bg-emerald-500/20 rounded-full blur-[128px] animate-pulse"},null,-1)),m[22]||(m[22]=n("div",{class:"absolute bottom-0 right-1/4 w-96 h-96 bg-teal-500/20 rounded-full blur-[128px] animate-pulse",style:{"animation-delay":"1s"}},null,-1)),n("div",Xl,[m[18]||(m[18]=Me('<div class="text-center mb-16 space-y-8" data-v-ceb1df4d><div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/80 backdrop-blur-sm border border-gray-200/50 shadow-sm animate-fade-in" data-v-ceb1df4d><div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse" data-v-ceb1df4d></div><span class="text-sm font-medium text-gray-700" data-v-ceb1df4d>AI-Powered Reading Assistant</span></div><div class="space-y-4" data-v-ceb1df4d><h1 class="text-6xl md:text-7xl font-bold tracking-tight" data-v-ceb1df4d><span class="bg-clip-text text-transparent bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900" data-v-ceb1df4d> 深度理解 </span><br data-v-ceb1df4d><span class="bg-clip-text text-transparent bg-gradient-to-r from-emerald-600 via-teal-600 to-emerald-600" data-v-ceb1df4d> 每一个字 </span></h1><p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed" data-v-ceb1df4d> 划词提问，AI 即时解答。让阅读不再有困惑，让知识触手可及 </p></div><div class="flex items-center justify-center gap-8 text-sm" data-v-ceb1df4d><div class="flex items-center gap-2" data-v-ceb1df4d><svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20" data-v-ceb1df4d><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" data-v-ceb1df4d></path></svg><span class="text-gray-600" data-v-ceb1df4d>即时解答</span></div><div class="flex items-center gap-2" data-v-ceb1df4d><svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20" data-v-ceb1df4d><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" data-v-ceb1df4d></path></svg><span class="text-gray-600" data-v-ceb1df4d>深度分析</span></div><div class="flex items-center gap-2" data-v-ceb1df4d><svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20" data-v-ceb1df4d><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" data-v-ceb1df4d></path></svg><span class="text-gray-600" data-v-ceb1df4d>多维视角</span></div></div></div>',1)),n("div",Jl,[m[9]||(m[9]=n("div",{class:"absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-2xl opacity-0 group-hover:opacity-20 blur transition duration-500"},null,-1)),n("div",Ql,[n("div",Zl,[m[3]||(m[3]=n("div",{class:"flex items-center gap-2 mb-4"},[n("span",{class:"text-sm font-medium text-gray-500"},"快速开始"),n("div",{class:"flex-1 h-px bg-gradient-to-r from-gray-200 to-transparent"})],-1)),n("div",ei,[n("button",{onClick:c,class:"group/btn inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-emerald-50 to-teal-50 hover:from-emerald-100 hover:to-teal-100 border border-emerald-200 hover:border-emerald-300 transition-all text-sm font-medium text-emerald-700 hover:text-emerald-800 shadow-sm"},[...m[1]||(m[1]=[n("span",null,"✨",-1),n("span",null,"查看示例文章",-1),n("svg",{class:"w-4 h-4 opacity-100 transition-transform group-hover/btn:translate-y-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})],-1)])]),(_(),C(te,null,ie(v,k=>n("button",{key:k.label,onClick:$=>p(k.content),class:"group/btn inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-gray-50 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-teal-50 border border-gray-200/50 hover:border-emerald-200 transition-all text-sm font-medium text-gray-700 hover:text-emerald-700"},[n("span",null,E(k.label),1),m[2]||(m[2]=n("svg",{class:"w-4 h-4 opacity-0 group-hover/btn:opacity-100 -translate-x-2 group-hover/btn:translate-x-0 transition-all",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))],8,ti)),64))])]),m[8]||(m[8]=n("div",{class:"px-8"},[n("div",{class:"h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"})],-1)),n("div",ni,[n("div",oi,[O(b,{modelValue:g(s),"onUpdate:modelValue":m[0]||(m[0]=k=>ye(s)?s.value=k:null),placeholder:`在此粘贴文章内容，或使用上方示例快速体验...

支持的内容：新闻报道、学术论文、技术博客、产品文档等任何文本内容`,class:"min-h-[320px] text-base leading-relaxed resize-none border-0 bg-transparent focus:ring-0 focus:outline-none placeholder:text-gray-400 text-gray-700",onKeydown:Yt(_e(d,["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"]),n("div",si,[n("div",ri,[n("div",{class:D(["w-1.5 h-1.5 rounded-full transition-colors",g(u)?"bg-emerald-500 shadow-sm shadow-emerald-500/50":"bg-gray-300"])},null,2),n("span",ai,E(g(f))+" 字符 ",1)]),g(f)>0?(_(),C("div",li,[n("div",ii,[n("div",ci,[n("div",{class:"h-full bg-gradient-to-r from-emerald-500 to-teal-500 transition-all duration-300",style:ve({width:`${Math.min(g(f)/50*100,100)}%`})},null,4)]),n("span",di,E(Math.min(Math.floor(g(f)/50*100),100))+"% ",1)])])):L("",!0)]),m[4]||(m[4]=n("div",{class:"absolute bottom-4 right-4 flex items-center gap-1.5 text-xs text-gray-400"},[n("kbd",{class:"px-2 py-1 bg-white/90 border border-gray-200/50 rounded shadow-sm font-medium text-gray-600"},"⌘"),n("span",null,"+"),n("kbd",{class:"px-2 py-1 bg-white/90 border border-gray-200/50 rounded shadow-sm font-medium text-gray-600"},"Enter")],-1))])]),n("div",ui,[m[7]||(m[7]=n("div",{class:"h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-6"},null,-1)),n("div",fi,[m[6]||(m[6]=n("div",{class:"flex items-center gap-2 text-sm text-gray-500"},[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),n("span",null,"你的内容安全且私密")],-1)),n("button",{onClick:d,disabled:!g(u),class:"group relative inline-flex items-center gap-2 px-8 py-3.5 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 disabled:from-gray-300 disabled:to-gray-300 shadow-lg shadow-emerald-500/25 hover:shadow-xl hover:shadow-emerald-500/30 disabled:shadow-none transition-all duration-300 hover:scale-105 disabled:scale-100 disabled:cursor-not-allowed"},[...m[5]||(m[5]=[n("span",null,"开始阅读",-1),n("svg",{class:"w-5 h-5 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),n("div",{class:"absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-1000"},null,-1)])],8,pi)])])])]),m[19]||(m[19]=Me('<div class="mt-20 grid grid-cols-1 md:grid-cols-3 gap-6" data-v-ceb1df4d><div class="group relative p-6 rounded-xl bg-white/50 backdrop-blur-sm border border-gray-200/50 hover:bg-white/80 hover:shadow-lg hover:shadow-gray-200/50 transition-all duration-300" data-v-ceb1df4d><div class="flex items-start gap-4" data-v-ceb1df4d><div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform" data-v-ceb1df4d><svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ceb1df4d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" data-v-ceb1df4d></path></svg></div><div data-v-ceb1df4d><h3 class="font-semibold text-gray-900 mb-2" data-v-ceb1df4d>即时理解</h3><p class="text-sm text-gray-600 leading-relaxed" data-v-ceb1df4d>选中任意文字，AI 立即提供深度解析，让复杂概念变得清晰易懂</p></div></div></div><div class="group relative p-6 rounded-xl bg-white/50 backdrop-blur-sm border border-gray-200/50 hover:bg-white/80 hover:shadow-lg hover:shadow-gray-200/50 transition-all duration-300" data-v-ceb1df4d><div class="flex items-start gap-4" data-v-ceb1df4d><div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform" data-v-ceb1df4d><svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ceb1df4d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" data-v-ceb1df4d></path></svg></div><div data-v-ceb1df4d><h3 class="font-semibold text-gray-900 mb-2" data-v-ceb1df4d>多维视角</h3><p class="text-sm text-gray-600 leading-relaxed" data-v-ceb1df4d>从不同角度分析内容，探索反面观点，培养批判性思维</p></div></div></div><div class="group relative p-6 rounded-xl bg-white/50 backdrop-blur-sm border border-gray-200/50 hover:bg-white/80 hover:shadow-lg hover:shadow-gray-200/50 transition-all duration-300" data-v-ceb1df4d><div class="flex items-start gap-4" data-v-ceb1df4d><div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform" data-v-ceb1df4d><svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ceb1df4d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" data-v-ceb1df4d></path></svg></div><div data-v-ceb1df4d><h3 class="font-semibold text-gray-900 mb-2" data-v-ceb1df4d>智能记录</h3><p class="text-sm text-gray-600 leading-relaxed" data-v-ceb1df4d>自动保存你的提问和洞察，随时回顾学习历程</p></div></div></div></div>',1)),n("div",{ref_key:"demoArticlesSection",ref:r,class:"mt-24"},[m[17]||(m[17]=Me('<div class="text-center mb-12" data-v-ceb1df4d><div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-50/80 backdrop-blur-sm border border-emerald-200/50 shadow-sm mb-6" data-v-ceb1df4d><div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse" data-v-ceb1df4d></div><span class="text-sm font-medium text-emerald-700" data-v-ceb1df4d>无需注册，立即体验</span></div><h2 class="text-4xl md:text-5xl font-bold mb-4" data-v-ceb1df4d><span class="bg-clip-text text-transparent bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900" data-v-ceb1df4d> 精选示例文章 </span></h2><p class="text-lg text-gray-600 max-w-2xl mx-auto" data-v-ceb1df4d> 探索 InsightReader 的强大分析能力，一键体验完整的 AI 辅助阅读流程 </p></div>',1)),g(l)?(_(),C("div",gi,[...m[10]||(m[10]=[n("div",{class:"animate-spin h-12 w-12 border-4 border-emerald-600 border-t-transparent rounded-full"},null,-1)])])):g(i)&&g(i).length>0?(_(),C("div",vi,[(_(!0),C(te,null,ie(g(i),k=>(_(),C("div",{key:k.id,onClick:$=>y(k.id),class:"group relative cursor-pointer"},[m[15]||(m[15]=n("div",{class:"absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-2xl opacity-0 group-hover:opacity-20 blur transition duration-500"},null,-1)),n("div",hi,[n("div",bi,[m[11]||(m[11]=n("span",{class:"px-3 py-1 bg-gradient-to-r from-emerald-100 to-teal-100 text-emerald-700 text-xs rounded-full font-medium border border-emerald-200/50"}," 示例文章 ",-1)),k.demo_order?(_(),C("span",yi," #"+E(k.demo_order),1)):L("",!0)]),n("h3",xi,E(k.title),1),k.author?(_(),C("div",wi,[m[12]||(m[12]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),n("span",null,E(k.author),1)])):L("",!0),n("div",_i,[n("div",ki,[m[13]||(m[13]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),n("span",null,E(x(k.word_count||0))+" 字",1)]),m[14]||(m[14]=n("div",{class:"flex items-center gap-2 text-sm font-medium text-emerald-600 group-hover:text-emerald-700"},[n("span",null,"立即体验"),n("svg",{class:"w-4 h-4 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})])],-1))])])],8,mi))),128))])):(_(),C("div",Ci,[...m[16]||(m[16]=[Me('<div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center" data-v-ceb1df4d><svg class="w-10 h-10 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-ceb1df4d><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" data-v-ceb1df4d></path></svg></div><h3 class="text-xl font-semibold text-gray-900 mb-2" data-v-ceb1df4d>暂无示例文章</h3><p class="text-gray-600" data-v-ceb1df4d>管理员正在精心准备示例内容...</p>',3)])]))],512)])])}}}),Si=Object.assign(Se($i,[["__scopeId","data-v-ceb1df4d"]]),{__name:"ArticleInput"}),Et=()=>{const e=U("selected-text",()=>""),t=U("selection-context",()=>""),o=U("selection-position",()=>({x:0,y:0})),s=U("show-intent-buttons",()=>!1),r=U("selected-start",()=>null),a=U("selected-end",()=>null),l=M(()=>{const u=e.value.length;return u<5?"explain":u>50||/因为|所以|由于|导致/.test(e.value)?"analyze":"explain"}),i=u=>{const{content:p}=Ve(),d=p.value;if(!d||!u)return null;const c=d.indexOf(u);return c===-1?(console.warn("⚠️ 无法在文章中找到选中的文本"),null):{start:c,end:c+u.length}};return{selectedText:e,context:t,position:o,showIntentButtons:s,suggestedIntent:l,selectedStart:r,selectedEnd:a,handleSelection:()=>{const u=window.getSelection(),p=u?.toString().trim();if(p&&p.length>0){e.value=p;const{content:d}=Ve();t.value=Ss(d.value,p);const c=i(p);c&&(r.value=c.start,a.value=c.end,console.log("📍 选中位置:",c.start,"-",c.end));const x=u?.getRangeAt(0)?.getBoundingClientRect();x&&(o.value={x:x.left+x.width/2,y:x.bottom+10})}},clear:()=>{e.value="",t.value="",r.value=null,a.value=null,s.value=!1,window.getSelection()?.removeAllRanges()}}},No=()=>{const e=d=>{d=d.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const c=/([。！？!?.…]+[\s\n]|[\n])/g,y=d.split(c),x=[];let w="";for(let m=0;m<y.length;m++){const b=y[m];if(b)if(c.test(b)){if(w+=b,t(w,y[m+1])){const k=w.trim();k.length>0&&(x.push(k),w="")}}else w+=b}const h=w.trim();return h.length>0&&x.push(h),x.filter(m=>m.length>0)},t=(d,c)=>{if(d.endsWith(`
`))return!0;const y=["Mr.","Mrs.","Ms.","Dr.","Prof.","Sr.","Jr.","etc.","vs.","e.g.","i.e.","U.S.","U.K.","Inc.","Ltd.","Co.","Corp."];for(const x of y)if(d.trim().endsWith(x)&&c&&/^[a-z]/.test(c.trim()))return!1;return!0},o=d=>{const c=d.split(/\n\n+/).filter(w=>w.trim().length>0),y=[];let x=0;return c.forEach((w,h)=>{const b=e(w).map(k=>({index:x++,text:k,paragraphIndex:h}));y.push({index:h,sentences:b})}),y},s=d=>{const c=tt(d,{breaks:!0,gfm:!0}),y=document.createElement("div");y.innerHTML=c;const x=y.textContent||"",w=o(x);let h="";return w.forEach(m=>{h+=`<p data-paragraph-index="${m.index}" class="article-paragraph">`,m.sentences.forEach(b=>{h+=`<span id="sentence-${b.index}" data-sentence-index="${b.index}" class="article-sentence">${i(b.text)}</span>`}),h+="</p>"}),h},r=d=>{const c=o(d);let y="";return c.forEach(x=>{y+=`<p data-paragraph-index="${x.index}" class="article-paragraph">`,x.sentences.forEach(w=>{y+=`<span id="sentence-${w.index}" data-sentence-index="${w.index}" class="article-sentence">${i(w.text)}</span>`}),y+="</p>"}),y},a=d=>[/^#{1,6}\s/m,/\*\*.*\*\*/,/\*.*\*/,/\[.*\]\(.*\)/,/```[\s\S]*```/,/^[-*+]\s/m,/^\d+\.\s/m,/^>\s/m,/!\[.*\]\(.*\)/].some(y=>y.test(d)),l=d=>d?a(d)?(console.log("📝 检测到 Markdown 格式，使用 Markdown 渲染"),s(d)):(console.log("📝 使用纯文本渲染"),r(d)):"",i=d=>{const c=document.createElement("div");return c.textContent=d,c.innerHTML};return{renderArticleWithSentenceIds:l,extractSentenceData:d=>{let c=d;if(a(d)){const y=tt(d,{breaks:!0,gfm:!0}),x=document.createElement("div");x.innerHTML=y,c=x.textContent||""}return o(c)},renderWithBackendSentences:d=>{if(!d||d.length===0)return"";console.log(`📝 使用后端分句结果重新渲染，共 ${d.length} 个句子`);let c="",y=[],x=0;const w=()=>{y.length>0&&(c+=`<p data-paragraph-index="${x}" class="article-paragraph">`,c+=y.join(""),c+="</p>",y=[],x++)};return d.forEach((h,m)=>{const b=`<span id="sentence-${m}" data-sentence-index="${m}" class="article-sentence">${i(h)} </span>`;y.push(b),(m+1)%10===0&&w()}),w(),c},splitIntoSentences:e,splitIntoParagraphs:o,getSentenceElement:d=>document.getElementById(`sentence-${d}`),cleanContent:d=>{const c=document.createElement("div");return c.innerHTML=d,c.querySelectorAll('[id^="sentence-"]').forEach(x=>{const w=x.textContent||"";x.replaceWith(document.createTextNode(w))}),c.textContent||""},isMarkdown:a,escapeHtml:i}},Ne={serif:'ui-serif, Georgia, Cambria, "Times New Roman", Times, serif',sansSerif:'ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',songti:'"Songti SC", "SimSun", "宋体", serif',heiti:'"Heiti SC", "SimHei", "黑体", sans-serif',kaiti:'"Kaiti SC", "KaiTi", "楷体", serif',cangErJinKai:'"TsangerJinKai03", "KaiTi", "楷体", serif'},et={small:"16px",medium:"22px",large:"28px",xlarge:"36px"},to={small:"1.8",medium:"2.0",large:"2.1",xlarge:"2.0"},no="reading-settings",Ai=()=>{const e={fontFamily:Ne.cangErJinKai,fontSize:et.medium,lineHeight:to.medium,singleSentencePerLine:!0},t=()=>{try{const d=localStorage.getItem(no);if(d)return{...e,...JSON.parse(d)}}catch(d){console.error("加载阅读设置失败:",d)}return e},o=d=>{try{localStorage.setItem(no,JSON.stringify(d))}catch(c){console.error("保存阅读设置失败:",c)}},s=U("reading-settings",()=>t()),r=d=>{s.value.fontFamily=Ne[d],o(s.value)},a=d=>{s.value.fontSize=et[d],s.value.lineHeight=to[d],o(s.value)},l=()=>{s.value={...e},o(s.value)},i=()=>[{key:"cangErJinKai",label:"仓耳今楷",family:Ne.cangErJinKai},{key:"songti",label:"宋体",family:Ne.songti},{key:"heiti",label:"黑体",family:Ne.heiti},{key:"kaiti",label:"楷体",family:Ne.kaiti},{key:"serif",label:"衬线体",family:Ne.serif},{key:"sansSerif",label:"无衬线",family:Ne.sansSerif}],v=()=>[{key:"small",label:"小",size:et.small},{key:"medium",label:"中",size:et.medium},{key:"large",label:"大",size:et.large},{key:"xlarge",label:"特大",size:et.xlarge}],f=()=>{const d=Object.entries(Ne).find(([c,y])=>y===s.value.fontFamily);return d?d[0]:"cangErJinKai"},u=()=>{const d=Object.entries(et).find(([c,y])=>y===s.value.fontSize);return d?d[0]:"medium"},p=()=>{s.value={...s.value,singleSentencePerLine:!s.value.singleSentencePerLine},o(s.value)};return{settings:le(s),setFontFamily:r,setFontSize:a,resetSettings:l,getFontOptions:i,getFontSizeOptions:v,getCurrentFontKey:f,getCurrentSizeKey:u,toggleSingleSentencePerLine:p}},Mi={class:"max-w-3xl mx-auto px-12 py-16"},Ei={key:0,class:"mb-16 animate-fade-in"},Ti={class:"flex items-center justify-between"},Li={class:"flex items-center gap-6 text-sm text-gray-500"},Bi={class:"flex items-center gap-2"},Ii={class:"flex items-center gap-2"},Ri={key:0,class:"mt-6 bg-white rounded-xl border border-gray-200 shadow-lg p-6"},Oi={class:"space-y-5"},Pi={class:"grid grid-cols-3 gap-2"},Hi=["onClick"],zi={class:"grid grid-cols-4 gap-2"},ji=["onClick"],Di={class:"flex items-center justify-between cursor-pointer group"},qi={class:"relative"},Ni=["checked"],Vi={class:"flex items-center justify-between pt-2"},Fi={class:"max-w-none animate-fade-in",style:{"animation-delay":"0.1s"}},Wi=["innerHTML"],Ui=P({__name:"ArticlePane",props:{content:{},title:{}},setup(e){const t=e,{handleSelection:o}=Et(),{renderArticleWithSentenceIds:s}=No(),{settings:r,setFontFamily:a,setFontSize:l,resetSettings:i,getFontOptions:v,getFontSizeOptions:f,getCurrentFontKey:u,getCurrentSizeKey:p,toggleSingleSentencePerLine:d}=Ai(),c=B(null),y=B(!1),x=v(),w=f(),h=M(()=>u()),m=M(()=>p()),b=M(()=>t.content?s(t.content):""),k=M(()=>t.content),$=M(()=>k.value.replace(/\s/g,"").length),I=()=>{setTimeout(()=>{o()},10)};return(S,A)=>(_(),C("div",Mi,[e.title?(_(),C("div",Ei,[A[14]||(A[14]=n("div",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-50 border border-emerald-100 mb-6"},[n("div",{class:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),n("span",{class:"text-xs font-medium text-emerald-700"},"正在阅读")],-1)),n("h1",{class:"text-5xl font-bold text-gray-900 leading-tight mb-6 tracking-tight",style:ve({fontFamily:g(r).fontFamily})},E(e.title),5),n("div",Ti,[n("div",Li,[A[6]||(A[6]=Me('<div class="flex items-center gap-2" data-v-94674f16><div class="w-8 h-8 rounded-full bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center" data-v-94674f16><svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-94674f16><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" data-v-94674f16></path></svg></div><span class="font-medium" data-v-94674f16>深度阅读</span></div><div class="flex items-center gap-2" data-v-94674f16><div class="w-px h-4 bg-gray-300" data-v-94674f16></div></div>',2)),n("div",Bi,[A[4]||(A[4]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),n("span",null,E(g($))+" 字",1)]),n("div",Ii,[A[5]||(A[5]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),n("span",null,"约 "+E(Math.ceil(g($)/400))+" 分钟",1)])]),n("button",{onClick:A[0]||(A[0]=R=>y.value=!g(y)),class:"flex items-center gap-2 px-3 py-1.5 rounded-lg hover:bg-gray-100 transition-colors group text-sm text-gray-600",title:"阅读设置"},[...A[7]||(A[7]=[n("svg",{class:"w-4 h-4 group-hover:text-emerald-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1),n("span",{class:"group-hover:text-emerald-600 transition-colors"},"阅读设置",-1)])])]),A[15]||(A[15]=n("div",{class:"mt-6 h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"},null,-1)),O(de,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:T(()=>[g(y)?(_(),C("div",Ri,[n("div",Oi,[n("div",null,[A[8]||(A[8]=n("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," 字体 ",-1)),n("div",Pi,[(_(!0),C(te,null,ie(g(x),R=>(_(),C("button",{key:R.key,onClick:V=>g(a)(R.key),class:D(["px-3 py-2 text-sm rounded-lg border-2 transition-all",g(h)===R.key?"border-emerald-500 bg-emerald-50 text-emerald-700 font-semibold":"border-gray-200 hover:border-gray-300 text-gray-700"]),style:ve({fontFamily:R.family})},E(R.label),15,Hi))),128))])]),n("div",null,[A[9]||(A[9]=n("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," 字号 ",-1)),n("div",zi,[(_(!0),C(te,null,ie(g(w),R=>(_(),C("button",{key:R.key,onClick:V=>g(l)(R.key),class:D(["px-3 py-2 text-sm rounded-lg border-2 transition-all",g(m)===R.key?"border-emerald-500 bg-emerald-50 text-emerald-700 font-semibold":"border-gray-200 hover:border-gray-300 text-gray-700"])},E(R.label),11,ji))),128))])]),n("div",null,[n("label",Di,[A[12]||(A[12]=n("div",{class:"flex items-center gap-3"},[n("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})]),n("div",null,[n("span",{class:"text-sm font-medium text-gray-700"},"单句成行"),n("p",{class:"text-xs text-gray-500"},"每个句子独立显示为一行")])],-1)),n("div",qi,[n("input",{type:"checkbox",checked:g(r).singleSentencePerLine,onChange:A[1]||(A[1]=(...R)=>g(d)&&g(d)(...R)),class:"sr-only peer"},null,40,Ni),A[10]||(A[10]=n("div",{class:"w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-emerald-600 transition-colors"},null,-1)),A[11]||(A[11]=n("div",{class:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"},null,-1))])])]),n("div",Vi,[n("button",{onClick:A[2]||(A[2]=(...R)=>g(i)&&g(i)(...R)),class:"text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1"},[...A[13]||(A[13]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),ne(" 恢复默认 ",-1)])]),n("button",{onClick:A[3]||(A[3]=R=>y.value=!1),class:"px-4 py-2 bg-emerald-600 text-white text-sm rounded-lg hover:bg-emerald-700 transition-colors"}," 完成 ")])])])):L("",!0)]),_:1})])):L("",!0),n("article",Fi,[n("div",{id:"article-content-container",ref_key:"articleContentRef",ref:c,class:D(["article-content select-text",{"single-sentence-per-line":g(r).singleSentencePerLine}]),style:ve({fontFamily:g(r).fontFamily,fontSize:g(r).fontSize,lineHeight:g(r).lineHeight,textRendering:"optimizeLegibility",WebkitFontSmoothing:"antialiased"}),onMouseup:I,innerHTML:g(b)},null,46,Wi)]),A[16]||(A[16]=Me('<div class="mt-20 pt-8 animate-fade-in" style="animation-delay:0.2s;" data-v-94674f16><div class="relative group" data-v-94674f16><div class="absolute -inset-4 bg-gradient-to-r from-emerald-50 via-teal-50 to-emerald-50 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-xl" data-v-94674f16></div><div class="relative flex flex-col items-center gap-4 p-8 rounded-2xl bg-gradient-to-br from-white to-gray-50 border border-gray-100 shadow-sm" data-v-94674f16><div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center" data-v-94674f16><svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-94674f16><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" data-v-94674f16></path></svg></div><div class="text-center" data-v-94674f16><p class="text-sm font-semibold text-gray-900 mb-1" data-v-94674f16>开始提问吧！</p><p class="text-sm text-gray-600" data-v-94674f16>选中任意文字，让 AI 帮你深度理解内容</p></div><div class="flex items-center gap-2 text-xs text-gray-500" data-v-94674f16><kbd class="px-2 py-1 bg-white border border-gray-200 rounded shadow-sm font-medium text-gray-600" data-v-94674f16>Shift</kbd><span data-v-94674f16>+</span><span data-v-94674f16>鼠标选择</span></div></div></div></div>',1))]))}}),Gi=Object.assign(Se(Ui,[["__scopeId","data-v-94674f16"]]),{__name:"ArticlePane"}),Ki={class:"mb-4 bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-5 shadow-sm hover:shadow-md transition-all"},Yi={class:"flex items-center justify-between mb-3"},Xi={class:"flex items-center gap-2"},Ji={class:"text-sm font-semibold text-gray-800"},Qi={key:0,class:"flex items-center gap-1"},Zi={class:"w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden"},ec={class:"text-xs text-gray-500"},tc={class:"space-y-2"},nc={class:"mt-3 flex items-center justify-end gap-2"},oc=P({__name:"MetaInfoCard",props:{title:{},icon:{},iconBgClass:{},confidence:{}},emits:["feedback"],setup(e,{emit:t}){const o=e,s=B(null),r=M(()=>o.confidence===void 0||o.confidence===null?"":o.confidence>=.8?"bg-emerald-500":o.confidence>=.6?"bg-yellow-500":"bg-orange-500");return(a,l)=>(_(),C("div",Ki,[n("div",Yi,[n("div",Xi,[n("div",{class:D(["w-8 h-8 rounded-lg flex items-center justify-center",e.iconBgClass])},[(_(),j($n(e.icon),{class:"w-5 h-5 text-white"}))],2),n("h4",Ji,E(e.title),1)]),e.confidence!==void 0&&e.confidence!==null?(_(),C("div",Qi,[n("div",Zi,[n("div",{class:D(["h-full rounded-full transition-all",r.value]),style:ve({width:`${e.confidence*100}%`})},null,6)]),n("span",ec,E(Math.round(e.confidence*100))+"%",1)])):L("",!0)]),n("div",tc,[Y(a.$slots,"default")]),n("div",nc,[n("button",{onClick:l[0]||(l[0]=i=>a.$emit("feedback","helpful")),class:D(["p-1.5 rounded-lg transition-colors",s.value==="helpful"?"bg-emerald-100":"hover:bg-gray-100"]),title:"有帮助"},[(_(),C("svg",{class:D(["w-4 h-4 transition-colors",s.value==="helpful"?"text-emerald-600":"text-gray-400 hover:text-emerald-600"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...l[2]||(l[2]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"},null,-1)])],2))],2),n("button",{onClick:l[1]||(l[1]=i=>a.$emit("feedback","not-helpful")),class:D(["p-1.5 rounded-lg transition-colors",s.value==="not-helpful"?"bg-red-100":"hover:bg-gray-100"]),title:"不准确"},[(_(),C("svg",{class:D(["w-4 h-4 transition-colors",s.value==="not-helpful"?"text-red-600":"text-gray-400 hover:text-red-600"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...l[3]||(l[3]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"},null,-1)])],2))],2)])]))}}),dn=Object.assign(oc,{__name:"MetaInfoCard"}),sc={class:"flex items-center gap-2 mb-3"},rc={class:"flex items-center gap-1 text-sm text-gray-500"},ac={class:"text-base text-gray-700 leading-relaxed mb-3"},lc={key:0,class:"mt-3"},ic={class:"space-y-1.5"},cc={class:"mt-4 p-3 bg-violet-50/50 rounded-lg border border-violet-200/50"},dc={class:"text-sm text-violet-800"},uc=P({__name:"AuthorIntentCard",props:{authorIntent:{}},emits:["feedback"],setup(e,{emit:t}){const o={template:`
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  `},s=e,r={inform:"告知",persuade:"说服",entertain:"娱乐",provoke:"激发思考"},a={inform:"作者主要目的是传达信息、解释概念或分享知识",persuade:"作者试图说服读者接受某种观点或采取某种行动",entertain:"作者以娱乐、引起兴趣或愉悦读者为主要目的",provoke:"作者旨在激发读者的批判性思维或引发深度思考"},l={inform:"bg-blue-100 text-blue-700",persuade:"bg-orange-100 text-orange-700",entertain:"bg-pink-100 text-pink-700",provoke:"bg-purple-100 text-purple-700"},i=M(()=>r[s.authorIntent.primary]||s.authorIntent.primary),v=M(()=>a[s.authorIntent.primary]||""),f=M(()=>l[s.authorIntent.primary]||"bg-gray-100 text-gray-700");return(u,p)=>{const d=dn;return _(),j(d,{title:"作者意图",icon:o,confidence:e.authorIntent.confidence,"icon-bg-class":"bg-gradient-to-br from-violet-500 to-purple-600",onFeedback:p[0]||(p[0]=c=>u.$emit("feedback",c))},{default:T(()=>[n("div",sc,[n("span",{class:D(["px-3 py-1.5 text-sm font-medium rounded-full",f.value])},E(i.value),3),n("div",rc,[p[1]||(p[1]=n("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1)),n("span",null,E(Math.round(e.authorIntent.confidence*100))+"% 置信度",1)])]),n("p",ac,E(e.authorIntent.description),1),e.authorIntent.indicators&&e.authorIntent.indicators.length>0?(_(),C("div",lc,[p[3]||(p[3]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-4 h-4 text-violet-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),n("span",{class:"text-sm font-medium text-gray-600"},"识别依据")],-1)),n("ul",ic,[(_(!0),C(te,null,ie(e.authorIntent.indicators,(c,y)=>(_(),C("li",{key:y,class:"text-sm text-gray-600 flex items-start gap-2"},[p[2]||(p[2]=n("svg",{class:"w-2 h-2 text-violet-500 mt-1.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 8 8"},[n("circle",{cx:"4",cy:"4",r:"3"})],-1)),n("span",null,E(c),1)]))),128))])])):L("",!0),n("div",cc,[n("p",dc,[n("strong",null,E(i.value),1),ne(": "+E(v.value),1)])])]),_:1},8,["confidence"])}}}),fc=Object.assign(uc,{__name:"AuthorIntentCard"}),pc={class:"flex items-center gap-2 mb-3"},gc={class:"mb-3"},vc={class:"flex items-center justify-between text-sm text-gray-600 mb-1"},mc={class:"font-medium"},hc={class:"relative h-2 bg-gray-200 rounded-full overflow-hidden"},bc={class:"space-y-2 text-base"},yc={class:"flex items-center justify-between"},xc={class:"font-medium text-gray-800"},wc={class:"flex items-center justify-between"},_c={key:0,class:"flex items-center justify-between"},kc={class:"font-medium text-gray-800"},Cc={key:0,class:"mt-4 p-3 bg-amber-50/50 rounded-lg border border-amber-200/50"},$c={class:"space-y-1"},Sc={class:"mt-4 p-3 bg-gradient-to-r from-amber-50/50 to-orange-50/50 rounded-lg border border-amber-200/50"},Ac={class:"flex items-start gap-2"},Mc={class:"text-sm text-amber-800"},Ec=P({__name:"TimelinessCard",props:{timelinessAnalysis:{},timelinessScore:{}},emits:["feedback"],setup(e,{emit:t}){const o={template:`
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  `},s=e,r={timeless:"永恒内容",evergreen:"常青内容","time-sensitive":"时效敏感",breaking:"突发新闻"},a={low:"缓慢衰减",medium:"中等衰减",high:"快速衰减"},l={timeless:"bg-emerald-100 text-emerald-700",evergreen:"bg-green-100 text-green-700","time-sensitive":"bg-orange-100 text-orange-700",breaking:"bg-red-100 text-red-700"},i={low:"text-emerald-600",medium:"text-orange-600",high:"text-red-600"},v=M(()=>r[s.timelinessAnalysis.category]||s.timelinessAnalysis.category),f=M(()=>a[s.timelinessAnalysis.decay_rate]||s.timelinessAnalysis.decay_rate),u=M(()=>l[s.timelinessAnalysis.category]||"bg-gray-100 text-gray-700"),p=M(()=>i[s.timelinessAnalysis.decay_rate]||"text-gray-600"),d=M(()=>s.timelinessScore>=.7?"bg-gradient-to-r from-orange-500 to-red-500":s.timelinessScore>=.4?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-green-500"),c=x=>{try{return new Date(x).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}catch{return x}},y=M(()=>{const x=s.timelinessAnalysis.category;return x==="timeless"?"这是永恒内容，任何时候阅读都有价值":x==="evergreen"?"这是常青内容，长期保持相关性，值得收藏":x==="time-sensitive"?"这是时效性内容，建议尽快阅读以获取最新价值":x==="breaking"?"这是突发新闻，信息快速变化，需及时了解后续发展":"建议结合发布时间判断内容的当前价值"});return(x,w)=>{const h=dn;return _(),j(h,{title:"时效性评估",icon:o,confidence:e.timelinessScore,"icon-bg-class":"bg-gradient-to-br from-amber-500 to-orange-600",onFeedback:w[0]||(w[0]=m=>x.$emit("feedback",m))},{default:T(()=>[n("div",pc,[n("span",{class:D(["px-3 py-1.5 text-sm font-medium rounded-full",u.value])},E(v.value),3),n("span",{class:D(["text-sm font-medium",p.value])},E(f.value),3)]),n("div",gc,[n("div",vc,[w[1]||(w[1]=n("span",null,"时效敏感度",-1)),n("span",mc,E(Math.round(e.timelinessScore*100))+"%",1)]),n("div",hc,[n("div",{class:D(["h-full rounded-full transition-all",d.value]),style:ve({width:`${e.timelinessScore*100}%`})},null,6)]),w[2]||(w[2]=n("div",{class:"flex items-center justify-between text-xs text-gray-500 mt-1"},[n("span",null,"永恒内容"),n("span",null,"高度时效")],-1))]),n("div",bc,[n("div",yc,[w[3]||(w[3]=n("span",{class:"text-gray-600"},"内容类型:",-1)),n("span",xc,E(v.value),1)]),n("div",wc,[w[4]||(w[4]=n("span",{class:"text-gray-600"},"信息衰减:",-1)),n("span",{class:D(["font-medium",p.value])},E(f.value),3)]),e.timelinessAnalysis.best_before?(_(),C("div",_c,[w[5]||(w[5]=n("span",{class:"text-gray-600"},"有效期至:",-1)),n("span",kc,E(c(e.timelinessAnalysis.best_before)),1)])):L("",!0)]),e.timelinessAnalysis.context_dependencies&&e.timelinessAnalysis.context_dependencies.length>0?(_(),C("div",Cc,[w[7]||(w[7]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-4 h-4 text-amber-700",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),n("span",{class:"text-sm font-medium text-amber-800"},"时效性依赖")],-1)),n("ul",$c,[(_(!0),C(te,null,ie(e.timelinessAnalysis.context_dependencies,(m,b)=>(_(),C("li",{key:b,class:"text-sm text-amber-700 flex items-start gap-1.5"},[w[6]||(w[6]=n("svg",{class:"w-2 h-2 text-amber-700 mt-1.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 8 8"},[n("circle",{cx:"4",cy:"4",r:"3"})],-1)),n("span",null,E(m),1)]))),128))])])):L("",!0),n("div",Sc,[n("div",Ac,[w[9]||(w[9]=n("svg",{class:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)),n("p",Mc,[w[8]||(w[8]=n("strong",null,"阅读建议:",-1)),ne(" "+E(y.value),1)])])])]),_:1},8,["confidence"])}}}),Tc=Object.assign(Ec,{__name:"TimelinessCard"}),Lc={class:"mb-3"},Bc={key:0,class:"flex items-center gap-2 p-3 bg-emerald-50 rounded-lg border border-emerald-200"},Ic={key:1,class:"flex items-center gap-2 p-3 bg-rose-50 rounded-lg border border-rose-200"},Rc={key:0,class:"mb-3"},Oc={class:"flex flex-wrap gap-2"},Pc={key:1,class:"mb-3"},Hc={class:"flex items-center justify-between text-sm text-gray-600 mb-1"},zc={class:"relative h-2 bg-gray-200 rounded-full overflow-hidden"},jc={class:"flex items-center justify-between text-sm mb-3"},Dc={key:2,class:"mt-4"},qc={class:"space-y-2"},Nc={class:"flex items-start gap-2 mb-1.5"},Vc={class:"px-2 py-0.5 bg-rose-200 text-rose-800 text-xs font-medium rounded"},Fc={class:"text-sm text-gray-700 italic mb-1.5"},Wc={class:"text-sm text-rose-700"},Uc={class:"mt-4 p-3 bg-gradient-to-r from-rose-50/50 to-pink-50/50 rounded-lg border border-rose-200/50"},Gc={class:"flex items-start gap-2"},Kc={class:"text-sm text-rose-800"},Yc=P({__name:"BiasCard",props:{biasAnalysis:{}},emits:["feedback"],setup(e,{emit:t}){const o={template:`
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
  `},s=e,r={confirmation_bias:"确认偏误",political_bias:"政治倾向",cultural_bias:"文化偏见",selection_bias:"选择性偏见",anchoring_bias:"锚定效应",availability_bias:"可得性偏见"},a={low:"轻微",medium:"中等",high:"严重"},l={balanced:"平衡",slightly_biased:"略有偏向",heavily_biased:"明显偏向"},i=M(()=>a[s.biasAnalysis.severity]||s.biasAnalysis.severity),v=M(()=>l[s.biasAnalysis.overall_balance]||s.biasAnalysis.overall_balance),f=M(()=>{switch(s.biasAnalysis.severity){case"low":return"text-yellow-600";case"medium":return"text-orange-600";case"high":return"text-red-600";default:return"text-gray-600"}}),u=M(()=>{switch(s.biasAnalysis.severity){case"low":return"bg-yellow-500";case"medium":return"bg-orange-500";case"high":return"bg-red-500";default:return"bg-gray-500"}}),p=M(()=>{switch(s.biasAnalysis.severity){case"low":return"33%";case"medium":return"66%";case"high":return"100%";default:return"0%"}}),d=M(()=>{switch(s.biasAnalysis.overall_balance){case"balanced":return"text-emerald-600";case"slightly_biased":return"text-orange-600";case"heavily_biased":return"text-red-600";default:return"text-gray-600"}}),c=M(()=>s.biasAnalysis.detected?s.biasAnalysis.severity==="high"?"检测到严重偏见，请格外警惕，建议对照其他来源验证信息":s.biasAnalysis.severity==="medium"?"检测到一定程度的偏见，建议注意作者的观点立场":"检测到轻微偏见，阅读时注意区分事实与观点":"文章未检测到明显偏见，但仍建议保持批判性思维");return(y,x)=>{const w=dn;return _(),j(w,{title:"潜在偏见检测",icon:o,confidence:e.biasAnalysis.detected?.8:.9,"icon-bg-class":"bg-gradient-to-br from-rose-500 to-pink-600",onFeedback:x[0]||(x[0]=h=>y.$emit("feedback",h))},{default:T(()=>[n("div",Lc,[e.biasAnalysis.detected?(_(),C("div",Ic,[...x[2]||(x[2]=[n("svg",{class:"w-5 h-5 text-rose-600 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),n("div",null,[n("p",{class:"text-base font-medium text-rose-800"},"检测到潜在偏见"),n("p",{class:"text-sm text-rose-700 mt-0.5"},"建议批判性阅读")],-1)])])):(_(),C("div",Bc,[...x[1]||(x[1]=[n("svg",{class:"w-5 h-5 text-emerald-600 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),n("div",null,[n("p",{class:"text-base font-medium text-emerald-800"},"未检测到明显偏见"),n("p",{class:"text-sm text-emerald-700 mt-0.5"},"文章整体保持客观平衡")],-1)])]))]),e.biasAnalysis.detected&&e.biasAnalysis.types.length>0?(_(),C("div",Rc,[x[3]||(x[3]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-3 h-3 text-rose-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),n("span",{class:"text-sm font-medium text-gray-600"},"偏见类型")],-1)),n("div",Oc,[(_(!0),C(te,null,ie(e.biasAnalysis.types,(h,m)=>(_(),C("span",{key:m,class:"px-2 py-1 bg-rose-100 text-rose-700 text-sm rounded-lg"},E(r[h]||h),1))),128))])])):L("",!0),e.biasAnalysis.detected?(_(),C("div",Pc,[n("div",Hc,[x[4]||(x[4]=n("span",null,"严重程度",-1)),n("span",{class:D(["font-medium",f.value])},E(i.value),3)]),n("div",zc,[n("div",{class:D(["h-full rounded-full transition-all",u.value]),style:ve({width:p.value})},null,6)])])):L("",!0),n("div",jc,[x[5]||(x[5]=n("span",{class:"text-gray-600"},"整体平衡:",-1)),n("span",{class:D(["font-medium",d.value])},E(v.value),3)]),e.biasAnalysis.detected&&e.biasAnalysis.examples&&e.biasAnalysis.examples.length>0?(_(),C("div",Dc,[x[6]||(x[6]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-3 h-3 text-rose-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),n("path",{"fill-rule":"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z","clip-rule":"evenodd"})]),n("span",{class:"text-sm font-medium text-gray-600"},"具体案例")],-1)),n("div",qc,[(_(!0),C(te,null,ie(e.biasAnalysis.examples.slice(0,3),(h,m)=>(_(),C("div",{key:m,class:"p-3 bg-rose-50/50 rounded-lg border border-rose-200/50"},[n("div",Nc,[n("span",Vc,E(r[h.type]||h.type),1)]),n("p",Fc,'"'+E(h.text)+'"',1),n("p",Wc,E(h.explanation),1)]))),128))])])):L("",!0),n("div",Uc,[n("div",Gc,[x[8]||(x[8]=n("svg",{class:"w-4 h-4 text-rose-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),n("p",Kc,[x[7]||(x[7]=n("strong",null,"阅读提示:",-1)),ne(" "+E(c.value),1)])])])]),_:1},8,["confidence"])}}}),Xc=Object.assign(Yc,{__name:"BiasCard"}),Jc={key:0,class:"mb-4"},Qc={class:"flex flex-wrap gap-2"},Zc={key:1,class:"mb-4"},ed={class:"space-y-1.5"},td={key:2,class:"mb-4"},nd={class:"space-y-1.5"},od={key:3,class:"mb-4"},sd={class:"flex flex-wrap gap-2"},rd={class:"mt-4 p-3 bg-gradient-to-r from-indigo-50/50 to-blue-50/50 rounded-lg border border-indigo-200/50"},ad={class:"flex items-start gap-2"},ld={class:"text-sm text-indigo-800"},id={key:4,class:"mt-4 p-3 bg-gradient-to-r from-emerald-50/50 to-green-50/50 rounded-lg border border-emerald-200/50"},cd=P({__name:"KnowledgeGapsCard",props:{knowledgeGaps:{}},emits:["feedback"],setup(e,{emit:t}){const o={template:`
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
    </svg>
  `},s=e,r=M(()=>(!s.knowledgeGaps.prerequisites||s.knowledgeGaps.prerequisites.length===0)&&(!s.knowledgeGaps.assumptions||s.knowledgeGaps.assumptions.length===0)&&(!s.knowledgeGaps.missing_context||s.knowledgeGaps.missing_context.length===0)),a=M(()=>{if(r.value)return"本文自成体系，您可以直接阅读。建议点击相关概念拓展知识面。";const l=s.knowledgeGaps.prerequisites&&s.knowledgeGaps.prerequisites.length>0,i=s.knowledgeGaps.assumptions&&s.knowledgeGaps.assumptions.length>0;return l&&i?"建议先了解前置知识，阅读时留意作者的隐含假设，必要时查阅背景资料。":l?"建议先了解标注的前置知识，这将帮助您更好地理解文章内容。":i?"阅读时请留意作者的隐含假设，这些假设可能影响您对内容的理解。":"建议查阅缺失背景以获得更全面的理解。"});return(l,i)=>{const v=dn;return _(),j(v,{title:"知识缺口提示",icon:o,"icon-bg-class":"bg-gradient-to-br from-indigo-500 to-blue-600",onFeedback:i[0]||(i[0]=f=>l.$emit("feedback",f))},{default:T(()=>[e.knowledgeGaps.prerequisites&&e.knowledgeGaps.prerequisites.length>0?(_(),C("div",Jc,[i[1]||(i[1]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-3 h-3 text-indigo-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{d:"M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"})]),n("span",{class:"text-sm font-medium text-gray-600"},"前置知识")],-1)),n("div",Qc,[(_(!0),C(te,null,ie(e.knowledgeGaps.prerequisites,(f,u)=>(_(),C("span",{key:u,class:"px-3 py-1.5 bg-indigo-50 border border-indigo-200 text-indigo-700 text-sm rounded-lg hover:bg-indigo-100 transition-colors cursor-pointer"},E(f),1))),128))]),i[2]||(i[2]=n("p",{class:"text-sm text-gray-600 mt-2"},"阅读本文建议先了解以上概念",-1))])):L("",!0),e.knowledgeGaps.assumptions&&e.knowledgeGaps.assumptions.length>0?(_(),C("div",Zc,[i[4]||(i[4]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-3 h-3 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),n("span",{class:"text-sm font-medium text-gray-600"},"隐含假设")],-1)),n("ul",ed,[(_(!0),C(te,null,ie(e.knowledgeGaps.assumptions,(f,u)=>(_(),C("li",{key:u,class:"text-sm text-gray-700 flex items-start gap-2 p-2 bg-blue-50/50 rounded-lg border border-blue-200/50"},[i[3]||(i[3]=n("svg",{class:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)),n("span",null,E(f),1)]))),128))]),i[5]||(i[5]=n("p",{class:"text-sm text-gray-600 mt-2"},"作者未明说但默认读者知道的前提",-1))])):L("",!0),e.knowledgeGaps.missing_context&&e.knowledgeGaps.missing_context.length>0?(_(),C("div",td,[i[7]||(i[7]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-3 h-3 text-amber-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})]),n("span",{class:"text-sm font-medium text-gray-600"},"缺失背景")],-1)),n("ul",nd,[(_(!0),C(te,null,ie(e.knowledgeGaps.missing_context,(f,u)=>(_(),C("li",{key:u,class:"text-sm text-gray-700 flex items-start gap-2"},[i[6]||(i[6]=n("svg",{class:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),n("span",null,E(f),1)]))),128))]),i[8]||(i[8]=n("p",{class:"text-sm text-gray-600 mt-2"},"文中未提及但可能重要的上下文信息",-1))])):L("",!0),e.knowledgeGaps.related_concepts&&e.knowledgeGaps.related_concepts.length>0?(_(),C("div",od,[i[9]||(i[9]=n("div",{class:"flex items-center gap-1 mb-2"},[n("svg",{class:"w-3 h-3 text-emerald-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{d:"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"}),n("path",{d:"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"})]),n("span",{class:"text-sm font-medium text-gray-600"},"拓展阅读")],-1)),n("div",sd,[(_(!0),C(te,null,ie(e.knowledgeGaps.related_concepts,(f,u)=>(_(),C("span",{key:u,class:"px-3 py-1.5 bg-emerald-50 border border-emerald-200 text-emerald-700 text-sm rounded-lg hover:bg-emerald-100 transition-colors cursor-pointer"},E(f),1))),128))]),i[10]||(i[10]=n("p",{class:"text-sm text-gray-600 mt-2"},"推荐继续学习的相关主题",-1))])):L("",!0),n("div",rd,[n("div",ad,[i[12]||(i[12]=n("svg",{class:"w-4 h-4 text-indigo-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{d:"M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"})],-1)),n("p",ld,[i[11]||(i[11]=n("strong",null,"学习建议:",-1)),ne(" "+E(a.value),1)])])]),r.value?(_(),C("div",id,[...i[13]||(i[13]=[n("div",{class:"flex items-center gap-2"},[n("svg",{class:"w-5 h-5 text-emerald-600",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),n("p",{class:"text-sm font-medium text-emerald-800"},"太棒了！本文似乎没有需要特别补充的知识")],-1)])])):L("",!0)]),_:1})}}}),dd=Object.assign(cd,{__name:"KnowledgeGapsCard"}),ud=P({__name:"CardDescription",props:{class:{}},setup(e){const t=e;return(o,s)=>(_(),C("p",{"data-slot":"card-description",class:D(g(Ie)("text-muted-foreground text-sm",t.class))},[Y(o.$slots,"default")],2))}}),oo=P({__name:"CardHeader",props:{class:{}},setup(e){const t=e;return(o,s)=>(_(),C("div",{"data-slot":"card-header",class:D(g(Ie)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t.class))},[Y(o.$slots,"default")],2))}}),so=P({__name:"CardTitle",props:{class:{}},setup(e){const t=e;return(o,s)=>(_(),C("h3",{"data-slot":"card-title",class:D(g(Ie)("leading-none font-semibold",t.class))},[Y(o.$slots,"default")],2))}}),ro=P({__name:"Badge",props:{asChild:{type:Boolean},as:{},variant:{},class:{}},setup(e){const t=e,o=Mt(t,"class");return(s,r)=>(_(),j(g(he),se({"data-slot":"badge",class:g(Ie)(g(fd)({variant:e.variant}),t.class)},g(o)),{default:T(()=>[Y(s.$slots,"default")]),_:3},16,["class"]))}}),fd=Vs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}}),pd=P({__name:"ScrollBar",props:{orientation:{default:"vertical"},forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(e){const t=e,o=Mt(t,"class");return(s,r)=>(_(),j(g(pl),se(g(o),{class:g(Ie)("flex touch-none select-none transition-colors",e.orientation==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-px",e.orientation==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-px",t.class)}),{default:T(()=>[O(g(bl),{class:"relative flex-1 rounded-full bg-border"})]),_:1},16,["class"]))}}),gd=P({__name:"ScrollArea",props:{type:{},dir:{},scrollHideDelay:{},asChild:{type:Boolean},as:{},class:{}},setup(e){const t=e,o=Mt(t,"class");return(s,r)=>(_(),j(g(Ya),se(g(o),{class:g(Ie)("relative overflow-hidden",t.class)}),{default:T(()=>[O(g(xl),{class:"h-full w-full rounded-[inherit]"},{default:T(()=>[Y(s.$slots,"default")]),_:3}),O(pd),O(g(Za))]),_:3},16,["class"]))}});/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),vd=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,o,s)=>s?s.toUpperCase():o.toLowerCase()),md=e=>{const t=vd(e);return t.charAt(0).toUpperCase()+t.slice(1)},hd=(...e)=>e.filter((t,o,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===o).join(" ").trim(),lo=e=>e==="";/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var yt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=({name:e,iconNode:t,absoluteStrokeWidth:o,"absolute-stroke-width":s,strokeWidth:r,"stroke-width":a,size:l=yt.width,color:i=yt.stroke,...v},{slots:f})=>Dt("svg",{...yt,...v,width:l,height:l,stroke:i,"stroke-width":lo(o)||lo(s)||o===!0||s===!0?Number(r||a||yt["stroke-width"])*24/Number(l):r||a||yt["stroke-width"],class:hd("lucide",v.class,...e?[`lucide-${ao(md(e))}-icon`,`lucide-${ao(e)}`]:["lucide-icon"])},[...t.map(u=>Dt(...u)),...f.default?[f.default()]:[]]);/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=(e,t)=>(o,{slots:s,attrs:r})=>Dt(bd,{...r,...o,iconNode:t,name:e},s);/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=Pn("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=Pn("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wd=Pn("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),_d={class:"space-y-4"},kd={class:"text-sm text-gray-700 leading-relaxed"},Cd={key:0,class:"mt-4 space-y-2"},$d={class:"space-y-1"},Sd={key:1,class:"mt-4 grid grid-cols-3 gap-3"},Ad={class:"text-center p-3 bg-blue-50 rounded-lg"},Md={class:"text-xl font-bold text-blue-700"},Ed={class:"text-center p-3 bg-green-50 rounded-lg"},Td={class:"text-xl font-bold text-green-700"},Ld={class:"text-center p-3 bg-amber-50 rounded-lg"},Bd={class:"text-xl font-bold text-amber-700"},Id={class:"space-y-4"},Rd={key:0,class:"relative pl-6 pb-4"},Od=["onClick"],Pd={class:"flex items-start gap-2 mb-2"},Hd={class:"text-sm text-gray-800 leading-relaxed"},zd={class:"text-xs text-gray-500 mt-2"},jd={key:1,class:"relative pl-6 pb-4"},Dd=["onClick"],qd={class:"flex items-start gap-2 mb-2"},Nd={class:"text-sm text-gray-800 leading-relaxed"},Vd={class:"text-xs text-gray-500 mt-2"},Fd=P({__name:"ArgumentStructureView",props:{highlights:{},annotations:{}},setup(e){const t=e,o=M(()=>[...t.highlights].sort((l,i)=>(l.sentence_index||0)-(i.sentence_index||0))),s=l=>l?l.toFixed(1):"0",r=l=>{let i=0;for(let v=0;v<=l;v++)o.value[v]?.category==="claim"&&i++;return i},a=l=>{const i=document.getElementById("article-content-container");if(!i)return;const v=i.querySelectorAll(".meta-view-highlight");for(const f of v)if(f.textContent?.trim()===l.text.trim()){f.scrollIntoView({behavior:"smooth",block:"center"}),f.classList.add("highlight-flash"),setTimeout(()=>{f.classList.remove("highlight-flash")},2e3);break}};return(l,i)=>(_(),C("div",_d,[O(g(Vt),null,{default:T(()=>[O(g(oo),{class:"pb-3"},{default:T(()=>[O(g(so),{class:"text-sm flex items-center gap-2"},{default:T(()=>[O(g(xd),{class:"w-4 h-4"}),i[0]||(i[0]=ne(" 分析摘要 ",-1))]),_:1})]),_:1}),O(g(Nt),null,{default:T(()=>[n("p",kd,E(e.annotations.summary),1),e.annotations.key_insights&&e.annotations.key_insights.length>0?(_(),C("div",Cd,[i[1]||(i[1]=n("h4",{class:"text-xs font-semibold text-gray-600"},"关键洞察",-1)),n("ul",$d,[(_(!0),C(te,null,ie(e.annotations.key_insights,(v,f)=>(_(),C("li",{key:f,class:"text-xs text-gray-600 flex items-start gap-2"},[O(g(yd),{class:"w-3 h-3 text-emerald-600 mt-0.5 flex-shrink-0"}),n("span",null,E(v),1)]))),128))])])):L("",!0),e.annotations.statistics?(_(),C("div",Sd,[n("div",Ad,[n("div",Md,E(e.annotations.statistics.claim_count||0),1),i[2]||(i[2]=n("div",{class:"text-xs text-gray-600"},"主张",-1))]),n("div",Ed,[n("div",Td,E(e.annotations.statistics.evidence_count||0),1),i[3]||(i[3]=n("div",{class:"text-xs text-gray-600"},"证据",-1))]),n("div",Ld,[n("div",Bd,E(s(e.annotations.statistics.claim_to_evidence_ratio)),1),i[4]||(i[4]=n("div",{class:"text-xs text-gray-600"},"比例",-1))])])):L("",!0)]),_:1})]),_:1}),O(g(Vt),null,{default:T(()=>[O(g(oo),{class:"pb-3"},{default:T(()=>[O(g(so),{class:"text-sm flex items-center gap-2"},{default:T(()=>[O(g(wd),{class:"w-4 h-4"}),i[5]||(i[5]=ne(" 论证链 ",-1))]),_:1}),O(g(ud),{class:"text-xs"},{default:T(()=>[...i[6]||(i[6]=[ne("按出现顺序排列",-1)])]),_:1})]),_:1}),O(g(Nt),null,{default:T(()=>[O(g(gd),{class:"h-[400px] pr-4"},{default:T(()=>[n("div",Id,[(_(!0),C(te,null,ie(o.value,(v,f)=>(_(),C("div",{key:f,class:"group"},[v.category==="claim"?(_(),C("div",Rd,[i[7]||(i[7]=n("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-blue-200"},null,-1)),i[8]||(i[8]=n("div",{class:"absolute left-[0.6875rem] top-3 w-2.5 h-2.5 rounded-full bg-blue-500 border-2 border-white"},null,-1)),n("div",{onClick:u=>a(v),class:"ml-4 p-3 bg-blue-50 border border-blue-200 rounded-lg cursor-pointer hover:bg-blue-100 hover:shadow-md transition-all"},[n("div",Pd,[O(g(ro),{variant:"default",class:"bg-blue-600 text-xs"},{default:T(()=>[ne("主张 "+E(r(f)),1)]),_:2},1024)]),n("p",Hd,E(v.text),1),n("p",zd,E(v.tooltip),1)],8,Od)])):v.category==="evidence"?(_(),C("div",jd,[i[10]||(i[10]=n("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-green-200"},null,-1)),i[11]||(i[11]=n("div",{class:"absolute left-[0.6875rem] top-3 w-2.5 h-2.5 rounded-full bg-green-500 border-2 border-white"},null,-1)),n("div",{onClick:u=>a(v),class:"ml-4 p-3 bg-green-50 border border-green-200 rounded-lg cursor-pointer hover:bg-green-100 hover:shadow-md transition-all"},[n("div",qd,[O(g(ro),{variant:"default",class:"bg-green-600 text-xs"},{default:T(()=>[...i[9]||(i[9]=[ne("证据",-1)])]),_:1})]),n("p",Nd,E(v.text),1),n("p",Vd,E(v.tooltip),1)],8,Dd)])):L("",!0)]))),128))])]),_:1})]),_:1})]),_:1})]))}}),Wd=Object.assign(Se(Fd,[["__scopeId","data-v-8da86f09"]]),{__name:"ArgumentStructureView"}),Vo=()=>{const e=me(),t=U("enabled-lenses",()=>new Set),o=U("lens-results",()=>new Map),s=U("loading-lenses",()=>new Set),r=U("lens-error",()=>null),a=async(w,h,m=!1)=>{const b=new Set(s.value);b.add(h),s.value=b,r.value=null;try{const k=await $fetch(`${e.public.apiBase}/api/v1/articles/${w}/thinking-lens/${h}`,{params:{force_reanalyze:m}});if(k.status==="completed"){o.value.set(h,k.lens_result);const $=new Set(s.value);return $.delete(h),s.value=$,console.log(`✅ ${h} 透镜加载成功（来自缓存）:`,k.lens_result.highlights.length,"个高亮"),k.lens_result}else if(k.status==="pending")return console.log(`🔄 ${h} 透镜分析已提交，任务ID: ${k.task_id}`),null}catch(k){console.error("❌ 透镜加载失败:",k),r.value=k.data?.detail||k.message||"透镜加载失败";const $=new Set(s.value);throw $.delete(h),s.value=$,k}},l=async(w,h,m)=>{if(t.value.has(h))p(m,h),t.value.delete(h),console.log(`🔴 ${h} 透镜已关闭`);else if(t.value.add(h),o.value.has(h)){const b=o.value.get(h);b&&(f(m,b.highlights,h),console.log(`🟢 ${h} 透镜已开启`))}else{const b=await a(w,h);b?(f(m,b.highlights,h),console.log(`🟢 ${h} 透镜已开启（来自缓存）`)):console.log(`🔄 ${h} 透镜分析中，完成后将自动应用高亮`)}},i=w=>{c(w),t.value.clear()},v=(w,h)=>{if(!w||h.length===0){console.warn("⚠️ 无法渲染高亮：容器不存在或无高亮数据");return}try{c(w),console.log("🔍 开始渲染",h.length,"个高亮");const m=performance.now();u(w,h);const b=performance.now()-m;console.log(`✅ 高亮渲染完成，耗时: ${b.toFixed(0)}ms`)}catch(m){console.error("❌ 高亮渲染失败:",m)}},f=(w,h,m)=>{if(!w||h.length===0){console.warn("⚠️ 无法渲染高亮：容器不存在或无高亮数据");return}try{console.log(`🔍 开始渲染 ${m}:`,h.length,"个高亮");const b=performance.now();u(w,h,m);const k=performance.now()-b;console.log(`✅ ${m} 高亮渲染完成，耗时: ${k.toFixed(0)}ms`)}catch(b){console.error("❌ 高亮渲染失败:",b)}},u=(w,h,m)=>{const b=new Map;h.forEach(A=>{const R=A.text.trim();R&&b.set(R,A)});const k=document.createTreeWalker(w,NodeFilter.SHOW_TEXT,{acceptNode:A=>A.parentElement?.classList.contains("meta-view-highlight")?NodeFilter.FILTER_REJECT:A.textContent?.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),$=[];let I;for(;I=k.nextNode();)$.push(I);const S=new Set;for(const A of $){const R=A.textContent||"";for(const[V,G]of b.entries()){if(S.has(V))continue;const F=R.indexOf(V);if(F!==-1){const Q=R.substring(0,F),K=R.substring(F,F+V.length),ee=R.substring(F+V.length),W=A.parentNode;if(W){const z=d(K,G,m);Q&&W.insertBefore(document.createTextNode(Q),A),W.insertBefore(z,A),ee&&W.insertBefore(document.createTextNode(ee),A),W.removeChild(A),S.add(V);break}}}}},p=(w,h)=>{const m=w.querySelectorAll(`.meta-view-highlight[data-lens-type="${h}"]`);m.forEach(b=>{const k=b.parentNode;if(k){const $=document.createTextNode(b.textContent||"");k.replaceChild($,b)}}),w.normalize(),console.log(`🧹 移除了 ${m.length} 个 ${h} 高亮`)},d=(w,h,m)=>{const b=document.createElement("span");return b.className="meta-view-highlight",b.dataset.category=h.category,b.dataset.tooltip=h.tooltip,m&&(b.dataset.lensType=m),b.style.backgroundColor=h.color,b.style.borderBottom=`2px solid ${h.color.replace("0.4","0.6")}`,b.style.cursor="help",b.style.padding="0.1em 0.2em",b.style.borderRadius="0.25em",b.style.transition="all 0.2s ease",b.textContent=w,b.addEventListener("mouseenter",()=>{b.style.backgroundColor=h.color.replace("0.4","0.6"),b.style.boxShadow="0 0 0 2px rgba(0, 0, 0, 0.1)"}),b.addEventListener("mouseleave",()=>{b.style.backgroundColor=h.color,b.style.boxShadow="none"}),b},c=w=>{w.querySelectorAll(".meta-view-highlight").forEach(m=>{const b=m.parentNode;if(b){const k=document.createTextNode(m.textContent||"");b.replaceChild(k,m)}}),w.normalize()},y=w=>{c(w)},x=()=>{o.value.clear(),t.value.clear(),r.value=null};return{enabledLenses:le(t),lensResults:le(o),loadingLenses:le(s),error:le(r),isArgumentLensEnabled:M(()=>t.value.has("argument_structure")),isStanceLensEnabled:M(()=>t.value.has("author_stance")),isLoadingArgumentLens:M(()=>s.value.has("argument_structure")),isLoadingStanceLens:M(()=>s.value.has("author_stance")),loadLens:a,toggleLens:l,clearLens:i,renderHighlights:v,renderHighlightsByType:f,removeHighlights:c,removeHighlightsByType:p,clearHighlights:y,clearLensResults:x}},Fo=()=>{const e=U("lens-annotation-mode-active",()=>!1),t=U("lens-annotations",()=>[]),o=()=>{e.value=!e.value,e.value?s():v()},s=()=>{const f=[];document.querySelectorAll(".meta-view-highlight").forEach((p,d)=>{const c=p,y=c.getAttribute("data-lens-type"),x=c.getAttribute("data-tooltip");if(!y||!x)return;const w=`lens-annotation-${y}-${d}`;let h=c.parentElement;if(!h?.hasAttribute("data-lens-wrapper")){h=document.createElement("span"),h.style.position="relative",h.style.display="inline-block",h.setAttribute("data-lens-wrapper","true"),h.setAttribute("data-annotation-id",w);const m=c.parentNode;m&&(m.insertBefore(h,c),h.appendChild(c))}if(!h.querySelector(".lens-annotation-card")){const m=r({id:w,sentenceText:c.textContent||"",annotationContent:x});h.appendChild(m)}f.push({id:w,sentenceIndex:d,sentenceText:c.textContent||"",lensType:y,annotationContent:x,position:{top:0,left:0,width:0,height:0}})}),t.value=f,console.log(`📝 收集并注入 ${f.length} 个透镜注解`)},r=f=>{const u=document.createElement("div");return u.className="lens-annotation-card",u.setAttribute("data-annotation-id",f.id),u.innerHTML=`
      <div class="annotation-content-compact">
        ${l(f.annotationContent)}
      </div>
    `,a(u),u},a=f=>{if(Object.assign(f.style,{position:"absolute",top:"0",left:"calc(100% + 20px)",width:"240px",maxWidth:"300px",background:"rgba(255, 255, 255, 0.98)",border:"1px solid rgba(0, 0, 0, 0.08)",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",padding:"10px 12px",zIndex:"1000",fontSize:"13px",lineHeight:"1.5",color:"#666",pointerEvents:"auto"}),!document.getElementById("lens-annotation-styles")){const u=document.createElement("style");u.id="lens-annotation-styles",u.textContent=`
        .lens-annotation-card .annotation-content-compact {
          font-size: 13px;
          line-height: 1.5;
          color: #555;
        }
      `,document.head.appendChild(u)}},l=f=>{const u=document.createElement("div");return u.textContent=f,u.innerHTML},i=()=>{e.value},v=()=>{document.querySelectorAll(".lens-annotation-card").forEach(p=>p.remove()),document.querySelectorAll("[data-lens-wrapper]").forEach(p=>{const d=p.parentNode,c=p.firstChild;d&&c&&(d.insertBefore(c,p),d.removeChild(p))}),t.value=[],console.log("🧹 已清空所有透镜注解")};return{isAnnotationModeActive:le(e),annotations:le(t),toggleAnnotationMode:o,refreshAnnotationPositions:i,clearAnnotations:v}},Ud={class:"mb-4 bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-5 shadow-sm hover:shadow-md transition-all"},Gd={class:"flex items-center justify-between mb-4"},Kd={key:0,class:"mb-4 p-3 bg-gradient-to-r from-teal-50/50 to-cyan-50/50 rounded-lg border border-teal-200/50"},Yd={key:0,class:"mb-4 p-4 bg-gradient-to-r from-emerald-50/50 to-teal-50/50 rounded-xl border border-emerald-200/50"},Xd={class:"flex items-center justify-between"},Jd=["aria-checked"],Qd={class:"space-y-3"},Zd={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm rounded-xl flex items-center justify-center z-10"},eu={class:"flex items-start gap-3"},tu={class:"flex-1"},nu={class:"flex items-center gap-2 mb-1"},ou={key:0,class:"px-2 py-0.5 bg-teal-500 text-white text-[10px] font-medium rounded-full"},su={key:0,class:"mt-3"},ru={class:"flex items-center justify-between text-xs text-gray-600 pt-2 border-t border-teal-200/50"},au={key:0,class:"absolute inset-0 bg-white/80 backdrop-blur-sm rounded-xl flex items-center justify-center z-10"},lu={class:"flex items-start gap-3"},iu={class:"flex-1"},cu={class:"flex items-center gap-2 mb-1"},du={key:0,class:"px-2 py-0.5 bg-purple-500 text-white text-[10px] font-medium rounded-full"},uu={key:0,class:"mt-3 space-y-2"},fu={class:"flex flex-wrap gap-2"},pu={class:"flex items-center gap-1.5"},gu={class:"text-xs text-gray-600"},vu={class:"flex items-center gap-1.5"},mu={class:"text-xs text-gray-600"},hu={class:"pt-2 border-t border-purple-200/50"},bu={class:"flex items-center justify-between text-xs text-gray-600 mb-1"},yu={class:"font-medium"},xu={class:"relative h-2 bg-gray-200 rounded-full overflow-hidden"},wu={class:"flex items-center justify-between text-xs text-gray-600 pt-2 border-t border-purple-200/50"},_u={key:0,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg"},ku={class:"flex items-start gap-2"},Cu={class:"flex-1"},$u={class:"text-xs text-red-700 mt-1"},Su={key:1,class:"mt-4 pt-3 border-t border-gray-200"},Au=P({__name:"ThinkingLensSwitcher",props:{articleId:{},containerElementId:{}},emits:["lensApplied","lensRemoved"],setup(e,{emit:t}){const o=e,s=t,{enabledLenses:r,lensResults:a,loadingLenses:l,error:i,toggleLens:v}=Vo(),{isAnnotationModeActive:f,toggleAnnotationMode:u}=Fo(),p=B(!1),d=B(null),c=I=>r.value.has(I),y=I=>a.value.get(I)||null,x=I=>l.value.has(I),w=async I=>{d.value=I;try{const S=o.containerElementId?document.getElementById(o.containerElementId):null;if(!S){console.error("⚠️ 未找到文章容器元素");return}await v(o.articleId,I,S),r.value.has(I)?s("lensApplied",I):s("lensRemoved")}catch(S){console.error("Failed to toggle lens:",S)}finally{d.value=null}},h=I=>{const S=o.containerElementId?document.getElementById(o.containerElementId):null;S&&v(o.articleId,I,S),s("lensRemoved")},m=()=>{d.value&&w(d.value)},b=(I,S)=>{const A=y(I);return A?A.highlights.filter(R=>R.category===S).length:0},k=I=>{const S=y(I);return S?S.highlights.length:0},$=()=>{const I=y("author_stance");if(!I)return 0;const S=I.highlights.length;if(S===0)return 0;const A=b("author_stance","subjective");return Math.round(A/S*100)};return oe(()=>o.articleId,()=>{r.value.clear()}),(I,S)=>{const A=Wd;return _(),C("div",Ud,[n("div",Gd,[S[7]||(S[7]=Me('<div class="flex items-center gap-2"><div class="w-8 h-8 rounded-lg bg-gradient-to-br from-teal-500 to-cyan-600 flex items-center justify-center"><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg></div><h4 class="text-sm font-semibold text-gray-800">思维透镜</h4></div>',1)),n("button",{onClick:S[0]||(S[0]=R=>p.value=!p.value),class:"p-1 rounded-lg hover:bg-gray-100 transition-colors",title:"使用说明"},[...S[6]||(S[6]=[n("svg",{class:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)])])]),O(de,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","leave-active-class":"transition-all duration-200 ease-in","leave-to-class":"opacity-0 -translate-y-2"},{default:T(()=>[p.value?(_(),C("div",Kd,[...S[8]||(S[8]=[n("p",{class:"text-xs text-teal-800 leading-relaxed"}," 思维透镜可以帮助你以不同视角重新审视文章内容。选择透镜后，文章中的关键信息会被高亮标注，帮助你快速识别论证结构和作者立场。 ",-1)])])):L("",!0)]),_:1}),c("argument_structure")||c("author_stance")?(_(),C("div",Yd,[n("div",Xd,[S[9]||(S[9]=Me('<div class="flex-1"><div class="flex items-center gap-2 mb-1"><svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg><span class="text-sm font-semibold text-emerald-900">批注模式</span></div><p class="text-xs text-emerald-700/80">在高亮文本旁显示详细分析</p></div>',1)),n("button",{onClick:S[1]||(S[1]=(...R)=>g(u)&&g(u)(...R)),class:D(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2",g(f)?"bg-emerald-500":"bg-gray-300"]),role:"switch","aria-checked":g(f)},[n("span",{class:D(["inline-block h-4 w-4 transform rounded-full bg-white transition-transform",g(f)?"translate-x-6":"translate-x-1"])},null,2)],10,Jd)])])):L("",!0),n("div",Qd,[n("div",{onClick:S[3]||(S[3]=R=>w("argument_structure")),class:D(["relative p-4 rounded-xl border-2 cursor-pointer transition-all",c("argument_structure")?"border-teal-500 bg-gradient-to-r from-teal-50 to-cyan-50 shadow-md":"border-gray-200 bg-white/50 hover:border-teal-300 hover:shadow-sm"])},[x("argument_structure")?(_(),C("div",Zd,[...S[10]||(S[10]=[n("svg",{class:"w-6 h-6 text-teal-600 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):L("",!0),n("div",eu,[n("div",{class:D(["w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 transition-colors",c("argument_structure")?"bg-teal-500":"bg-gray-200"])},[(_(),C("svg",{class:D(["w-5 h-5 transition-colors",c("argument_structure")?"text-white":"text-gray-500"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...S[11]||(S[11]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"},null,-1)])],2))],2),n("div",tu,[n("div",nu,[n("h5",{class:D(["text-sm font-semibold transition-colors",c("argument_structure")?"text-teal-700":"text-gray-700"])},"论证结构透镜",2),c("argument_structure")?(_(),C("span",ou," 已激活 ")):L("",!0)]),S[12]||(S[12]=n("p",{class:"text-xs text-gray-600 mb-2"},"识别文章中的论点、证据和推理过程",-1)),c("argument_structure")&&y("argument_structure")?(_(),C("div",su,[n("div",ru,[n("span",null,"共识别 "+E(k("argument_structure"))+" 个关键片段",1),n("button",{onClick:S[2]||(S[2]=_e(R=>h("argument_structure"),["stop"])),class:"px-2 py-1 text-teal-600 hover:bg-teal-100 rounded transition-colors"}," 关闭透镜 ")])])):L("",!0)])])],2),n("div",{onClick:S[5]||(S[5]=R=>w("author_stance")),class:D(["relative p-4 rounded-xl border-2 cursor-pointer transition-all",c("author_stance")?"border-purple-500 bg-gradient-to-r from-purple-50 to-pink-50 shadow-md":"border-gray-200 bg-white/50 hover:border-purple-300 hover:shadow-sm"])},[x("author_stance")?(_(),C("div",au,[...S[13]||(S[13]=[n("svg",{class:"w-6 h-6 text-purple-600 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):L("",!0),n("div",lu,[n("div",{class:D(["w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 transition-colors",c("author_stance")?"bg-purple-500":"bg-gray-200"])},[(_(),C("svg",{class:D(["w-5 h-5 transition-colors",c("author_stance")?"text-white":"text-gray-500"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...S[14]||(S[14]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"},null,-1)])],2))],2),n("div",iu,[n("div",cu,[n("h5",{class:D(["text-sm font-semibold transition-colors",c("author_stance")?"text-purple-700":"text-gray-700"])},"作者立场透镜",2),c("author_stance")?(_(),C("span",du," 已激活 ")):L("",!0)]),S[18]||(S[18]=n("p",{class:"text-xs text-gray-600 mb-2"},"区分客观陈述与主观观点",-1)),c("author_stance")&&y("author_stance")?(_(),C("div",uu,[n("div",fu,[n("div",pu,[S[15]||(S[15]=n("span",{class:"w-3 h-3 rounded bg-indigo-200 border border-indigo-400"},null,-1)),n("span",gu,"客观陈述 ("+E(b("author_stance","objective"))+")",1)]),n("div",vu,[S[16]||(S[16]=n("span",{class:"w-3 h-3 rounded bg-rose-200 border border-rose-400"},null,-1)),n("span",mu,"主观观点 ("+E(b("author_stance","subjective"))+")",1)])]),n("div",hu,[n("div",bu,[S[17]||(S[17]=n("span",null,"主观性程度",-1)),n("span",yu,E($())+"%",1)]),n("div",xu,[n("div",{class:"h-full bg-gradient-to-r from-indigo-500 to-rose-500 rounded-full transition-all",style:ve({width:`${$()}%`})},null,4)])]),n("div",wu,[n("span",null,"共识别 "+E(k("author_stance"))+" 个片段",1),n("button",{onClick:S[4]||(S[4]=_e(R=>h("author_stance"),["stop"])),class:"px-2 py-1 text-purple-600 hover:bg-purple-100 rounded transition-colors"}," 关闭透镜 ")])])):L("",!0)])])],2)]),O(de,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-4","leave-active-class":"transition-all duration-200 ease-in","leave-to-class":"opacity-0 -translate-y-4"},{default:T(()=>[c("argument_structure")&&y("argument_structure")?(_(),j(A,{key:0,highlights:y("argument_structure").highlights,annotations:y("argument_structure").annotations,class:"mt-4"},null,8,["highlights","annotations"])):L("",!0)]),_:1}),O(de,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 -translate-y-2","leave-active-class":"transition-all duration-200 ease-in","leave-to-class":"opacity-0 -translate-y-2"},{default:T(()=>[g(i)?(_(),C("div",_u,[n("div",ku,[S[20]||(S[20]=n("svg",{class:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),n("div",Cu,[S[19]||(S[19]=n("p",{class:"text-xs text-red-800 font-medium"},"透镜应用失败",-1)),n("p",$u,E(g(i)),1),n("button",{onClick:m,class:"mt-2 px-3 py-1 bg-red-600 text-white text-xs rounded-lg hover:bg-red-700 transition-colors"}," 重试 ")])])])):L("",!0)]),_:1}),!c("argument_structure")&&!c("author_stance")?(_(),C("div",Su,[...S[21]||(S[21]=[n("p",{class:"text-xs text-gray-500 text-center"}," 点击上方透镜开始深度阅读（可同时开启多个） ",-1)])])):L("",!0)])}}}),Mu=Object.assign(Au,{__name:"ThinkingLensSwitcher"}),Wo=()=>{const e=me(),t=U("meta-view-active",()=>!1),o=U("meta-analysis-data",()=>null),s=U("meta-view-analyzing",()=>!1),r=U("meta-view-error",()=>null),a=async(d,c,y,x,w,h,m="zh",b=!1)=>{s.value=!0,r.value=null;try{const k=await $fetch(`${e.public.apiBase}/api/v1/meta-analysis/analyze`,{method:"POST",body:{title:d,author:c,publish_date:y,full_text:x,user_id:w,source_url:h,language:m,force_reanalyze:b}});if(k.status==="completed"&&k.meta_analysis){if(o.value=k.meta_analysis,s.value=!1,console.log("✅ 元信息分析完成（来自缓存）:",k.meta_analysis.id),k.meta_analysis.generated_title){const{title:$}=Ve();$.value=k.meta_analysis.generated_title,console.log("✅ 已更新AI生成的标题:",k.meta_analysis.generated_title)}return k.meta_analysis}else if(k.status==="pending")return console.log("🔄 元视角分析已提交，任务ID:",k.task_id),null}catch(k){throw console.error("❌ 元信息分析失败:",k),r.value=k.data?.detail||k.message||"分析失败",s.value=!1,k}},l=async d=>{try{const c=await $fetch(`${e.public.apiBase}/api/v1/meta-analysis/${d}`);if(c.exists&&c.meta_analysis){if(o.value=c.meta_analysis,console.log("✅ 获取到元信息分析:",c.meta_analysis.id),c.meta_analysis.generated_title){const{title:y}=Ve();y.value=c.meta_analysis.generated_title,console.log("✅ 已更新AI生成的标题:",c.meta_analysis.generated_title)}return!0}return!1}catch(c){return console.error("❌ 获取元信息失败:",c),!1}},i=()=>{t.value=!t.value},v=()=>{t.value=!1},f=()=>{t.value=!0},u=()=>{o.value=null,r.value=null},p=async(d,c,y,x,w,h,m)=>{try{await $fetch(`${e.public.apiBase}/api/v1/meta-analysis/feedback`,{method:"POST",body:{user_id:d,meta_analysis_id:y,lens_result_id:x,feedback_type:c,rating:w,comment:h,feedback_data:m}}),console.log("✅ 反馈已提交")}catch(b){throw console.error("❌ 提交反馈失败:",b),b}};return{isMetaViewActive:le(t),metaAnalysisData:le(o),isAnalyzing:le(s),analysisError:le(r),analyzeArticle:a,fetchMetaAnalysis:l,toggleMetaView:i,closeMetaView:v,openMetaView:f,clearMetaAnalysis:u,submitFeedback:p}},Eu={key:0,class:"fixed top-0 right-0 h-full w-full md:w-[420px] bg-white/70 backdrop-blur-xl border-l border-gray-200/50 shadow-2xl overflow-y-auto z-40"},Tu={class:"sticky top-0 z-10 bg-white/90 backdrop-blur-xl border-b border-gray-200/50 p-6"},Lu={class:"flex items-center justify-between"},Bu={class:"p-6 space-y-6"},Iu={key:0,class:"py-12 flex flex-col items-center justify-center"},Ru={key:1,class:"py-12 flex flex-col items-center justify-center"},Ou={class:"text-xs text-gray-500 mb-4 text-center"},Pu={class:"mt-6 p-4 bg-gray-50/50 rounded-xl border border-gray-200/50"},Hu={class:"space-y-1 text-sm text-gray-500"},zu={key:3,class:"py-12 flex flex-col items-center justify-center"},ju=P({__name:"MetaInfoPanel",props:{articleContent:{}},emits:["retry"],setup(e,{emit:t}){const{isMetaViewActive:o,metaAnalysisData:s,isAnalyzing:r,analysisError:a,closeMetaView:l,submitFeedback:i}=Wo(),{user:v}=pt(),f=async(d,c)=>{if(!(!v.value?.id||!s.value?.id))try{await i(v.value.id,"meta_info_card",s.value.id,void 0,c==="helpful"?5:1,void 0,{card_type:d,helpful:c==="helpful"}),console.log("✅ 反馈已提交:",d,c)}catch(y){console.error("❌ 反馈提交失败:",y)}},u=d=>{console.log("✅ 思维透镜已应用:",d)},p=()=>{console.log("✅ 思维透镜已移除")};return(d,c)=>{const y=fc,x=Tc,w=Xc,h=dd,m=Mu;return _(),C(te,null,[O(de,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition-all duration-300 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:T(()=>[g(o)?(_(),C("aside",Eu,[n("div",Tu,[n("div",Lu,[c[8]||(c[8]=n("div",{class:"flex items-center gap-3"},[n("div",{class:"w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl flex items-center justify-center shadow-md"},[n("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})])]),n("div",null,[n("h2",{class:"text-lg font-bold bg-gradient-to-r from-violet-600 to-purple-600 bg-clip-text text-transparent"}," 元视角 "),n("p",{class:"text-xs text-gray-500"},"Meta-View Mode")])],-1)),n("button",{onClick:c[0]||(c[0]=(...b)=>g(l)&&g(l)(...b)),class:"p-2 rounded-lg hover:bg-gray-100 transition-colors"},[...c[7]||(c[7]=[n("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),n("div",Bu,[g(r)?(_(),C("div",Iu,[...c[9]||(c[9]=[n("div",{class:"w-16 h-16 border-4 border-violet-600 border-t-transparent rounded-full animate-spin mb-4"},null,-1),n("p",{class:"text-sm text-gray-600"},"正在分析文章元信息...",-1),n("p",{class:"text-xs text-gray-500 mt-1"},"这可能需要几分钟",-1)])])):g(a)?(_(),C("div",Ru,[c[10]||(c[10]=n("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4"},[n("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),c[11]||(c[11]=n("p",{class:"text-sm text-gray-700 mb-2"},"分析失败",-1)),n("p",Ou,E(g(a)),1),n("button",{onClick:c[1]||(c[1]=b=>d.$emit("retry")),class:"px-4 py-2 bg-violet-600 hover:bg-violet-700 text-white text-sm rounded-lg transition-colors"}," 重试 ")])):g(s)?(_(),C(te,{key:2},[O(y,{"author-intent":g(s).author_intent,onFeedback:c[2]||(c[2]=b=>f("author_intent",b))},null,8,["author-intent"]),O(x,{"timeliness-analysis":g(s).timeliness_analysis,"timeliness-score":g(s).timeliness_score,onFeedback:c[3]||(c[3]=b=>f("timeliness",b))},null,8,["timeliness-analysis","timeliness-score"]),O(w,{"bias-analysis":g(s).bias_analysis,onFeedback:c[4]||(c[4]=b=>f("bias",b))},null,8,["bias-analysis"]),O(h,{"knowledge-gaps":g(s).knowledge_gaps,onFeedback:c[5]||(c[5]=b=>f("knowledge_gaps",b))},null,8,["knowledge-gaps"]),O(m,{"article-id":g(s).article_id,"container-element-id":"article-content-container",onLensApplied:u,onLensRemoved:p},null,8,["article-id"]),n("div",Pu,[c[12]||(c[12]=n("div",{class:"flex items-center gap-2 mb-2"},[n("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),n("span",{class:"text-sm font-medium text-gray-600"},"分析信息")],-1)),n("div",Hu,[n("p",null,"模型: "+E(g(s).analysis_quality.llm_model),1),n("p",null,"耗时: "+E(g(s).analysis_quality.processing_time_ms)+"ms",1),n("p",null,"置信度: "+E(Math.round(g(s).analysis_quality.confidence_score*100))+"%",1),n("p",null,"版本: "+E(g(s).analysis_quality.prompt_version),1)])])],64)):(_(),C("div",zu,[...c[13]||(c[13]=[n("div",{class:"w-20 h-20 bg-gradient-to-br from-violet-100 to-purple-100 rounded-2xl flex items-center justify-center mb-4"},[n("svg",{class:"w-10 h-10 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})])],-1),n("p",{class:"text-sm text-gray-700 mb-1"},"暂无元信息分析",-1),n("p",{class:"text-xs text-gray-500 text-center"},"点击眼镜图标开始分析",-1)])]))])])):L("",!0)]),_:1}),O(de,{"enter-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[g(o)?(_(),C("div",{key:0,class:"fixed inset-0 bg-black/20 backdrop-blur-sm z-30 md:hidden",onClick:c[6]||(c[6]=(...b)=>g(l)&&g(l)(...b))})):L("",!0)]),_:1})],64)}}}),Du=Object.assign(ju,{__name:"MetaInfoPanel"}),qu={key:0,class:"conversation-thread"},Nu={class:"px-2 py-0.5 rounded text-xs bg-emerald-100 text-emerald-700"},Vu={key:0,class:"space-y-4 overflow-hidden"},Fu={key:0,class:"message-item user"},Wu={class:"message-content pl-4 border-l-2 border-gray-300 bg-gray-50/50"},Uu={class:"text-sm text-gray-600 py-2 italic"},Gu={class:"flex items-center gap-2 mb-1.5"},Ku={class:"text-xs font-medium"},Yu={key:0,class:"text-xs text-gray-400"},Xu={key:0,class:"mb-3"},Ju=["onClick"],Qu={key:0,class:"p-3 bg-gray-50 rounded-lg border border-gray-200 mb-3"},Zu=["innerHTML"],e0=["innerHTML"],t0={key:2,class:"text-sm text-gray-700 py-2"},n0={key:1,class:"message-item assistant"},o0={class:"flex items-center justify-between gap-2 mb-1.5"},s0={class:"message-content pl-4 border-l-2 border-emerald-300 bg-emerald-50/30"},r0={key:0,class:"mb-3"},a0={key:0,class:"p-3 bg-gray-50 rounded-lg border border-gray-200 mb-3"},l0={key:0,class:"flex items-center gap-2 text-gray-500 text-xs"},i0=["innerHTML"],c0={key:2,class:"inline-block w-0.5 h-4 bg-emerald-600 animate-blink ml-1 align-middle"},d0=["innerHTML"],u0={key:2,class:"inline-block w-0.5 h-4 bg-emerald-600 animate-blink ml-1 align-middle"},f0=P({__name:"ConversationThread",props:{messages:{},initialUserQuestion:{},isGenerating:{type:Boolean},currentAnswer:{},currentReasoning:{},useReasoning:{type:Boolean}},setup(e){const t=e,o=B(!1),s=B({}),r=B(!0),a=p=>s.value[p]??!1,l=p=>{s.value[p]=!s.value[p]},i=p=>{const d=new Date(p),y=new Date().getTime()-d.getTime();return y<6e4?"刚刚":y<36e5?`${Math.floor(y/6e4)} 分钟前`:y<864e5?`${Math.floor(y/36e5)} 小时前`:d.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},v=p=>p?tt(p,{breaks:!0}):"",f=M(()=>t.currentReasoning?tt(t.currentReasoning,{breaks:!0}):""),u=M(()=>t.currentAnswer?tt(t.currentAnswer,{breaks:!0}):"");return oe(()=>t.messages.length,(p,d)=>{p>d&&(o.value=!1)}),(p,d)=>e.messages.length>0?(_(),C("div",qu,[n("button",{onClick:d[0]||(d[0]=c=>o.value=!g(o)),class:"flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-emerald-700 transition-colors mb-3"},[(_(),C("svg",{class:D(["w-4 h-4 transition-transform",!g(o)&&"rotate-90"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...d[3]||(d[3]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),d[4]||(d[4]=n("span",null,"📝 对话历史",-1)),n("span",Nu,E(Math.floor(e.messages.length/2))+" 轮 ",1)]),O(de,{"enter-active-class":"transition-all duration-300","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-screen","leave-active-class":"transition-all duration-200","leave-from-class":"opacity-100 max-h-screen","leave-to-class":"opacity-0 max-h-0"},{default:T(()=>[g(o)?L("",!0):(_(),C("div",Vu,[e.initialUserQuestion&&e.messages.length>0?(_(),C("div",Fu,[d[5]||(d[5]=n("div",{class:"flex items-center gap-2 mb-1.5"},[n("span",{class:"text-xs font-medium text-gray-600"},"你的初始问题"),n("span",{class:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full"},"起点")],-1)),n("div",Wu,[n("p",Uu,E(e.initialUserQuestion),1)])])):L("",!0),(_(!0),C(te,null,ie(e.messages,(c,y)=>(_(),C("div",{key:y,class:D(["message-item",c.role])},[n("div",Gu,[n("span",Ku,E(c.role==="user"?"🙋 你的追问":"🤖 AI 的回答"),1),c.timestamp?(_(),C("span",Yu,E(i(c.timestamp)),1)):L("",!0)]),n("div",{class:D(["message-content pl-4 border-l-2 transition-colors",[c.role==="user"?"border-blue-300 bg-blue-50/30":"border-emerald-300 bg-emerald-50/30"]])},[c.role==="assistant"&&c.reasoning?(_(),C("div",Xu,[n("button",{onClick:x=>l(y),class:"flex items-center gap-1.5 text-xs font-medium text-gray-600 hover:text-emerald-700 transition-colors mb-2"},[(_(),C("svg",{class:D(["w-3 h-3 transition-transform",a(y)&&"rotate-90"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...d[6]||(d[6]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),d[7]||(d[7]=n("span",null,"思维链",-1))],8,Ju),a(y)?(_(),C("div",Qu,[n("div",{class:"prose prose-xs max-w-none text-gray-700",innerHTML:v(c.reasoning)},null,8,Zu)])):L("",!0)])):L("",!0),c.role==="assistant"?(_(),C("div",{key:1,class:"prose prose-sm max-w-none",innerHTML:v(c.content)},null,8,e0)):(_(),C("p",t0,E(c.content),1))],2)],2))),128)),e.isGenerating&&(e.currentAnswer||e.currentReasoning)?(_(),C("div",n0,[n("div",o0,[d[9]||(d[9]=n("div",{class:"flex items-center gap-2"},[n("span",{class:"text-xs font-medium"},"🤖 AI 的回答"),n("div",{class:"flex items-center gap-1 text-xs text-emerald-600"},[n("div",{class:"animate-spin h-3 w-3 border-2 border-emerald-600 border-t-transparent rounded-full"}),n("span",null,"生成中...")])],-1)),n("button",{onClick:d[1]||(d[1]=c=>p.$emit("stop")),class:"px-2 py-1 text-xs font-medium bg-red-500 hover:bg-red-600 text-white rounded transition-colors flex items-center gap-1"},[...d[8]||(d[8]=[n("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),n("span",null,"停止",-1)])])]),n("div",s0,[e.useReasoning||e.currentReasoning?(_(),C("div",r0,[n("button",{onClick:d[2]||(d[2]=c=>r.value=!g(r)),class:"flex items-center gap-1.5 text-xs font-medium text-gray-600 hover:text-emerald-700 transition-colors mb-2"},[(_(),C("svg",{class:D(["w-3 h-3 transition-transform",g(r)&&"rotate-90"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...d[10]||(d[10]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),d[11]||(d[11]=n("span",null,"思维链",-1)),d[12]||(d[12]=n("span",{class:"px-1.5 py-0.5 rounded text-xs bg-emerald-100 text-emerald-700"},"推理模式",-1))]),g(r)?(_(),C("div",a0,[!e.currentReasoning&&e.isGenerating?(_(),C("div",l0,[...d[13]||(d[13]=[n("div",{class:"animate-spin h-3 w-3 border-2 border-emerald-600 border-t-transparent rounded-full"},null,-1),n("span",null,"AI 正在推理中...",-1)])])):e.currentReasoning?(_(),C("div",{key:1,class:"prose prose-xs max-w-none text-gray-700",innerHTML:g(f)},null,8,i0)):L("",!0),e.isGenerating&&e.currentReasoning?(_(),C("span",c0)):L("",!0)])):L("",!0)])):L("",!0),e.currentAnswer?(_(),C("div",{key:1,class:"prose prose-sm max-w-none",innerHTML:g(u)},null,8,d0)):L("",!0),e.isGenerating&&e.currentAnswer?(_(),C("span",u0)):L("",!0)])])):L("",!0)]))]),_:1})])):L("",!0)}}),p0=Object.assign(Se(f0,[["__scopeId","data-v-51abbea3"]]),{__name:"ConversationThread"}),g0={class:"follow-up-section"},v0={class:"flex flex-wrap gap-2 mb-3"},m0=["onClick","disabled"],h0={class:"mr-1"},b0={key:0,class:"flex gap-2"},y0={class:"flex gap-2"},x0=["disabled"],w0=["disabled"],_0={key:0,class:"text-xs text-gray-400 mt-2"},k0=P({__name:"FollowUpButtons",props:{buttons:{},loading:{type:Boolean},disabled:{type:Boolean}},emits:["select"],setup(e,{emit:t}){const o=e,s=t,r=B(""),a=i=>{o.disabled||o.loading||(s("select",i.label),r.value="")},l=()=>{const i=r.value.trim();if(console.log("🔍 handleCustomQuestion 调用",{question:i,disabled:o.disabled,hasQuestion:!!i}),!i||o.disabled){console.warn("❌ 自定义追问被阻止:",{question:i,disabled:o.disabled});return}console.log("✅ 发射 select 事件:",i),s("select",i),r.value=""};return(i,v)=>(_(),C("div",g0,[v[1]||(v[1]=n("p",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2"},[n("span",null,"💬"),n("span",null,"继续深入？")],-1)),n("div",v0,[(_(!0),C(te,null,ie(e.buttons,f=>(_(),C("button",{key:f.id,onClick:u=>a(f),disabled:e.disabled||e.loading,class:D(["px-3 py-2 text-sm rounded-lg border transition-all",[e.disabled||e.loading?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed":"border-emerald-300 bg-emerald-50 hover:bg-emerald-100 hover:border-emerald-400 text-emerald-700 hover:shadow-sm active:scale-95"]])},[n("span",h0,E(f.icon),1),n("span",null,E(f.label),1)],10,m0))),128)),e.loading&&e.buttons.length===0?(_(),C("div",b0,[(_(),C(te,null,ie(3,f=>n("div",{key:f,class:"px-3 py-2 rounded-lg bg-gray-100 animate-pulse",style:{width:"120px",height:"36px"}})),64))])):L("",!0)]),n("div",y0,[xe(n("input",{"onUpdate:modelValue":v[0]||(v[0]=f=>ye(r)?r.value=f:null),onKeydown:Yt(l,["enter"]),disabled:e.disabled,placeholder:"➕ 或者自定义提问...",class:D(["flex-1 min-w-0 px-3 py-2 text-sm rounded-lg border border-gray-300 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition-all",[e.disabled?"bg-gray-50 text-gray-400 cursor-not-allowed":"bg-white"]])},null,42,x0),[[Ct,g(r)]]),g(r).trim()?(_(),C("button",{key:0,onClick:l,disabled:e.disabled,class:D(["px-4 py-2 text-sm font-medium rounded-lg transition-all",[e.disabled?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-emerald-600 text-white hover:bg-emerald-700 active:scale-95"]])}," 发送 ",10,w0)):L("",!0)]),e.disabled?L("",!0):(_(),C("p",_0," 提示：点击按钮或输入问题后按 Enter 键发送 "))]))}}),C0=Object.assign(Se(k0,[["__scopeId","data-v-1f40130d"]]),{__name:"FollowUpButtons"}),vn="insightreader_stash",io=50,Hn=()=>{const e=U("stash-items",()=>[]),{title:t,content:o}=Ve(),s=p=>{const d={id:`stash_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),articleTitle:t.value,articleContent:o.value,selectedText:p.selectedText,context:p.context,intent:p.intent,customQuestion:p.customQuestion,insight:p.insight,reasoning:p.reasoning,conversationHistory:p.conversationHistory?[...p.conversationHistory]:void 0,modelUsed:p.modelUsed,tokens:p.tokens};return e.value.unshift(d),e.value.length>io&&(e.value=e.value.slice(0,io)),f(),console.log("📌 已暂存洞察:",d.selectedText.substring(0,20),"..."),d},r=p=>{const d=e.value.findIndex(c=>c.id===p);if(d>-1){const c=e.value.splice(d,1)[0];f(),console.log("🗑️ 已移除暂存:",c.selectedText.substring(0,20),"...")}},a=()=>{const p=e.value.length;e.value=[],localStorage.removeItem(vn),console.log("🗑️ 已清空暂存:",p,"个洞察")},l=(p,d)=>{const c=e.value.splice(p,1)[0];e.value.splice(d,0,c),f()},i=(p,d)=>e.value.some(c=>c.selectedText===p&&c.insight===d),v=()=>{try{const p=localStorage.getItem(vn);p&&(e.value=JSON.parse(p),console.log("📦 从存储加载暂存:",e.value.length,"个洞察"))}catch(p){console.error("加载暂存失败:",p)}},f=()=>{try{localStorage.setItem(vn,JSON.stringify(e.value))}catch(p){console.error("保存暂存失败:",p)}},u=()=>{const p=e.value.reduce((c,y)=>c+y.insight.length+(y.reasoning?.length||0),0),d=e.value.reduce((c,y)=>c+(y.conversationHistory?.length||0),0);return{count:e.value.length,totalWords:p,totalConversations:d,hasConversations:d>0,hasReasoning:e.value.some(c=>c.reasoning)}};return ge(()=>{v()}),{stashItems:le(e),addToStash:s,removeFromStash:r,clearStash:a,reorderStash:l,isStashed:i,getStats:u}},Uo=()=>{const e=me();let t=null;return{connect:async(r,a,l)=>{const i=`${e.public.apiBase}${r}`;t=new AbortController;const v=t.signal;try{const f=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:v});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);const u=f.body?.getReader(),p=new TextDecoder;if(!u)throw new Error("无法读取响应流");try{for(;;){const{done:d,value:c}=await u.read();if(d)break;const x=p.decode(c).split(`
`);for(const w of x)if(w.startsWith("data: ")){const h=w.substring(6);try{const m=JSON.parse(h);switch(m.type){case"start":l.onStart?.();break;case"delta":m.content&&l.onDelta?.(m.content);break;case"reasoning":m.content&&l.onReasoning?.(m.content);break;case"complete":l.onComplete?.(m.metadata);break;case"error":l.onError?.(m);break}}catch(m){console.error("解析 SSE 事件失败",m)}}}}finally{u.releaseLock(),t=null}}catch(f){if(f instanceof Error&&f.name==="AbortError"){console.log("⏹️ 用户停止了生成");return}throw l.onError?.({message:f instanceof Error?f.message:"未知错误"}),f}},abort:()=>{t&&(console.log("⏹️ 停止 SSE 连接"),t.abort(),t=null)}}},mn="insightreader_history",co=100,zn=()=>{const e=U("history",()=>[]),t=()=>{try{const f=localStorage.getItem(mn);f&&(e.value=JSON.parse(f))}catch(f){console.error("加载历史记录失败:",f)}},o=()=>{try{localStorage.setItem(mn,JSON.stringify(e.value))}catch(f){console.error("保存历史记录失败:",f)}},s=f=>{const u={...f,id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};return e.value.unshift(u),e.value.length>co&&(e.value=e.value.slice(0,co)),o(),u},r=f=>{e.value=e.value.filter(u=>u.id!==f),o()},a=()=>{e.value=[],localStorage.removeItem(mn)},l=f=>{const u=f.toLowerCase();return e.value.filter(p=>p.selectedText.toLowerCase().includes(u)||p.insight.toLowerCase().includes(u)||p.articleTitle?.toLowerCase().includes(u))},i=f=>e.value.filter(u=>u.intent===f),v=(f=10)=>e.value.slice(0,f);return ge(()=>{t()}),{history:le(e),addHistoryItem:s,deleteHistoryItem:r,clearHistory:a,searchHistory:l,filterByIntent:i,getRecentHistory:v}},ot=()=>{const e=U("is-generating",()=>!1),t=U("current-insight",()=>""),o=U("current-reasoning",()=>""),s=U("current-insight-id",()=>null),r=U("insight-error",()=>null),{addHistoryItem:a}=zn(),{title:l,content:i}=Ve(),{selectedStart:v,selectedEnd:f}=Et(),{user:u}=pt(),p=U("current-article-id",()=>null),d=me(),{connect:c,abort:y}=Uo();return{isGenerating:e,currentInsight:t,currentReasoning:o,currentInsightId:s,error:r,generate:async m=>{e.value=!0,t.value="",o.value="",r.value=null;try{await c("/api/v1/insights/generate",m,{onStart:()=>{t.value="",o.value="",console.log("🚀 开始生成洞察，推理模式:",m.use_reasoning)},onDelta:b=>{t.value+=b,console.log("📝 收到内容片段:",b.substring(0,50))},onReasoning:b=>{o.value+=b,console.log("🧠 收到推理片段:",b.substring(0,50))},onComplete:async b=>{if(e.value=!1,console.log("✅ 洞察生成完成",{metadata:b,hasReasoning:!!o.value,reasoningLength:o.value.length}),t.value&&a({selectedText:m.selected_text,context:m.context,intent:m.intent,customQuestion:m.custom_question,insight:t.value,articleTitle:l.value}),console.log("🔍 检查是否保存到后端:",{hasInsight:!!t.value,hasUser:!!u.value?.id,hasArticleId:!!p.value,userId:u.value?.id,articleId:p.value}),t.value&&u.value?.id&&p.value)try{const k=i.value,$=v.value||0,I=f.value||0,S=$>0?k.substring(Math.max(0,$-100),$):"",A=I<k.length?k.substring(I,Math.min(k.length,I+100)):"",R=await $fetch(`${d.public.apiBase}/api/v1/insights/history`,{method:"POST",body:{article_id:p.value,selected_text:m.selected_text,selected_start:v.value,selected_end:f.value,context_before:S,context_after:A,intent:m.intent,question:m.custom_question||null,insight:t.value,reasoning:o.value||null,parent_id:null}});s.value=R.insight_history_id,console.log("💾 洞察已保存到历史记录，ID:",R.insight_history_id)}catch(k){console.error("❌ 保存洞察历史失败:",k)}},onError:b=>{r.value=b.message||"生成失败",e.value=!1,console.error("❌ 生成错误:",b)}})}catch(b){r.value=b instanceof Error?b.message:"网络错误，请重试",e.value=!1}},clear:()=>{t.value="",o.value="",r.value=null,e.value=!1},stopGeneration:()=>{y(),e.value=!1,console.log("⏹️ 停止洞察生成")}}},Gt=()=>{const e=me(),t=U("followup-conversation",()=>[]),o=U("followup-buttons",()=>[]),s=U("followup-generating-buttons",()=>!1),r=U("followup-generating-answer",()=>!1),a=U("followup-current-answer",()=>""),l=U("followup-current-reasoning",()=>""),i=U("followup-error",()=>null),{connect:v,abort:f}=Uo();return{conversationHistory:t,followUpButtons:o,isGeneratingButtons:s,isGeneratingAnswer:r,currentAnswer:a,currentReasoning:l,error:i,generateButtons:async(x,w,h)=>{s.value=!0,i.value=null;const m=[{id:"example_default",label:"举个例子",icon:"🌰",category:"example"},{id:"simplify_default",label:"说得简单点",icon:"🎯",category:"simplify"},{id:"extend_default",label:"深入了解",icon:"📚",category:"extend"}];try{const b={selected_text:x,insight:w,intent:h,conversation_history:t.value},k=await $fetch(`${e.public.apiBase}/api/v1/insights/generate-buttons`,{method:"POST",body:b});k.status==="completed"&&k.buttons?(o.value=k.buttons,s.value=!1,console.log("🎯 生成追问按钮（立即返回）:",k.buttons.length,"个")):k.status==="pending"&&(o.value=m,console.log("🔄 按钮生成中，任务ID:",k.task_id))}catch(b){console.error("❌ 生成追问按钮失败:",b),i.value=b instanceof Error?b.message:"生成追问按钮失败",o.value=m,s.value=!1}},askFollowUp:async(x,w,h,m=!1)=>{r.value=!0,a.value="",l.value="",i.value=null;const{user:b}=pt(),{content:k}=Ve(),{selectedStart:$,selectedEnd:I}=Et(),{currentInsightId:S}=ot(),A=U("current-article-id",()=>null),R={role:"user",content:h,timestamp:Date.now()};t.value.push(R);const V=[];if(t.value.length===1||t.value.length>1&&t.value[0]?.role!=="assistant"){const{currentInsightId:G,currentReasoning:F}=ot();V.push({role:"assistant",content:w,reasoning:F.value||void 0,timestamp:Date.now(),insight_id:G.value||null})}V.push(...t.value.slice(0,-1)),console.log("📝 对话历史状态:",{conversationHistoryLength:t.value.length,fullHistoryForBackendLength:V.length,conversationHistory:t.value.map(G=>({role:G.role,content:G.content.substring(0,30)})),fullHistoryForBackend:V.map(G=>({role:G.role,content:G.content.substring(0,30)}))});try{const G={selected_text:x,initial_insight:w,conversation_history:V,follow_up_question:h,use_reasoning:m};console.log("📤 发送追问请求:",{selected_text:G.selected_text.substring(0,30),conversation_history_length:G.conversation_history.length,follow_up_question:G.follow_up_question}),await v("/api/v1/insights/follow-up",G,{onStart:()=>{console.log("🚀 开始生成追问回答")},onDelta:F=>{a.value+=F},onReasoning:F=>{l.value+=F},onComplete:async F=>{const Q={role:"assistant",content:a.value,reasoning:l.value||void 0,timestamp:Date.now(),insight_id:null};if(t.value.push(Q),console.log("✅ 追问回答完成",{metadata:F,conversationLength:t.value.length}),r.value=!1,a.value&&b.value?.id&&A.value)try{const K=k.value,ee=$.value||0,W=I.value||0,z=ee>0?K.substring(Math.max(0,ee-100),ee):"",q=W<K.length?K.substring(W,Math.min(K.length,W+100)):"";let Z=S.value;const J=t.value.filter(fe=>fe.role==="assistant"&&fe.insight_id);J.length>0&&(Z=J[J.length-1].insight_id);const re=await $fetch(`${e.public.apiBase}/api/v1/insights/history`,{method:"POST",body:{article_id:A.value,selected_text:x,selected_start:$.value,selected_end:I.value,context_before:z,context_after:q,intent:"follow_up",question:h,insight:a.value,reasoning:l.value||null,parent_id:Z}});console.log("💾 追问已保存到历史记录，ID:",re.insight_history_id,"父洞察ID:",Z),Q.insight_id=re.insight_history_id}catch(K){console.error("❌ 保存追问历史失败:",K)}},onError:F=>{i.value=F.message||"生成回答失败",r.value=!1,t.value.pop()}})}catch(G){i.value=G instanceof Error?G.message:"网络错误，请重试",r.value=!1,t.value.pop()}},clearConversation:()=>{t.value=[],o.value=[],a.value="",l.value="",i.value=null},undoLastQuestion:()=>{t.value.length>=2&&t.value.splice(-2,2)},stopFollowUp:()=>{f(),r.value=!1,console.log("⏹️ 停止追问生成")}}},$0=globalThis.setInterval,Go=()=>{const{user:e,token:t}=pt(),o=me();let s=null,r=null,a=0;const l=10,i=1e3,v=3e4;let f=Date.now(),u=null;const p=45e3,d=U("sse-connection-state",()=>"disconnected"),c=B(!1),y=new Map,x=[],w=[],h=[],m=[],b=()=>{r&&(clearTimeout(r),r=null)},k=()=>{u&&(clearInterval(u),u=null)},$=()=>{k(),f=Date.now(),u=$0(()=>{Date.now()-f>p&&(console.warn("[SSE] 心跳超时，连接可能已断开，尝试重连"),R(),d.value="disconnected",S())},1e4)},I=()=>Math.min(i*Math.pow(2,a),v)+Math.random()*1e3,S=()=>{if(c.value){console.log("[SSE] 手动断开连接，不重连");return}if(a>=l){console.error("[SSE] 达到最大重连次数，停止重连"),d.value="failed";return}b();const q=I();console.log(`[SSE] 安排重连（第 ${a+1}/${l} 次），延迟 ${Math.round(q)}ms`),d.value="reconnecting",r=setTimeout(()=>{a++,A()},q)},A=()=>{if(!e.value||!t.value){console.warn("[SSE] 用户未登录或 token 缺失");return}if(s&&s.readyState!==EventSource.CLOSED){console.log("[SSE] 连接已存在");return}const q=`${o.public.apiBase}/api/v1/sse/analysis-notifications?token=${t.value}`;console.log("[SSE] 正在连接:",a>0?`(第 ${a} 次重连)`:"(首次连接)");try{s=new EventSource(q),d.value="connecting",s.onopen=()=>{console.log("[SSE] 连接已建立"),d.value="connected",a=0,b(),$()},s.addEventListener("connected",Z=>{const J=JSON.parse(Z.data);console.log("[SSE] 收到连接确认，用户ID:",J.user_id),f=Date.now()}),s.addEventListener("task_started",Z=>{const J=JSON.parse(Z.data);console.log("[SSE] 任务开始:",J.task_type,J.task_id)}),s.addEventListener("task_completed",async Z=>{const J=JSON.parse(Z.data);if(console.log("[SSE] 任务完成:",J.task_type,J.task_id),J.task_type==="article_analysis"||J.task_type==="article_reanalysis"){const re=J.result.article_id,fe=y.get(re);fe&&await fe(re),await W(re)}else if(J.task_type==="meta_analysis")for(const re of x)await re(J.result.article_id,J.result.meta_analysis);else if(J.task_type.startsWith("thinking_lens_")){const re=J.task_type.replace("thinking_lens_","");for(const fe of w)await fe(re,J.result.lens_result)}else if(J.task_type==="button_generation")for(const re of h)await re(J.result.buttons)}),s.addEventListener("task_failed",Z=>{const J=JSON.parse(Z.data);console.error("[SSE] 任务失败:",J.task_type,J.error);for(const re of m)re(J.task_type,J.error);showToast({message:`分析失败: ${J.error}`,type:"error"})}),s.addEventListener("heartbeat",Z=>{f=Date.now()}),s.onerror=Z=>{console.error("[SSE] 连接错误:",Z),s?.readyState===EventSource.CONNECTING?(console.log("[SSE] 正在尝试重连..."),d.value="reconnecting"):s?.readyState===EventSource.CLOSED&&(console.warn("[SSE] 连接已关闭，尝试重连"),R(),d.value="disconnected",S())}}catch(Z){console.error("[SSE] 创建连接失败:",Z),d.value="failed",S()}},R=()=>{k(),s&&(s.close(),s=null,console.log("[SSE] 连接已关闭"))},V=()=>{c.value=!0,b(),k(),s&&(s.close(),s=null,console.log("[SSE] 连接已断开")),d.value="disconnected",a=0},G=(q,Z)=>{y.set(q,Z)},F=q=>{x.push(q)},Q=q=>{w.push(q)},K=q=>{h.push(q)},ee=q=>{m.push(q)},W=async q=>{console.log("📄 分析完成事件触发，文章 ID:",q)};return ge(()=>{A()}),Qe(()=>{V()}),{connect:A,disconnect:V,reconnect:()=>{c.value=!1,a=0,A()},connectionState:le(d),isManuallyDisconnected:le(c),onAnalysisComplete:G,onMetaAnalysisComplete:F,onLensComplete:Q,onButtonGenerationComplete:K,onTaskFailed:ee}},S0={class:"p-6 h-full flex flex-col"},A0={class:"flex-1 overflow-auto"},M0={key:0,class:"bg-red-50 border-l-4 border-red-500 rounded-r-lg p-4 mb-4"},E0={class:"flex items-start gap-3"},T0={class:"text-red-700 text-sm"},L0={key:"content"},B0={key:0,class:"flex items-center justify-between gap-3 text-gray-700 mb-6 p-4 bg-emerald-50 rounded-xl border border-emerald-100"},I0={key:1,class:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden"},R0={key:0,class:"px-6 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100 flex justify-end gap-2"},O0=["disabled"],P0={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},H0={key:1,class:"animate-spin h-4 w-4 border-2 border-amber-600 border-t-transparent rounded-full"},z0={key:1,class:"flex items-center gap-2 text-amber-700 text-sm px-3 py-1.5 bg-amber-50 rounded-lg border border-amber-200"},j0={key:0,class:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},D0={key:1,class:"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full mr-2"},q0={key:3,class:"flex items-center gap-2 text-green-700 text-sm px-3 py-1.5 bg-green-50 rounded-lg border border-green-200"},N0={class:"px-6 py-6"},V0={class:"flex items-start gap-3"},F0=["innerHTML"],W0={class:"flex-1 min-w-0"},U0={key:1,class:"mb-6"},G0={key:0,class:"p-4 bg-gray-50 rounded-xl border border-gray-200 mb-6 overflow-hidden"},K0={key:0,class:"flex items-center gap-2 text-gray-500 text-sm"},Y0=["innerHTML"],X0={key:2,class:"inline-block w-0.5 h-5 bg-emerald-600 animate-blink ml-1 align-middle"},J0=["innerHTML"],Q0={key:2,class:"inline-block w-0.5 h-5 bg-emerald-600 animate-blink ml-1 align-middle"},Z0={key:3,class:"mt-6 pt-6 border-t border-gray-100"},ef={key:"empty",class:"text-center py-20 animate-fade-in"},tf=P({__name:"InsightPane",props:{insight:{},reasoning:{},isLoading:{type:Boolean},error:{},currentRequest:{},useReasoning:{type:Boolean}},setup(e){const t=e,{isAuthenticated:o}=pt(),{saveInsight:s}=Fs(),{addToStash:r,isStashed:a}=Hn(),{conversationHistory:l,followUpButtons:i,isGeneratingButtons:v,isGeneratingAnswer:f,currentAnswer:u,currentReasoning:p,generateButtons:d,askFollowUp:c,stopFollowUp:y}=Gt(),{stopGeneration:x}=ot(),{onButtonGenerationComplete:w}=Go(),h=B(!1),m=B(!1),b=B(!1),k=M(()=>!t.insight||!t.currentRequest?!1:a(t.currentRequest.selected_text,t.insight)),$=B(!0),I=U("use-reasoning",()=>!1),S=M(()=>t.insight?tt(t.insight,{breaks:!0}):""),A=M(()=>t.reasoning?tt(t.reasoning,{breaks:!0}):"");oe(()=>t.reasoning,W=>{W&&W.length>0&&($.value=!0)}),ge(()=>{w(W=>{console.log("📬 收到按钮生成完成通知:",W.length,"个",W),i.value=W,v.value=!1,console.log("✅ 按钮状态已更新，当前按钮数:",i.value.length,"加载状态:",v.value)})}),oe(()=>[t.insight,t.isLoading],([W,z],[q,Z])=>{!z&&Z&&W&&t.currentRequest&&d(t.currentRequest.selected_text,W,t.currentRequest.intent)});const R=async()=>{if(!t.currentRequest){alert("无法保存：缺少请求信息");return}h.value=!0;const W=await s({selected_text:t.currentRequest.selected_text,context:t.currentRequest.context,intent:t.currentRequest.intent,custom_question:t.currentRequest.custom_question,insight:t.insight});h.value=!1,W.success?(m.value=!0,setTimeout(()=>{m.value=!1},3e3)):alert(W.error||"收藏失败")},V=async()=>{if(!t.currentRequest||!t.insight){alert("无法暂存：缺少内容");return}b.value=!0;try{r({selectedText:t.currentRequest.selected_text,context:t.currentRequest.context,intent:t.currentRequest.intent,customQuestion:t.currentRequest.custom_question,insight:t.insight,reasoning:t.reasoning||void 0,conversationHistory:l.value.length>0?[...l.value]:void 0}),console.log("✅ 暂存成功"),setTimeout(()=>{b.value=!1},500)}catch(W){console.error("暂存失败:",W),alert("暂存失败"),b.value=!1}},G=()=>{console.log("🛑 用户点击停止按钮"),t.isLoading&&x(),f.value&&y()},F=async W=>{if(console.log("🔍 handleFollowUpSelect 调用",{hasCurrentRequest:!!t.currentRequest,hasInsight:!!t.insight,question:W,conversationHistoryLength:l.value.length}),!t.currentRequest||!t.insight){console.warn("❌ 缺少必要参数:",{currentRequest:t.currentRequest,insight:t.insight?`${t.insight.substring(0,50)}...`:null});return}const{currentInsightId:z}=ot();console.log("🔍 追问前检查:",{historyLength:l.value.length,currentInsightId:z.value,currentInsight:t.insight.substring(0,50)});const q=U("use-reasoning",()=>!1);console.log("✅ 开始追问:",{selectedText:t.currentRequest.selected_text.substring(0,30),question:W,useReasoning:q.value,conversationHistoryLength:l.value.length}),await c(t.currentRequest.selected_text,t.insight,W,q.value),u.value&&d(t.currentRequest.selected_text,t.insight,t.currentRequest.intent)},Q=()=>{if(!t.currentRequest)return;if(t.currentRequest.custom_question&&t.currentRequest.custom_question.trim())return t.currentRequest.custom_question;const z={explain:"这是什么意思？",analyze:"作者为什么这么说？",counter:"有不同的看法吗？",custom:"自定义问题"}[t.currentRequest.intent];return z||t.currentRequest.selected_text},K=()=>t.currentRequest?{explain:{color:"text-emerald-800",bgColor:"bg-emerald-50/80",borderColor:"border-emerald-400",icon:`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>`},analyze:{color:"text-teal-800",bgColor:"bg-teal-50/80",borderColor:"border-teal-400",icon:`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
      </svg>`},counter:{color:"text-slate-800",bgColor:"bg-slate-50/80",borderColor:"border-slate-400",icon:`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
      </svg>`},custom:{color:"text-purple-800",bgColor:"bg-purple-50/80",borderColor:"border-purple-400",icon:`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>`}}[t.currentRequest.intent]||{color:"text-blue-800",bgColor:"bg-blue-50/80",borderColor:"border-blue-400",icon:`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>`}:null,ee=()=>t.currentRequest?{explain:"解释说明",analyze:"深度分析",counter:"反向思考",custom:"自定义问题"}[t.currentRequest.intent]||"提问":"";return(W,z)=>{const q=Sn,Z=p0,J=C0;return _(),C("div",S0,[z[14]||(z[14]=Me('<div class="mb-6" data-v-78a5c007><div class="flex items-center gap-2 mb-2" data-v-78a5c007><div class="w-8 h-8 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center" data-v-78a5c007><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-78a5c007><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" data-v-78a5c007></path></svg></div><h2 class="text-lg font-semibold text-gray-900" data-v-78a5c007>AI 洞察</h2></div><p class="text-sm text-gray-500" data-v-78a5c007>深度解析你选中的内容</p></div>',1)),n("div",A0,[O(de,{"enter-active-class":"transition-all duration-300","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0"},{default:T(()=>[e.error?(_(),C("div",M0,[n("div",E0,[z[2]||(z[2]=n("svg",{class:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),n("div",null,[z[1]||(z[1]=n("p",{class:"text-red-800 text-sm font-medium mb-1"},"出错了",-1)),n("p",T0,E(e.error),1)])])])):L("",!0)]),_:1}),O(de,{"enter-active-class":"transition-all duration-300","enter-from-class":"opacity-0 translate-y-4","enter-to-class":"opacity-100 translate-y-0",mode:"out-in"},{default:T(()=>[e.insight||e.reasoning||e.isLoading?(_(),C("div",L0,[e.isLoading&&!e.insight&&!e.reasoning?(_(),C("div",B0,[z[4]||(z[4]=n("div",{class:"flex items-center gap-3"},[n("div",{class:"relative"},[n("div",{class:"animate-spin h-5 w-5 border-2 border-emerald-600 border-t-transparent rounded-full"}),n("div",{class:"absolute inset-0 animate-ping h-5 w-5 border-2 border-emerald-400 border-t-transparent rounded-full opacity-20"})]),n("div",null,[n("p",{class:"text-sm font-semibold"},"AI 正在思考..."),n("p",{class:"text-xs text-gray-600 mt-0.5"},"正在为你生成深度洞察")])],-1)),n("button",{onClick:G,class:"px-3 py-1.5 text-sm font-medium bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center gap-2"},[...z[3]||(z[3]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ne(" 停止 ",-1)])])])):L("",!0),e.insight||e.reasoning||e.isLoading&&e.useReasoning?(_(),C("div",I0,[e.isLoading?L("",!0):(_(),C("div",R0,[g(k)?(_(),C("div",z0,[...z[6]||(z[6]=[n("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),n("span",{class:"font-medium"},"已暂存",-1)])])):(_(),C("button",{key:0,onClick:V,disabled:g(b),class:D(["px-3 py-1.5 text-sm font-medium rounded-lg transition-all flex items-center gap-1.5",[g(b)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-amber-50 text-amber-700 border border-amber-200 hover:bg-amber-100 hover:border-amber-300"]])},[g(b)?(_(),C("div",H0)):(_(),C("svg",P0,[...z[5]||(z[5]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"},null,-1)])])),n("span",null,E(g(b)?"暂存中...":"📌 暂存"),1)],10,O0)),g(o)&&!g(m)?(_(),j(q,{key:2,variant:"outline",size:"sm",onClick:R,disabled:g(h),class:"hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all"},{default:T(()=>[g(h)?(_(),C("div",D0)):(_(),C("svg",j0,[...z[7]||(z[7]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"},null,-1)])])),ne(" "+E(g(h)?"收藏中...":"收藏此洞察"),1)]),_:1},8,["disabled"])):g(o)&&g(m)?(_(),C("div",q0,[...z[8]||(z[8]=[n("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),n("span",{class:"font-medium"},"已收藏",-1)])])):L("",!0)])),n("div",N0,[e.currentRequest&&!e.isLoading&&K()?(_(),C("div",{key:0,class:D(["mb-6 p-4 border-l-4 rounded-r-lg transition-all",K()?.bgColor,K()?.borderColor])},[n("div",V0,[n("div",{class:D(["flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center",K()?.bgColor.replace("/80",""),K()?.color]),innerHTML:K()?.icon},null,10,F0),n("div",W0,[n("div",{class:D(["text-xs font-semibold mb-1.5 uppercase tracking-wide",K()?.color])},E(ee()),3),n("p",{class:D(["text-sm leading-relaxed",K()?.color])},E(Q()),3)])])],2)):L("",!0),e.useReasoning||e.reasoning?(_(),C("div",U0,[n("button",{onClick:z[0]||(z[0]=re=>$.value=!g($)),class:"flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-emerald-700 transition-colors mb-3"},[(_(),C("svg",{class:D(["w-4 h-4 transition-transform",g($)&&"rotate-90"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...z[9]||(z[9]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)),z[10]||(z[10]=n("span",null,"思维链",-1)),z[11]||(z[11]=n("span",{class:"px-2 py-0.5 rounded text-xs bg-emerald-100 text-emerald-700"},"推理模式",-1))]),g($)?(_(),C("div",G0,[!e.reasoning&&e.isLoading?(_(),C("div",K0,[...z[12]||(z[12]=[n("div",{class:"animate-spin h-4 w-4 border-2 border-emerald-600 border-t-transparent rounded-full"},null,-1),n("span",null,"AI 正在推理中...",-1)])])):(_(),C("div",{key:1,class:"prose prose-sm max-w-none text-gray-700",innerHTML:g(A)},null,8,Y0)),e.isLoading&&e.reasoning?(_(),C("span",X0)):L("",!0)])):L("",!0)])):L("",!0),n("div",{class:"prose prose-sm max-w-none",innerHTML:g(S)},null,8,J0),e.isLoading?(_(),C("span",Q0)):L("",!0),!e.isLoading&&e.insight?(_(),C("div",Z0,[g(l).length>0||g(f)&&g(u)||e.currentRequest?(_(),j(Z,{key:0,messages:g(l),"initial-user-question":Q(),"is-generating":g(f),"current-answer":g(u),"current-reasoning":g(p),"use-reasoning":g(I),onStop:G,class:"mb-6"},null,8,["messages","initial-user-question","is-generating","current-answer","current-reasoning","use-reasoning"])):L("",!0),O(J,{buttons:g(i),loading:g(v)||g(f),disabled:g(f),onSelect:F},null,8,["buttons","loading","disabled"])])):L("",!0)])])):L("",!0)])):(_(),C("div",ef,[...z[13]||(z[13]=[n("div",{class:"mb-6 relative"},[n("div",{class:"absolute inset-0 flex items-center justify-center"},[n("div",{class:"w-24 h-24 bg-emerald-100 rounded-full animate-pulse opacity-20"})]),n("svg",{class:"w-20 h-20 mx-auto text-emerald-500 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})])],-1),n("h3",{class:"text-xl font-semibold text-gray-700 mb-3"},"等待你的提问",-1),n("p",{class:"text-gray-500 mb-2"},"在左侧文章中选中文字",-1),n("p",{class:"text-sm text-gray-400"},"AI 会帮你深度理解选中的内容",-1)])]))]),_:1})])])}}}),nf=Object.assign(Se(tf,[["__scopeId","data-v-78a5c007"]]),{__name:"InsightPane"}),Ko=()=>{const e=[{type:"md",label:"Markdown (.md)",mimeType:"text/markdown;charset=utf-8",extension:"md"},{type:"txt",label:"纯文本 (.txt)",mimeType:"text/plain;charset=utf-8",extension:"txt"}],t=v=>({explain:"解释",analyze:"分析",counter:"反驳"})[v]||v,o=v=>new Date(v).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),s=v=>{if(v.length===0)return"";const f=v[0],u=f.articleTitle||"我的阅读笔记",p=f.articleContent;let d=`# ${u}

`;return d+=`📅 生成时间：${new Date().toLocaleString("zh-CN")}
`,d+=`📝 共 ${v.length} 个洞察

`,d+=`---

`,p&&p.trim()&&(d+=`## 📖 原文内容

`,d+=`${p}

`,d+=`---

`),d+=`## 💡 我的洞察

`,v.forEach((c,y)=>{d+=`### ${y+1}. "${c.selectedText}"

`,d+=`- **意图**：${t(c.intent)}
`,d+=`- **时间**：${o(c.timestamp)}
`,c.modelUsed&&(d+=`- **模型**：${c.modelUsed}
`),c.customQuestion&&(d+=`- **自定义问题**：${c.customQuestion}
`),d+=`
`,c.context&&c.context.trim()&&(d+=`**上下文**：

`,d+=`> ${c.context.replace(/\n/g,`
> `)}

`),c.reasoning&&c.reasoning.trim()&&(d+=`#### 🧠 思维链

`,d+=`${c.reasoning}

`),d+=`#### 💬 洞察内容

`,d+=`${c.insight}

`,c.conversationHistory&&c.conversationHistory.length>0&&(d+=`#### 🔄 对话记录（${c.conversationHistory.length/2} 轮追问）

`,c.conversationHistory.forEach(x=>{const w=x.role==="user"?"**你**":"**AI**";d+=`${w}：${x.content}

`})),d+=`---

`}),d+=`
> 🤖 由 InsightReader 生成 | [https://insightreader.ai](https://insightreader.ai)
`,d},r=v=>{if(v.length===0)return"";const f=v[0],u=f.articleTitle||"我的阅读笔记",p=f.articleContent;let d=`${u}
`;return d+=`${"=".repeat(u.length)}

`,d+=`生成时间：${new Date().toLocaleString("zh-CN")}
`,d+=`共 ${v.length} 个洞察

`,d+=`${"-".repeat(60)}

`,p&&p.trim()&&(d+=`原文内容

`,d+=`${p}

`,d+=`${"-".repeat(60)}

`),d+=`我的洞察

`,v.forEach((c,y)=>{d+=`${y+1}. "${c.selectedText}"

`,d+=`意图：${t(c.intent)}
`,d+=`时间：${o(c.timestamp)}
`,c.customQuestion&&(d+=`问题：${c.customQuestion}
`),d+=`
`,c.context&&c.context.trim()&&(d+=`上下文：
${c.context}

`),c.reasoning&&c.reasoning.trim()&&(d+=`思维链：
${c.reasoning}

`),d+=`洞察内容：
${c.insight}

`,c.conversationHistory&&c.conversationHistory.length>0&&(d+=`对话记录（${c.conversationHistory.length/2} 轮追问）：
`,c.conversationHistory.forEach(x=>{const w=x.role==="user"?"你":"AI";d+=`${w}：${x.content}
`}),d+=`
`),d+=`${"-".repeat(60)}

`}),d+=`
由 InsightReader 生成
`,d},a=(v,f,u)=>{try{const d=new Blob(["\uFEFF"+v],{type:u}),c=URL.createObjectURL(d),y=document.createElement("a");y.href=c,y.download=f,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(c),console.log("📥 文件下载成功:",f)}catch(p){throw console.error("文件下载失败:",p),p}};return{exportFormats:e,exportInsights:(v,f="md",u)=>{if(v.length===0)throw new Error("没有可导出的内容");const p=new Date().toISOString().split("T")[0],y=`${(v[0].articleTitle||"我的阅读笔记").replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"_").substring(0,30)}_${p}`;let x,w,h;switch(f){case"md":x=s(v),w="text/markdown;charset=utf-8",h="md";break;case"txt":x=r(v),w="text/plain;charset=utf-8",h="txt";break;default:throw new Error("不支持的导出格式")}const m=u?`${u}.${h}`:`${y}.${h}`;a(x,m,w)},exportAsMarkdown:s,exportAsText:r,copyToClipboard:async(v,f="md")=>{try{const u=f==="md"?s(v):r(v);return await navigator.clipboard.writeText(u),console.log("📋 已复制到剪贴板"),!0}catch(u){return console.error("复制失败:",u),!1}},getIntentLabel:t,formatTime:o}},of={class:"px-6 py-5 space-y-5"},sf={class:"flex items-center gap-2 text-sm text-gray-600 bg-gray-50 rounded-lg p-3"},rf={class:"text-emerald-700"},af={class:"space-y-2"},lf=["value"],cf={class:"flex-1"},df={class:"font-medium text-gray-900"},uf={class:"text-xs text-gray-500"},ff={class:"flex items-center gap-2"},pf={class:"text-sm text-gray-500"},gf={class:"text-xs text-gray-500 mt-1"},vf={class:"space-y-2"},mf={class:"flex items-center gap-2 text-sm text-gray-700 cursor-pointer"},hf={class:"flex items-center gap-2 text-sm text-gray-700 cursor-pointer"},bf={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-3"},yf=["disabled"],xf={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},wf=P({__name:"ExportDialog",props:{show:{type:Boolean},items:{}},emits:["close","exported"],setup(e,{emit:t}){const o=e,s=t,{exportInsights:r,exportFormats:a}=Ko(),l=B("md"),i=B(""),v=B(!0),f=B(!0),u=B(!1),p=M(()=>o.items.length),d=M(()=>{const h=new Date().toISOString().split("T")[0];return`${(o.items[0]?.articleTitle||"我的阅读笔记").replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,"_").substring(0,30)}_${h}`}),c=h=>h==="md"?"md":"txt",y=h=>({md:"保留格式，适合 Notion、Obsidian 等笔记软件",txt:"纯文本，适合剪贴板粘贴"})[h],x=()=>{u.value||s("close")},w=async()=>{if(!(u.value||o.items.length===0)){u.value=!0;try{const h=o.items.map(m=>({...m,conversationHistory:v.value?m.conversationHistory:void 0,reasoning:f.value?m.reasoning:void 0}));r(h,l.value,i.value.trim()||void 0),console.log("✅ 导出成功"),setTimeout(()=>{s("exported"),s("close"),u.value=!1},500)}catch(h){console.error("导出失败:",h),alert("导出失败："+(h instanceof Error?h.message:"未知错误")),u.value=!1}}};return oe(()=>o.show,h=>{h&&(l.value="md",i.value="",v.value=!0,f.value=!0)}),(h,m)=>(_(),j(de,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[e.show?(_(),C("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:_e(x,["self"])},[O(de,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:T(()=>[e.show?(_(),C("div",{key:0,class:"bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden",onClick:m[4]||(m[4]=_e(()=>{},["stop"]))},[n("div",{class:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-emerald-50 to-white"},[n("div",{class:"flex items-center justify-between"},[m[6]||(m[6]=n("div",{class:"flex items-center gap-3"},[n("div",{class:"w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center"},[n("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),n("div",null,[n("h3",{class:"text-lg font-semibold text-gray-900"},"导出洞察笔记"),n("p",{class:"text-sm text-gray-500"},"将暂存的洞察导出为文件")])],-1)),n("button",{onClick:x,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...m[5]||(m[5]=[n("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),n("div",of,[n("div",sf,[m[9]||(m[9]=n("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),n("span",null,[m[7]||(m[7]=ne("将导出 ",-1)),n("strong",rf,E(g(p)),1),m[8]||(m[8]=ne(" 个洞察卡片",-1))])]),n("div",null,[m[10]||(m[10]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 选择导出格式 ",-1)),n("div",af,[(_(!0),C(te,null,ie(g(a),b=>(_(),C("label",{key:b.type,class:D(["flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-all",[g(l)===b.type?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-emerald-300 hover:bg-gray-50"]])},[xe(n("input",{type:"radio",value:b.type,"onUpdate:modelValue":m[0]||(m[0]=k=>ye(l)?l.value=k:null),class:"w-4 h-4 text-emerald-600 focus:ring-emerald-500"},null,8,lf),[[js,g(l)]]),n("div",cf,[n("div",df,E(b.label),1),n("div",uf,E(y(b.type)),1)])],2))),128))])]),n("div",null,[m[11]||(m[11]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 文件名（可选） ",-1)),n("div",ff,[xe(n("input",{"onUpdate:modelValue":m[1]||(m[1]=b=>ye(i)?i.value=b:null),type:"text",placeholder:"留空使用默认文件名",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none text-sm"},null,512),[[Ct,g(i)]]),n("span",pf,"."+E(c(g(l))),1)]),n("p",gf," 默认："+E(g(d))+"."+E(c(g(l))),1)]),n("div",vf,[n("label",mf,[xe(n("input",{type:"checkbox","onUpdate:modelValue":m[2]||(m[2]=b=>ye(v)?v.value=b:null),class:"w-4 h-4 text-emerald-600 focus:ring-emerald-500 rounded"},null,512),[[bn,g(v)]]),m[12]||(m[12]=n("span",null,"包含追问对话记录",-1))]),n("label",hf,[xe(n("input",{type:"checkbox","onUpdate:modelValue":m[3]||(m[3]=b=>ye(f)?f.value=b:null),class:"w-4 h-4 text-emerald-600 focus:ring-emerald-500 rounded"},null,512),[[bn,g(f)]]),m[13]||(m[13]=n("span",null,"包含推理过程（思维链）",-1))])])]),n("div",bf,[n("button",{onClick:x,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," 取消 "),n("button",{onClick:w,disabled:g(u),class:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2"},[g(u)?(_(),C("div",xf)):L("",!0),n("span",null,E(g(u)?"导出中...":"下载"),1)],8,yf)])])):L("",!0)]),_:1})])):L("",!0)]),_:1}))}}),_f=Object.assign(wf,{__name:"ExportDialog"}),kf={class:"stash-panel h-full flex flex-col"},Cf={class:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white"},$f={class:"flex items-center justify-between mb-3"},Sf={class:"flex items-center gap-2"},Af={class:"text-lg font-semibold text-gray-900"},Mf={key:0,class:"text-emerald-600"},Ef={class:"flex items-center gap-2"},Tf={key:0,class:"flex items-center gap-4 text-xs text-gray-600"},Lf={key:0},Bf={key:1},If={class:"flex-1 overflow-auto"},Rf={key:0,class:"flex flex-col items-center justify-center h-full text-center py-20 px-6"},Of={key:1,class:"p-4 space-y-3"},Pf={class:"px-4 py-3 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100"},Hf={class:"flex items-start justify-between gap-3"},zf={class:"flex-1 min-w-0"},jf={class:"text-sm font-medium text-gray-900 truncate mb-1"},Df={class:"flex items-center gap-3 text-xs text-gray-500"},qf={class:"flex items-center gap-1"},Nf={class:"flex items-center gap-1"},Vf=["onClick"],Ff=["onClick"],Wf={class:"px-4 py-3"},Uf={class:"text-sm text-gray-600 line-clamp-2"},Gf={key:0,class:"mt-2 flex items-center gap-1 text-xs text-emerald-600"},Kf=P({__name:"StashPanel",emits:["viewItem"],setup(e,{emit:t}){const o=t,{stashItems:s,removeFromStash:r,clearStash:a,getStats:l}=Hn(),{formatTime:i,getIntentLabel:v}=Ko(),f=B(!1),u=M(()=>l()),p=(w,h)=>w.length<=h?w:w.substring(0,h)+"...",d=w=>{confirm("确定要移除这个暂存的洞察吗？")&&r(w)},c=()=>{confirm(`确定要清空所有 ${u.value.count} 个暂存的洞察吗？此操作不可恢复。`)&&a()},y=w=>{o("viewItem",w)},x=()=>{console.log("✅ 导出成功")};return(w,h)=>{const m=_f;return _(),C("div",kf,[n("div",Cf,[n("div",$f,[n("div",Sf,[h[3]||(h[3]=n("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})],-1)),n("h3",Af,[h[2]||(h[2]=ne(" 暂存 ",-1)),g(u).count>0?(_(),C("span",Mf,"("+E(g(u).count)+")",1)):L("",!0)])]),n("div",Ef,[g(u).count>0?(_(),C("button",{key:0,onClick:h[0]||(h[0]=b=>f.value=!0),class:"px-3 py-1.5 text-sm font-medium text-emerald-700 bg-emerald-100 hover:bg-emerald-200 rounded-lg transition-colors flex items-center gap-1"},[...h[4]||(h[4]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),n("span",null,"导出",-1)])])):L("",!0),g(u).count>0?(_(),C("button",{key:1,onClick:c,class:"px-3 py-1.5 text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex items-center gap-1"},[...h[5]||(h[5]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),n("span",null,"清空",-1)])])):L("",!0)])]),g(u).count>0?(_(),C("div",Tf,[n("span",null,"📝 "+E(g(u).totalWords)+" 字",1),g(u).hasConversations?(_(),C("span",Lf,"💬 "+E(g(u).totalConversations)+" 条对话",1)):L("",!0),g(u).hasReasoning?(_(),C("span",Bf,"🧠 含推理内容")):L("",!0)])):L("",!0)]),n("div",If,[g(s).length===0?(_(),C("div",Rf,[...h[6]||(h[6]=[Me('<div class="mb-6 relative" data-v-2f30ae25><div class="absolute inset-0 flex items-center justify-center" data-v-2f30ae25><div class="w-24 h-24 bg-gray-100 rounded-full animate-pulse opacity-20" data-v-2f30ae25></div></div><svg class="w-20 h-20 mx-auto text-gray-300 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-2f30ae25><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" data-v-2f30ae25></path></svg></div><h3 class="text-lg font-semibold text-gray-700 mb-2" data-v-2f30ae25>暂存区为空</h3><p class="text-sm text-gray-500 mb-1" data-v-2f30ae25>在洞察卡片上点击&quot;暂存&quot;按钮</p><p class="text-xs text-gray-400" data-v-2f30ae25>可以保存多个洞察，阅读结束后一键导出</p>',4)])])):(_(),C("div",Of,[(_(!0),C(te,null,ie(g(s),(b,k)=>(_(),C("div",{key:b.id,class:"stash-item bg-white rounded-xl border border-gray-200 hover:border-emerald-300 hover:shadow-md transition-all overflow-hidden"},[n("div",Pf,[n("div",Hf,[n("div",zf,[n("h4",jf,E(k+1)+'. "'+E(p(b.selectedText,40))+'" ',1),n("div",Df,[n("span",qf,[h[7]||(h[7]=n("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),ne(" "+E(g(i)(b.timestamp)),1)]),n("span",null,E(g(v)(b.intent)),1),n("span",null,E(b.insight.length)+" 字",1)])]),n("div",Nf,[n("button",{onClick:$=>y(b),class:"p-1.5 text-gray-400 hover:text-emerald-600 hover:bg-emerald-50 rounded transition-colors",title:"查看详情"},[...h[8]||(h[8]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,Vf),n("button",{onClick:$=>d(b.id),class:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"移除"},[...h[9]||(h[9]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ff)])])]),n("div",Wf,[n("p",Uf,E(p(b.insight,100)),1),b.conversationHistory&&b.conversationHistory.length>0?(_(),C("div",Gf,[h[10]||(h[10]=n("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)),n("span",null,"含 "+E(b.conversationHistory.length/2)+" 轮对话",1)])):L("",!0)])]))),128))]))]),O(m,{show:g(f),items:g(s),onClose:h[1]||(h[1]=b=>f.value=!1),onExported:x},null,8,["show","items"])])}}}),Yf=Object.assign(Se(Kf,[["__scopeId","data-v-2f30ae25"]]),{__name:"StashPanel"}),Xf={class:"flex h-[calc(100vh-64px)]"},Jf={class:"flex-1 overflow-auto relative"},Qf={class:"w-px bg-gradient-to-b from-transparent via-gray-200 to-transparent shadow-sm"},Zf={class:"w-[580px] overflow-auto relative bg-gradient-to-br from-white via-slate-50/30 to-white"},ep={class:"relative z-10"},tp=P({__name:"ReaderLayout",setup(e,{expose:t}){const o=U("insight-panel-expanded",()=>!1);return t({togglePanel:()=>{o.value=!o.value},isPanelExpanded:()=>o.value}),(r,a)=>(_(),C("div",Xf,[n("div",Jf,[a[0]||(a[0]=n("div",{class:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl pointer-events-none"},null,-1)),Y(r.$slots,"left",{},void 0,!0)]),xe(n("div",Qf,null,512),[[qt,g(o)]]),O(de,{name:"slide-fade"},{default:T(()=>[xe(n("div",Zf,[a[1]||(a[1]=n("div",{class:"absolute inset-0 bg-[radial-gradient(#e5e7eb_0.5px,transparent_0.5px)] [background-size:12px_12px] opacity-20 pointer-events-none"},null,-1)),n("div",ep,[Y(r.$slots,"right",{},void 0,!0)])],512),[[qt,g(o)]])]),_:3})]))}}),np=Object.assign(Se(tp,[["__scopeId","data-v-76c96116"]]),{__name:"ReaderLayout"}),op=P({__name:"SelectionTrigger",props:{show:{type:Boolean},position:{}},emits:["click","close"],setup(e,{emit:t}){const o=e,s=t,r=M(()=>{if(!o.show)return{};const i=48,v=8;let f=o.position.x,u=o.position.y;return{left:`${f+v}px`,top:`${u-i-v}px`}}),a=()=>{s("click")},l=()=>{s("close")};return(i,v)=>(_(),C(te,null,[O(de,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[e.show?(_(),C("div",{key:0,class:"fixed inset-0 z-40",onClick:l})):L("",!0)]),_:1}),O(de,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:T(()=>[e.show?(_(),C("button",{key:0,style:ve(g(r)),onClick:_e(a,["stop"]),class:"fixed z-50 w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 rounded-full shadow-lg hover:shadow-xl flex items-center justify-center transition-all group",title:"AI 洞察"},[...v[0]||(v[0]=[n("svg",{class:"w-6 h-6 text-white group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),n("span",{class:"absolute inset-0 rounded-full bg-emerald-400 opacity-75 animate-ping"},null,-1)])],4)):L("",!0)]),_:1})],64))}}),sp=Object.assign(Se(op,[["__scopeId","data-v-583b2f40"]]),{__name:"SelectionTrigger"}),rp={class:"px-4 py-3 bg-gradient-to-r from-slate-50 to-zinc-50 border-b border-gray-200 flex items-start justify-between gap-2"},ap={class:"flex items-start space-x-2 flex-1 min-w-0"},lp={class:"text-sm text-gray-700 line-clamp-2 leading-relaxed"},ip={class:"p-4 space-y-2"},cp=["onClick"],dp={class:"flex-1"},up={class:"font-medium text-gray-900 group-hover:text-emerald-700 transition-colors"},fp={class:"text-xs text-gray-500 mt-0.5"},pp={class:"px-4 pb-3 border-b border-gray-100"},gp={class:"flex items-center justify-between cursor-pointer group"},vp={class:"relative"},mp={class:"px-4 pb-4"},hp={class:"pt-3 border-t border-gray-100"},bp={class:"relative"},yp={key:0,class:"absolute left-1/2 transform -translate-x-1/2 -bottom-2"},xp={key:1,class:"absolute left-1/2 transform -translate-x-1/2 -top-2"},wp=P({__name:"IntentButtons",props:{show:{type:Boolean},position:{},selectedText:{}},emits:["select","close"],setup(e,{emit:t}){const o=e,s=t,r=B(""),a=B(null),l=B(null),i=B(!1),v=B(!1),f=M(()=>{if(!o.show)return{};const y=window.innerHeight,x=window.innerWidth,w=450,h=384,m=20,b=16;let k=o.position.x,$=o.position.y;const I=y-$,S=$;I<w+m&&S>I?(v.value=!0,$=$-w-b):(v.value=!1,$=$+b);let A=k;const R=h/2;return A-R<m?A=R+m:A+R>x-m&&(A=x-R-m),$<m?$=m:$+w>y-m&&($=y-w-m),{left:`${A}px`,top:`${$}px`,transform:"translateX(-50%)"}}),u=[{type:"explain",label:"这是什么意思？",description:"深度解析这段文字的含义",color:"bg-emerald-100 text-emerald-600",icon:P({template:`
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      `})},{type:"analyze",label:"作者为什么这么说？",description:"分析作者的观点和动机",color:"bg-teal-100 text-teal-600",icon:P({template:`
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
      `})},{type:"counter",label:"有不同的看法吗？",description:"探索另一种视角和观点",color:"bg-slate-100 text-slate-600",icon:P({template:`
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
        </svg>
      `})}],p=y=>{s("select",y,void 0,i.value),r.value=""},d=()=>{r.value.trim()&&(s("select","custom",r.value,i.value),r.value="")},c=()=>{s("close"),r.value=""};return oe(()=>o.show,y=>{y&&Be(()=>{})}),(y,x)=>{const w=Sn,h=Nt,m=Vt;return _(),C(te,null,[O(de,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[e.show?(_(),C("div",{key:0,class:"fixed inset-0 z-40",onClick:c})):L("",!0)]),_:1}),O(de,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-2","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:T(()=>[e.show?(_(),C("div",{key:0,ref_key:"popupRef",ref:l,style:ve(g(f)),class:"fixed z-50"},[O(m,{class:"w-96 shadow-2xl border-0 overflow-hidden backdrop-blur-md bg-white/95"},{default:T(()=>[O(h,{class:"p-0"},{default:T(()=>[n("div",rp,[n("div",ap,[x[2]||(x[2]=n("svg",{class:"w-4 h-4 text-emerald-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)),n("p",lp,' "'+E(e.selectedText)+'" ',1)]),n("button",{onClick:c,class:"flex-shrink-0 w-6 h-6 rounded-full hover:bg-white/60 flex items-center justify-center transition-colors group",title:"关闭 (Esc)"},[...x[3]||(x[3]=[n("svg",{class:"w-4 h-4 text-gray-500 group-hover:text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),n("div",ip,[(_(),C(te,null,ie(u,b=>n("button",{key:b.type,onClick:k=>p(b.type),class:"group w-full flex items-center space-x-3 px-4 py-3 text-left rounded-xl hover:bg-gradient-to-r hover:from-slate-50 hover:to-zinc-50 transition-all duration-200 border border-transparent hover:border-gray-200 hover:shadow-sm"},[n("div",{class:D(["w-10 h-10 rounded-lg flex items-center justify-center transition-all",b.color])},[(_(),j($n(b.icon),{class:"w-5 h-5"}))],2),n("div",dp,[n("div",up,E(b.label),1),n("div",fp,E(b.description),1)]),x[4]||(x[4]=n("svg",{class:"w-4 h-4 text-gray-400 group-hover:text-emerald-600 opacity-0 group-hover:opacity-100 transition-all transform group-hover:translate-x-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))],8,cp)),64))]),n("div",pp,[n("label",gp,[x[6]||(x[6]=n("div",{class:"flex items-center space-x-2"},[n("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),n("div",null,[n("span",{class:"text-sm font-medium text-gray-700"},"附带全文"),n("p",{class:"text-xs text-gray-500"},"AI将参考整篇文章内容")])],-1)),n("div",vp,[xe(n("input",{"onUpdate:modelValue":x[0]||(x[0]=b=>ye(i)?i.value=b:null),type:"checkbox",class:"sr-only peer"},null,512),[[bn,g(i)]]),x[5]||(x[5]=n("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"},null,-1))])])]),n("div",mp,[n("div",hp,[n("form",{onSubmit:_e(d,["prevent"]),class:"space-y-2"},[n("div",bp,[xe(n("input",{ref_key:"customInput",ref:a,"onUpdate:modelValue":x[1]||(x[1]=b=>ye(r)?r.value=b:null),type:"text",placeholder:"或者输入你的自定义问题...",class:"w-full pl-10 pr-4 py-2.5 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 transition-all",onKeydown:Yt(c,["esc"])},null,544),[[Ct,g(r)]]),x[7]||(x[7]=n("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1))]),O(w,{type:"submit",disabled:!g(r).trim(),class:"w-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white shadow-md hover:shadow-lg transition-all",size:"sm"},{default:T(()=>[...x[8]||(x[8]=[n("svg",{class:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),ne(" 立即提问 ",-1)])]),_:1},8,["disabled"])],32)])]),x[9]||(x[9]=n("div",{class:"px-4 pb-3 flex items-center justify-between text-xs text-gray-400"},[n("span",null,[ne("快捷键: "),n("kbd",{class:"px-1.5 py-0.5 bg-gray-100 rounded"},"Esc"),ne(" 关闭")]),n("span",{class:"flex items-center space-x-1"},[n("span",{class:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),n("span",null,"AI 已就绪")])],-1))]),_:1})]),_:1}),g(v)?(_(),C("div",yp,[...x[10]||(x[10]=[n("div",{class:"w-4 h-4 bg-white rotate-45 border-r border-b border-gray-200"},null,-1)])])):(_(),C("div",xp,[...x[11]||(x[11]=[n("div",{class:"w-4 h-4 bg-white rotate-45 border-l border-t border-gray-200"},null,-1)])]))],4)):L("",!0)]),_:1})],64)}}}),_p=Object.assign(Se(wp,[["__scopeId","data-v-bb2f57ef"]]),{__name:"IntentButtons"}),kp={key:0,class:"fixed inset-y-0 right-0 w-96 bg-white shadow-2xl z-50 flex flex-col"},Cp={class:"p-4 border-b flex items-center justify-between"},$p={class:"flex items-center gap-2"},Sp={class:"p-4 border-b"},Ap={class:"flex-1 overflow-y-auto p-4 space-y-3"},Mp={key:0,class:"text-center text-gray-400 mt-10"},Ep={class:"text-sm"},Tp={class:"flex items-center justify-between mb-2 text-xs text-gray-500"},Lp={class:"px-2 py-0.5 bg-blue-50 text-blue-600 rounded"},Bp={class:"text-sm font-medium text-gray-900 mb-2 line-clamp-2"},Ip={class:"text-xs text-gray-600 line-clamp-2"},Rp={key:0,class:"text-xs text-gray-400 mt-2"},Op=P({__name:"HistoryPanel",props:{isOpen:{type:Boolean}},emits:["select","close"],setup(e,{emit:t}){const{history:o,deleteHistoryItem:s,clearHistory:r,searchHistory:a}=zn(),l=B(""),i=t,v=M(()=>l.value?a(l.value):o.value),f=c=>{const y=new Date(c),w=new Date().getTime()-y.getTime();return w<6e4?"刚刚":w<36e5?`${Math.floor(w/6e4)}分钟前`:w<864e5?`${Math.floor(w/36e5)}小时前`:w<6048e5?`${Math.floor(w/864e5)}天前`:y.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},u=c=>({explain:"解释",analyze:"分析",counter:"反方"})[c]||c,p=c=>{i("select",c),i("close")},d=()=>{confirm("确定要清空所有历史记录吗？此操作不可恢复。")&&r()};return(c,y)=>{const x=Sn,w=Nt,h=Vt;return _(),C("div",null,[O(de,{name:"slide"},{default:T(()=>[e.isOpen?(_(),C("div",kp,[n("div",Cp,[y[5]||(y[5]=n("h2",{class:"text-lg font-semibold"},"历史记录",-1)),n("div",$p,[g(o).length>0?(_(),j(x,{key:0,variant:"ghost",size:"sm",onClick:d},{default:T(()=>[...y[3]||(y[3]=[ne(" 清空 ",-1)])]),_:1})):L("",!0),O(x,{variant:"ghost",size:"sm",onClick:y[0]||(y[0]=m=>i("close"))},{default:T(()=>[...y[4]||(y[4]=[n("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_:1})])]),n("div",Sp,[xe(n("input",{"onUpdate:modelValue":y[1]||(y[1]=m=>ye(l)?l.value=m:null),type:"text",placeholder:"搜索历史记录...",class:"w-full px-3 py-2 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[Ct,g(l)]])]),n("div",Ap,[g(v).length===0?(_(),C("div",Mp,[y[6]||(y[6]=n("svg",{class:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),n("p",Ep,E(g(l)?"没有找到相关记录":"暂无历史记录"),1)])):L("",!0),(_(!0),C(te,null,ie(g(v),m=>(_(),j(h,{key:m.id,class:"cursor-pointer hover:shadow-md transition-shadow",onClick:b=>p(m)},{default:T(()=>[O(w,{class:"p-3"},{default:T(()=>[n("div",Tp,[n("span",null,E(f(m.timestamp)),1),n("span",Lp,E(u(m.intent)),1)]),n("p",Bp,' "'+E(m.selectedText)+'" ',1),n("p",Ip,E(m.insight.substring(0,100))+E(m.insight.length>100?"...":""),1),m.articleTitle?(_(),C("p",Rp," 来自: "+E(m.articleTitle),1)):L("",!0),O(x,{variant:"ghost",size:"sm",class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:_e(b=>g(s)(m.id),["stop"])},{default:T(()=>[...y[7]||(y[7]=[n("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))])])):L("",!0)]),_:1}),O(de,{name:"fade"},{default:T(()=>[e.isOpen?(_(),C("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-30 z-40",onClick:y[2]||(y[2]=m=>i("close"))})):L("",!0)]),_:1})])}}}),Pp=Object.assign(Se(Op,[["__scopeId","data-v-2afdc87c"]]),{__name:"HistoryPanel"}),Ot=P({__name:"Tooltip",props:{defaultOpen:{type:Boolean},open:{type:Boolean},delayDuration:{},disableHoverableContent:{type:Boolean},disableClosingTrigger:{type:Boolean},disabled:{type:Boolean},ignoreNonKeyboardFocus:{type:Boolean}},emits:["update:open"],setup(e,{emit:t}){const r=Zt(e,t);return(a,l)=>(_(),j(g(Bl),Xt(Jt(g(r))),{default:T(()=>[Y(a.$slots,"default")]),_:3},16))}}),Pt=P({inheritAttrs:!1,__name:"TooltipContent",props:{forceMount:{type:Boolean},ariaLabel:{},asChild:{type:Boolean},as:{},side:{},sideOffset:{default:4},align:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},positionStrategy:{},updatePositionStrategy:{},class:{}},emits:["escapeKeyDown","pointerDownOutside"],setup(e,{emit:t}){const o=e,s=t,r=Mt(o,"class"),a=Zt(r,s);return(l,i)=>(_(),j(g(jl),null,{default:T(()=>[O(g(Hl),se({...g(a),...l.$attrs},{class:g(Ie)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o.class)}),{default:T(()=>[Y(l.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),Hp=P({__name:"TooltipProvider",props:{delayDuration:{},skipDelayDuration:{},disableHoverableContent:{type:Boolean},disableClosingTrigger:{type:Boolean},disabled:{type:Boolean},ignoreNonKeyboardFocus:{type:Boolean}},setup(e){const t=e;return(o,s)=>(_(),j(g(El),Xt(Jt(t)),{default:T(()=>[Y(o.$slots,"default")]),_:3},16))}}),Ht=P({__name:"TooltipTrigger",props:{reference:{},asChild:{type:Boolean},as:{}},setup(e){const t=e;return(o,s)=>(_(),j(g(ql),Xt(Jt(t)),{default:T(()=>[Y(o.$slots,"default")]),_:3},16))}}),zp={key:0,class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},jp={key:1,class:"w-5 h-5 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Dp={key:2,class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qp={class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-medium"},Np={key:0,class:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-medium"},Vp={key:0,class:"px-4 py-2 bg-violet-600 text-white text-sm rounded-lg shadow-lg"},Fp={key:0,class:"absolute bottom-6 right-6 w-3 h-3 bg-emerald-500/50 rounded-full animate-pulse pointer-events-none"},Wp=P({__name:"FloatingActions",props:{isInsightPanelExpanded:{type:Boolean},insightCount:{},isReplayMode:{type:Boolean},historyCount:{},isMetaViewActive:{type:Boolean},isMetaAnalyzing:{type:Boolean}},emits:["toggle-insight-panel","toggle-replay","open-history","toggle-meta-view"],setup(e){const t=B(!1);return(o,s)=>(_(),j(g(Hp),null,{default:T(()=>[n("div",{onMouseenter:s[4]||(s[4]=r=>t.value=!0),onMouseleave:s[5]||(s[5]=r=>t.value=!1),class:"fixed bottom-0 right-0 w-32 h-32 z-40 pointer-events-auto"},[n("div",{class:D(["absolute bottom-6 right-6 flex flex-col gap-3 transition-all duration-300",g(t)?"opacity-100 translate-x-0":"opacity-0 translate-x-8 pointer-events-none"])},[O(g(Ot),null,{default:T(()=>[O(g(Ht),{"as-child":""},{default:T(()=>[n("button",{onClick:s[0]||(s[0]=r=>o.$emit("toggle-insight-panel")),class:"p-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full shadow-lg hover:shadow-xl hover:scale-110 transition-all duration-200"},[(_(),C("svg",{class:D(["w-5 h-5 transition-transform duration-200",{"rotate-180":!e.isInsightPanelExpanded}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...s[6]||(s[6]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"},null,-1)])],2))])]),_:1}),O(g(Pt),{side:"left",class:"bg-gray-900 text-white border-gray-900"},{default:T(()=>[ne(E(e.isInsightPanelExpanded?"收起AI洞察":"展开AI洞察"),1)]),_:1})]),_:1}),O(g(Ot),null,{default:T(()=>[O(g(Ht),{"as-child":""},{default:T(()=>[n("button",{onClick:s[1]||(s[1]=r=>o.$emit("toggle-meta-view")),class:D(["p-3 rounded-full shadow-lg transition-all duration-300","bg-gradient-to-br from-violet-500/80 to-purple-600/80 backdrop-blur-md","hover:from-violet-600 hover:to-purple-700 hover:shadow-xl hover:scale-110",e.isMetaViewActive?"opacity-100":"opacity-40 hover:opacity-100"])},[!e.isMetaAnalyzing&&!e.isMetaViewActive?(_(),C("svg",zp,[...s[7]||(s[7]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])])):e.isMetaAnalyzing?(_(),C("svg",jp,[...s[8]||(s[8]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(_(),C("svg",Dp,[...s[9]||(s[9]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])]))],2)]),_:1}),O(g(Pt),{side:"left",class:"bg-gray-900 text-white border-gray-900"},{default:T(()=>[ne(E(e.isMetaViewActive?"关闭元视角":"开启元视角"),1)]),_:1})]),_:1}),O(de,{"enter-active-class":"transition-all duration-300","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-200","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:T(()=>[e.insightCount>0?(_(),j(g(Ot),{key:0},{default:T(()=>[O(g(Ht),{"as-child":""},{default:T(()=>[n("button",{onClick:s[2]||(s[2]=r=>o.$emit("toggle-replay")),class:D(["relative p-3 rounded-full shadow-lg transition-all duration-300 hover:scale-110",e.isReplayMode?"bg-gradient-to-r from-orange-500 to-amber-600 text-white":"bg-white text-orange-600 hover:bg-orange-50"])},[s[10]||(s[10]=n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)),n("span",qp,E(e.insightCount),1)],2)]),_:1}),O(g(Pt),{side:"left",class:"bg-gray-900 text-white border-gray-900"},{default:T(()=>[ne(E(e.isReplayMode?"关闭回放模式":"历史洞察回放"),1)]),_:1})]),_:1})):L("",!0)]),_:1}),O(g(Ot),null,{default:T(()=>[O(g(Ht),{"as-child":""},{default:T(()=>[n("button",{onClick:s[3]||(s[3]=r=>o.$emit("open-history")),class:"relative p-3 bg-white border border-gray-300 hover:border-gray-400 rounded-full shadow-lg hover:shadow-xl hover:scale-110 transition-all duration-200 text-gray-700"},[s[11]||(s[11]=n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e.historyCount>0?(_(),C("span",Np,E(e.historyCount),1)):L("",!0)])]),_:1}),O(g(Pt),{side:"left",class:"bg-gray-900 text-white border-gray-900"},{default:T(()=>[...s[12]||(s[12]=[ne(" 历史记录 ",-1)])]),_:1})]),_:1}),O(de,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[e.isMetaAnalyzing?(_(),C("div",Vp,[...s[13]||(s[13]=[n("div",{class:"flex items-center gap-2"},[n("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),n("span",null,"分析中...")],-1)])])):L("",!0)]),_:1})],2),!g(t)&&!e.isMetaAnalyzing?(_(),C("div",Fp)):L("",!0)],32)]),_:1}))}}),Up=Object.assign(Wp,{__name:"FloatingActions"}),Gp=P({__name:"LensAnnotationOverlay",props:{isActive:{type:Boolean},annotations:{}},setup(e){return(t,o)=>null}}),Kp=Object.assign(Gp,{__name:"LensAnnotationOverlay"}),Yp={class:"p-6 border-b border-gray-200 bg-gradient-to-r from-orange-50 to-amber-50"},Xp={class:"flex items-center justify-between"},Jp={class:"flex items-center gap-3"},Qp={class:"text-xs text-gray-500"},Zp={class:"px-6 pt-4 pb-2 bg-orange-50/50"},eg={class:"p-3 bg-white border-l-4 border-orange-500 rounded-lg"},tg={class:"text-sm text-gray-800 leading-relaxed"},ng={class:"flex-1 overflow-y-auto p-6 space-y-4"},og={class:"flex items-center gap-2 mb-2"},sg={class:"prose prose-sm max-w-none"},rg={key:0,class:"mt-3 pt-3 border-t border-teal-200"},ag={class:"text-xs text-gray-600 leading-relaxed whitespace-pre-wrap"},lg=P({__name:"InsightHistoryModal",props:{selectedItem:{}},emits:["close","continueChat"],setup(e,{emit:t}){const o=e,s=t,r=M(()=>o.selectedItem?.messages.length||0),a=()=>{s("close")},l=()=>{o.selectedItem&&s("continueChat",o.selectedItem)},i=f=>new Date(f).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=f=>new Date(f).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(f,u)=>(_(),j(de,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[e.selectedItem?(_(),C("div",{key:0,class:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:a},[n("div",{class:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[85vh] overflow-hidden flex flex-col",onClick:u[0]||(u[0]=_e(()=>{},["stop"]))},[n("div",Yp,[n("div",Xp,[n("div",Jp,[u[2]||(u[2]=n("div",{class:"w-10 h-10 bg-gradient-to-br from-orange-500 to-amber-600 rounded-xl flex items-center justify-center"},[n("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})])],-1)),n("div",null,[u[1]||(u[1]=n("h3",{class:"text-lg font-bold text-gray-900"},"对话记录",-1)),n("p",Qp,E(i(e.selectedItem.created_at))+" · 共 "+E(r.value)+" 条对话",1)])]),n("button",{onClick:a,class:"p-2 rounded-lg hover:bg-white/50 transition-colors"},[...u[3]||(u[3]=[n("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),n("div",Zp,[u[4]||(u[4]=n("div",{class:"text-xs font-medium text-gray-500 mb-2"},"📌 选中的文本",-1)),n("div",eg,[n("p",tg,E(e.selectedItem.selected_text),1)])]),n("div",ng,[(_(!0),C(te,null,ie(e.selectedItem.messages,(p,d)=>(_(),C("div",{key:d,class:D(["flex",p.role==="user"?"justify-end":"justify-start"])},[n("div",{class:D(["max-w-[85%] rounded-xl p-4 shadow-sm",p.role==="user"?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":"bg-gradient-to-br from-emerald-50 to-teal-50 text-gray-800"])},[n("div",og,[n("span",{class:D(["text-xs font-medium",p.role==="user"?"text-blue-100":"text-gray-500"])},E(p.role==="user"?"👤 你":"🤖 AI"),3),n("span",{class:D(["text-xs",p.role==="user"?"text-blue-200":"text-gray-400"])},E(v(p.timestamp)),3)]),n("div",sg,[n("p",{class:D(["leading-relaxed whitespace-pre-wrap",p.role==="user"?"text-white":"text-gray-800"])},E(p.content),3)]),p.reasoning&&p.role==="assistant"?(_(),C("div",rg,[u[5]||(u[5]=n("div",{class:"flex items-center gap-1 text-xs font-medium text-purple-600 mb-2"},[n("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})]),n("span",null,"推理过程")],-1)),n("p",ag,E(p.reasoning),1)])):L("",!0)],2)],2))),128))]),n("div",{class:"p-4 border-t border-gray-200 bg-gray-50 flex items-center justify-between"},[n("button",{onClick:a,class:"px-4 py-2 text-sm text-gray-600 hover:text-gray-900 transition-colors"}," 关闭 "),n("button",{onClick:l,class:"px-6 py-2 bg-gradient-to-r from-orange-500 to-amber-600 text-white text-sm rounded-lg hover:from-orange-600 hover:to-amber-700 transition-all shadow-md flex items-center gap-2"},[...u[6]||(u[6]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),ne(" 继续聊天 ",-1)])])])])])):L("",!0)]),_:1}))}}),ig=Object.assign(lg,{__name:"InsightHistoryModal"}),zt=B({auto_basic_analysis:!0,auto_meta_analysis:!1,auto_argument_lens:!1,auto_stance_lens:!1}),xt=B(!1),wt=B(null);function cg(){async function e(s){xt.value=!0,wt.value=null;try{const r=me(),a=await $fetch(`${r.public.apiBase}/api/v1/preferences/analysis/${s}`);return zt.value=a,a}catch(r){throw wt.value=r instanceof Error?r.message:"未知错误",console.error("获取分析偏好设置失败:",r),r}finally{xt.value=!1}}async function t(s,r){xt.value=!0,wt.value=null;try{const a=me(),l=await $fetch(`${a.public.apiBase}/api/v1/preferences/analysis/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:r});return zt.value=l,l}catch(a){throw wt.value=a instanceof Error?a.message:"未知错误",console.error("更新分析偏好设置失败:",a),a}finally{xt.value=!1}}async function o(s,r){const a=!zt.value[r];await t(s,{[r]:a})}return{preferences:zt,isLoading:xt,error:wt,fetchPreferences:e,updatePreferences:t,togglePreference:o}}const jt=P({__name:"Switch",props:{defaultValue:{type:Boolean},modelValue:{type:[Boolean,null]},disabled:{type:Boolean},id:{},value:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean},class:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,s=t,r=Mt(o,"class"),a=Zt(r,s);return(l,i)=>(_(),j(g(Cl),se(g(a),{class:g(Ie)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",o.class)}),{default:T(()=>[O(g(Sl),{class:D(g(Ie)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5"))},{default:T(()=>[Y(l.$slots,"thumb")]),_:3},8,["class"])]),_:3},16,["class"]))}}),dg={class:"p-6 space-y-4"},ug={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},fg={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},pg={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},gg={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},vg=P({__name:"AnalysisSettingsModal",props:{isOpen:{type:Boolean},userId:{}},emits:["close","preferencesUpdated"],setup(e,{emit:t}){const o=e,s=t,r=B({auto_basic_analysis:!0,auto_meta_analysis:!1,auto_argument_lens:!1,auto_stance_lens:!1}),a=B(!1),l=B(!1);oe(()=>o.isOpen,async f=>{if(f&&o.userId){a.value=!0,l.value=!1;try{const u=me(),p=await $fetch(`${u.public.apiBase}/api/v1/preferences/analysis/${o.userId}`);r.value=p,l.value=!0,console.log("✅ 已加载分析偏好设置:",p)}catch(u){console.error("获取偏好设置失败:",u)}finally{a.value=!1}}});const i=()=>{s("close")},v=async(f,u)=>{try{a.value=!0;const p=me(),d=await $fetch(`${p.public.apiBase}/api/v1/preferences/analysis/${o.userId}`,{method:"PUT",body:{[f]:u}});r.value=d,s("preferencesUpdated",d),console.log("✅ 偏好设置已更新:",f,"=",u)}catch(p){console.error("更新偏好设置失败:",p);try{const d=me(),c=await $fetch(`${d.public.apiBase}/api/v1/preferences/analysis/${o.userId}`);r.value=c}catch(d){console.error("重新加载失败:",d)}}finally{a.value=!1}};return(f,u)=>(_(),j(de,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:T(()=>[e.isOpen?(_(),C("div",{key:0,class:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:i},[n("div",{class:"bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden",onClick:u[4]||(u[4]=_e(()=>{},["stop"]))},[n("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50"},[n("div",{class:"flex items-center justify-between"},[u[6]||(u[6]=n("div",{class:"flex items-center gap-3"},[n("div",{class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center"},[n("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})])]),n("div",null,[n("h3",{class:"text-lg font-bold text-gray-900"},"自动分析设置"),n("p",{class:"text-xs text-gray-500"},"自定义文章加载时的自动分析行为")])],-1)),n("button",{onClick:i,class:"p-2 rounded-lg hover:bg-white/50 transition-colors"},[...u[5]||(u[5]=[n("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),n("div",dg,[u[11]||(u[11]=n("p",{class:"text-sm text-gray-600 mb-4"}," 开启后，当您加载新文章时，系统将自动执行已启用的分析。 ",-1)),n("div",ug,[u[7]||(u[7]=n("div",{class:"flex-1"},[n("div",{class:"flex items-center gap-2 mb-1"},[n("svg",{class:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),n("span",{class:"font-medium text-gray-900"},"基础分析")]),n("p",{class:"text-xs text-gray-500"},"文章基本信息和内容概览")],-1)),O(jt,{"model-value":g(r).auto_basic_analysis,"onUpdate:modelValue":u[0]||(u[0]=p=>v("auto_basic_analysis",p)),disabled:g(a)},null,8,["model-value","disabled"])]),n("div",fg,[u[8]||(u[8]=n("div",{class:"flex-1"},[n("div",{class:"flex items-center gap-2 mb-1"},[n("svg",{class:"w-5 h-5 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]),n("span",{class:"font-medium text-gray-900"},"元视角分析")]),n("p",{class:"text-xs text-gray-500"},"分析作者意图、时效性、潜在偏见和知识缺口")],-1)),O(jt,{"model-value":g(r).auto_meta_analysis,"onUpdate:modelValue":u[1]||(u[1]=p=>v("auto_meta_analysis",p)),disabled:g(a)},null,8,["model-value","disabled"])]),n("div",pg,[u[9]||(u[9]=n("div",{class:"flex-1"},[n("div",{class:"flex items-center gap-2 mb-1"},[n("svg",{class:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})]),n("span",{class:"font-medium text-gray-900"},"论证透镜")]),n("p",{class:"text-xs text-gray-500"},"高亮文章中的论证结构和论点")],-1)),O(jt,{"model-value":g(r).auto_argument_lens,"onUpdate:modelValue":u[2]||(u[2]=p=>v("auto_argument_lens",p)),disabled:g(a)},null,8,["model-value","disabled"])]),n("div",gg,[u[10]||(u[10]=n("div",{class:"flex-1"},[n("div",{class:"flex items-center gap-2 mb-1"},[n("svg",{class:"w-5 h-5 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})]),n("span",{class:"font-medium text-gray-900"},"意图透镜")]),n("p",{class:"text-xs text-gray-500"},"高亮作者的立场和观点表达")],-1)),O(jt,{"model-value":g(r).auto_stance_lens,"onUpdate:modelValue":u[3]||(u[3]=p=>v("auto_stance_lens",p)),disabled:g(a)},null,8,["model-value","disabled"])]),u[12]||(u[12]=n("div",{class:"mt-6 p-3 bg-blue-50 border-l-4 border-blue-500 rounded"},[n("div",{class:"flex items-start gap-2"},[n("svg",{class:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),n("p",{class:"text-xs text-blue-700"}," 这些设置将保存到您的账户中，并在所有设备上同步。 ")])],-1))]),n("div",{class:"p-6 border-t border-gray-200 bg-gray-50 flex items-center justify-end gap-3"},[n("button",{onClick:i,class:"px-6 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-sm rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all shadow-md"}," 完成 ")])])])):L("",!0)]),_:1}))}}),mg=Object.assign(vg,{__name:"AnalysisSettingsModal"}),hg=()=>{const e=me(),t=U("insight-conversations",()=>[]),o=U("is-replay-mode",()=>!1),s=U("selected-conversation",()=>null),r=U("insight-history-loading",()=>!1),a=async h=>{r.value=!0;try{const m=await $fetch(`${e.public.apiBase}/api/v1/insights/history`,{params:{article_id:h}});return t.value=m.conversations,console.log("✅ 加载了",m.total,"个对话链（共",m.conversations.reduce((b,k)=>b+k.messages.length,0),"条消息）"),m.conversations}catch(m){return console.error("❌ 加载洞察历史失败:",m),[]}finally{r.value=!1}},l=()=>{o.value=!o.value,o.value||(s.value=null)},i=(h,m)=>{y(h),console.log("🔍 开始渲染",m.length,"个对话链的标注");const b=[...m].sort((k,$)=>$.selected_text.length-k.selected_text.length);for(const k of b)try{v(h,k)}catch($){console.error("❌ 渲染标注失败:",k.selected_text.substring(0,30),$)}console.log("✅ 历史标注渲染完成")},v=(h,m)=>{m.selected_text.trim()&&(m.selected_start!==null&&m.selected_end!==null?f(h,m)||(console.warn("⚠️ 位置高亮失败，降级到文本匹配"),u(h,m)):u(h,m))},f=(h,m)=>{if(m.selected_start===null||m.selected_end===null)return!1;const{content:b}=Ve(),k=b.value;if(!k)return!1;const $=k.substring(m.selected_start,m.selected_end),I=document.createTreeWalker(h,NodeFilter.SHOW_TEXT,{acceptNode:fe=>{const Ge=fe.parentElement;return Ge?.classList.contains("insight-replay-highlight")||Ge?.classList.contains("meta-view-highlight")?NodeFilter.FILTER_REJECT:fe.textContent?.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),S=[];let A;for(;A=I.nextNode();)S.push(A);let R=0;const V=[];for(const fe of S){const Ge=fe.textContent||"";V.push({node:fe,startOffset:R,endOffset:R+Ge.length}),R+=Ge.length}const G=V.filter(fe=>fe.startOffset<m.selected_end&&fe.endOffset>m.selected_start);if(G.length===0)return console.warn("⚠️ 未找到目标节点"),!1;if(G.length>1)return console.warn("⚠️ 跨多个节点，降级到文本匹配"),!1;const F=G[0],Q=F.node,K=Math.max(0,m.selected_start-F.startOffset),ee=Math.min(Q.textContent.length,m.selected_end-F.startOffset),W=Q.textContent||"",z=W.substring(0,K),q=W.substring(K,ee),Z=W.substring(ee);if(q!==$)return console.warn("⚠️ 位置提取的文本不匹配"),console.log("期望:",$.substring(0,50)),console.log("实际:",q.substring(0,50)),!1;const J=Q.parentNode;if(!J)return!1;const re=p(q,m);return z&&J.insertBefore(document.createTextNode(z),Q),J.insertBefore(re,Q),Z&&J.insertBefore(document.createTextNode(Z),Q),J.removeChild(Q),console.log("✅ 基于位置高亮成功:",m.selected_start,"-",m.selected_end),!0},u=(h,m)=>{const b=m.selected_text.trim();if(!b)return;const k=document.createTreeWalker(h,NodeFilter.SHOW_TEXT,{acceptNode:S=>S.parentElement?.classList.contains("meta-view-highlight")?NodeFilter.FILTER_REJECT:S.textContent?.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),$=[];let I;for(;I=k.nextNode();)$.push(I);for(const S of $){const A=S.textContent||"",R=A.indexOf(b);if(R!==-1){const V=A.substring(0,R),G=A.substring(R,R+b.length),F=A.substring(R+b.length),Q=S.parentNode;if(!Q)continue;const K=p(G,m);V&&Q.insertBefore(document.createTextNode(V),S),Q.insertBefore(K,S),F&&Q.insertBefore(document.createTextNode(F),S),Q.removeChild(S);break}}},p=(h,m)=>{const b=document.createElement("span");return b.className="insight-replay-highlight",b.dataset.conversationId=m.root_insight_id.toString(),b.style.borderBottom="3px solid #f97316",b.style.cursor="pointer",b.style.backgroundColor="rgba(249, 115, 22, 0.1)",b.style.padding="0.1em 0.2em",b.style.borderRadius="0.25em",b.style.transition="all 0.2s ease",b.style.position="relative",b.style.display="inline",b.textContent=h,b.addEventListener("click",k=>{k.stopPropagation();const $=[];let I=b;for(;I;){if(I.classList?.contains("insight-replay-highlight")){const S=I.dataset.conversationId;if(S){const A=t.value.find(R=>R.root_insight_id===parseInt(S));A&&!$.find(R=>R.root_insight_id===A.root_insight_id)&&$.push(A)}}I=I.parentElement}console.log("🔍 检测到",$.length,"个重叠的洞察"),$.length>1?d(k,$):$.length===1&&c($[0])}),b.addEventListener("mouseenter",()=>{b.style.backgroundColor="rgba(249, 115, 22, 0.2)",b.style.boxShadow="0 0 0 2px rgba(249, 115, 22, 0.2)"}),b.addEventListener("mouseleave",()=>{b.style.backgroundColor="rgba(249, 115, 22, 0.1)",b.style.boxShadow="none"}),b},d=(h,m)=>{const b=document.querySelector(".conversation-selection-menu");b&&b.remove();const k=document.createElement("div");k.className="conversation-selection-menu",k.style.position="fixed",k.style.left=`${h.clientX}px`,k.style.top=`${h.clientY+10}px`,k.style.backgroundColor="white",k.style.border="1px solid #e5e7eb",k.style.borderRadius="0.5rem",k.style.boxShadow="0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",k.style.zIndex="9999",k.style.minWidth="200px",k.style.maxWidth="300px",k.style.padding="0.5rem 0";const $=document.createElement("div");$.style.padding="0.5rem 1rem",$.style.fontSize="0.875rem",$.style.fontWeight="600",$.style.color="#6b7280",$.style.borderBottom="1px solid #e5e7eb",$.textContent=`选择要查看的对话（${m.length}个）`,k.appendChild($);const I=[...m].sort((A,R)=>A.selected_text.length-R.selected_text.length);I.forEach((A,R)=>{const V=document.createElement("div");V.style.padding="0.75rem 1rem",V.style.cursor="pointer",V.style.fontSize="0.875rem",V.style.transition="background-color 0.2s",V.style.borderBottom=R<I.length-1?"1px solid #f3f4f6":"none";const G=A.selected_text.length>50?A.selected_text.substring(0,50)+"...":A.selected_text;V.innerHTML=`
        <div style="font-weight: 500; color: #111827; margin-bottom: 0.25rem;">
          ${G}
        </div>
        <div style="font-size: 0.75rem; color: #9ca3af;">
          ${A.messages.length} 条消息 · ${A.selected_text.length} 字
        </div>
      `,V.addEventListener("mouseenter",()=>{V.style.backgroundColor="#f9fafb"}),V.addEventListener("mouseleave",()=>{V.style.backgroundColor="transparent"}),V.addEventListener("click",()=>{c(A),k.remove()}),k.appendChild(V)}),document.body.appendChild(k);const S=A=>{k.contains(A.target)||(k.remove(),document.removeEventListener("click",S))};setTimeout(()=>{document.addEventListener("click",S)},100)},c=h=>{const m=U("is-restoring-from-history",()=>!1);m.value=!0;const{conversationHistory:b,clearConversation:k}=Gt(),{currentInsight:$,currentReasoning:I}=ot(),{selectedText:S,context:A,selectedStart:R,selectedEnd:V}=Et();k();const G=h.messages,F=G.find(q=>q.role==="assistant");S.value=h.selected_text;const Q=h.context_before||"",K=h.context_after||"";A.value=Q+h.selected_text+K,R.value=h.selected_start,V.value=h.selected_end;const ee=U("current-request-global",()=>{});if(ee.value={selected_text:h.selected_text,context:A.value,intent:h.intent,custom_question:h.question||void 0,selected_start:h.selected_start??void 0,selected_end:h.selected_end??void 0,use_reasoning:!!F?.reasoning},F){$.value=F.content,I.value=F.reasoning||"";const{currentInsightId:q}=ot();q.value=F.insight_id||null}const W=G.slice(2);W.length>0?(b.value=W.map(q=>({role:q.role,content:q.content,reasoning:q.reasoning,timestamp:new Date(q.timestamp).getTime(),insight_id:q.insight_id||null})),console.log("📖 加载了追问对话历史:",W.length,"条消息")):console.log("📖 这是初始洞察，没有追问记录");const z=U("insight-panel-expanded",()=>!1);z.value||(z.value=!0),console.log("📖 已显示完整对话到右侧面板（总共",h.messages.length,"条消息）")},y=h=>{h.querySelectorAll(".insight-replay-highlight").forEach(b=>{const k=b.parentNode;if(k){const $=document.createTextNode(b.textContent||"");k.replaceChild($,b)}}),h.normalize()},x=h=>{s.value=h},w=()=>{t.value=[],o.value=!1,s.value=null};return{insightConversations:le(t),isReplayMode:le(o),selectedConversation:le(s),isLoading:le(r),loadInsightHistory:a,toggleReplayMode:l,renderHistoryHighlights:i,removeHistoryHighlights:y,selectConversation:x,clearReplayState:w}},bg=()=>{const e=B(new Map),t=async p=>{const d=document.getElementById("article-content-container");if(!d){console.warn("⚠️ 未找到文章容器元素");return}if(console.log("🎨 开始渲染火花（聚合模式）..."),p.sentences&&p.sentences.length>0){console.log(`📊 检测到后端分句结果（Stanza），共 ${p.sentences.length} 个句子`),console.log("🔄 使用后端分句重新渲染文章内容...");const{renderWithBackendSentences:y}=No(),x=y(p.sentences);d.innerHTML=x,console.log("✅ 文章内容已使用后端分句重新渲染")}else console.log("ℹ️ 使用前端原有分句结果");const c=o(p);e.value=c,console.log(`📊 火花聚合完成：${c.size} 个句子包含火花`),await s(d,c),console.log("✅ 火花渲染完成")},o=p=>{const d=new Map;return p.concept_sparks&&p.concept_sparks.forEach(c=>{d.has(c.sentence_index)||d.set(c.sentence_index,{sentence_index:c.sentence_index,sentence_text:"",concepts:[],arguments:[],totalCount:0});const y=d.get(c.sentence_index);y.concepts.push(c),y.totalCount++}),p.argument_sparks&&p.argument_sparks.forEach(c=>{d.has(c.sentence_index)||d.set(c.sentence_index,{sentence_index:c.sentence_index,sentence_text:"",concepts:[],arguments:[],totalCount:0});const y=d.get(c.sentence_index);y.arguments.push(c),y.totalCount++}),d},s=async(p,d)=>{for(const[c,y]of d.entries()){await new Promise(x=>setTimeout(x,c*30));try{const x=document.querySelector(`#sentence-${c}`);if(!x){console.warn(`⚠️ 无法找到句子元素: #sentence-${c}`);continue}y.sentence_text=x.textContent||"";const w=y.concepts.length>0,h=y.arguments.length>0,m=v(y);x.setAttribute("data-spark-tooltip",m),w&&r(x,y.concepts),h&&x.classList.add("has-argument-sparks");const b=i(y);x.appendChild(b),x.addEventListener("click",k=>{k.target.classList.contains("concept-spark-highlight")||(k.stopPropagation(),document.querySelectorAll(".concept-spark-highlight.show-concept-tooltip").forEach($=>{$.classList.remove("show-concept-tooltip")}),document.querySelectorAll("[data-spark-tooltip].show-tooltip").forEach($=>{$!==x&&$.classList.remove("show-tooltip")}),x.classList.toggle("show-tooltip"))}),h&&(x.addEventListener("mouseenter",()=>{x.classList.add("spark-hover")}),x.addEventListener("mouseleave",()=>{x.classList.remove("spark-hover")}))}catch(x){console.error("❌ 渲染火花徽章失败:",x)}}f(),u()},r=(p,d)=>{let c=p.innerHTML;d.forEach(x=>{const w=x.text.trim();if(!w)return;const m=/[\u4e00-\u9fa5]/.test(w)?new RegExp(`(${a(w)})`,"g"):new RegExp(`\\b(${a(w)})\\b`,"gi");c=c.replace(m,b=>{const k=`💡 ${x.text} (重要度: ${x.importance_score}/10)
${x.explanation_hint}`;return`<span class="concept-spark-highlight"
                  data-concept="${l(w)}"
                  data-importance="${x.importance_score}"
                  data-tooltip="${l(k)}"
                  title="${l(x.explanation_hint)}">
                  ${b}
                </span>`})}),p.innerHTML=c,p.querySelectorAll(".concept-spark-highlight").forEach(x=>{x.addEventListener("click",w=>{w.stopPropagation(),document.querySelectorAll(".concept-spark-highlight.show-concept-tooltip").forEach(h=>{h!==x&&h.classList.remove("show-concept-tooltip")}),x.classList.toggle("show-concept-tooltip")})})},a=p=>p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=p=>{const d=document.createElement("div");return d.textContent=p,d.innerHTML},i=p=>{const d=document.createElement("span");d.className="spark-badge";const c=p.concepts.length>0,y=p.arguments.length>0;let x="💡";return y&&!c?x="📝":y&&c&&(x="✨"),d.innerHTML=`
      <span class="spark-icon">${x}</span>
    `,d},v=p=>{const d=[];if(p.arguments.length>0){const c=p.arguments.map(y=>`${y.type==="claim"?"📝":y.type==="evidence"?"📊":"🔄"} ${y.role_description}`);d.push(...c)}return d.join(`
`)},f=()=>{if(document.getElementById("spark-renderer-v2-styles"))return;const p=document.createElement("style");p.id="spark-renderer-v2-styles",p.textContent=`
      /* 概念火花高亮（词语级别） - 仅在hover时显示效果 */
      .concept-spark-highlight {
        position: relative;
        cursor: pointer;
        padding: 1px 3px;
        margin: 0 1px;
        border-radius: 3px;
        background-color: transparent;
        border-bottom: 2px solid transparent;
        transition: all 0.2s ease;
      }

      /* hover时才显示绿色下划线 */
      .concept-spark-highlight:hover {
        background-color: rgba(16, 185, 129, 0.1);
        border-bottom-color: rgba(16, 185, 129, 0.8);
      }

      /* 概念tooltip弹窗 - 使用shadcn白色背景 */
      .concept-spark-highlight::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        padding: 12px 16px;
        background: hsl(var(--popover));
        color: hsl(var(--popover-foreground));
        font-size: 13px;
        line-height: 1.5;
        border-radius: 8px;
        white-space: pre-wrap;
        min-width: 250px;
        max-width: 400px;
        border: 1px solid hsl(var(--border));
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
        z-index: 1000;
        pointer-events: none;
      }

      /* tooltip小箭头 - 使用shadcn颜色 */
      .concept-spark-highlight::before {
        content: '';
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-2px);
        border: 6px solid transparent;
        border-top-color: hsl(var(--popover));
        filter: drop-shadow(0 2px 1px rgba(0, 0, 0, 0.05));
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
        z-index: 1001;
        pointer-events: none;
      }

      /* 显示tooltip */
      .concept-spark-highlight.show-concept-tooltip::after,
      .concept-spark-highlight.show-concept-tooltip::before {
        opacity: 1;
        visibility: visible;
      }

      .concept-spark-highlight.show-concept-tooltip {
        background-color: rgba(16, 185, 129, 0.15);
        border-bottom-color: rgba(16, 185, 129, 0.9);
      }

      /* 包含论证火花的句子（整句高亮） */
      .has-argument-sparks {
        position: relative;
        cursor: pointer !important;
        transition: all 0.2s ease;
        padding: 2px 4px;
        margin: -2px -4px;
        border-radius: 4px;
        border-bottom: 2px solid transparent;
      }

      .has-argument-sparks:hover,
      .spark-hover {
        background-color: rgba(16, 185, 129, 0.08);
        border-bottom-color: rgba(16, 185, 129, 0.6);
      }

      /* 论证火花的tooltip弹窗 */
      .has-argument-sparks::after {
        content: attr(data-spark-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        padding: 12px 16px;
        background: hsl(var(--popover));
        color: hsl(var(--popover-foreground));
        font-size: 13px;
        line-height: 1.5;
        border-radius: 8px;
        white-space: pre-wrap;
        min-width: 250px;
        max-width: 400px;
        border: 1px solid hsl(var(--border));
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
        z-index: 1000;
        pointer-events: none;
      }

      /* 论证tooltip小箭头 */
      .has-argument-sparks::before {
        content: '';
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-2px);
        border: 6px solid transparent;
        border-top-color: hsl(var(--popover));
        filter: drop-shadow(0 2px 1px rgba(0, 0, 0, 0.05));
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
        z-index: 1001;
        pointer-events: none;
      }

      /* 显示论证tooltip */
      .has-argument-sparks.show-tooltip::after,
      .has-argument-sparks.show-tooltip::before {
        opacity: 1;
        visibility: visible;
      }

      /* 火花徽章 */
      // .spark-badge {
      //   display: inline-flex;
      //   align-items: center;
      //   gap: 2px;
      //   padding: 1px 6px;
      //   margin-left: 4px;
      //   background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      //   border-radius: 10px;
      //   font-size: 11px;
      //   font-weight: 600;
      //   color: white;
      //   box-shadow: 0 1px 3px rgba(16, 185, 129, 0.3);
      //   animation: badge-appear 0.4s ease-out;
      //   vertical-align: middle;
      //   white-space: nowrap;
      // }

      .spark-icon {
        font-size: 15px;
        line-height: 1;
      }

      .spark-count {
        line-height: 1;
      }

      @keyframes badge-appear {
        from {
          opacity: 0;
          transform: scale(0.8) translateY(-2px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
    `,document.head.appendChild(p)},u=()=>{window.__sparkTooltipClickHandler&&document.removeEventListener("click",window.__sparkTooltipClickHandler);const p=d=>{const c=d.target;!c.closest(".concept-spark-highlight")&&!c.closest(".has-argument-sparks")&&!c.closest("[data-spark-tooltip]")&&(document.querySelectorAll(".concept-spark-highlight.show-concept-tooltip").forEach(y=>{y.classList.remove("show-concept-tooltip")}),document.querySelectorAll("[data-spark-tooltip].show-tooltip").forEach(y=>{y.classList.remove("show-tooltip")}))};window.__sparkTooltipClickHandler=p,document.addEventListener("click",p)};return{renderSparks:t,sparkGroups:e}},yg=()=>{const e=B(new Map),t=r=>{if(r.key==="Escape"){const a=e.value.get("escape");a&&(a(),r.preventDefault())}if((r.ctrlKey||r.metaKey)&&r.key==="k"){const a=e.value.get("search");a&&(a(),r.preventDefault())}if((r.ctrlKey||r.metaKey)&&r.key==="/"){const a=e.value.get("help");a&&(a(),r.preventDefault())}},o=(r,a)=>{e.value.set(r,a)},s=r=>{e.value.delete(r)};return ge(()=>{window.addEventListener("keydown",t)}),Qe(()=>{window.removeEventListener("keydown",t)}),{register:o,unregister:s}},xg={class:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-zinc-50 relative overflow-hidden"},wg={class:"relative z-10"},_g={class:"border-b border-gray-200 bg-white"},kg={class:"flex"},Cg={class:"flex items-center justify-center gap-2"},$g={key:0,class:"ml-1 px-1.5 py-0.5 text-xs bg-amber-600 text-white rounded-full"},Sg={class:"flex-1 overflow-hidden"},Og=P({__name:"index",setup(e){const{content:t,title:o,isReading:s,setArticle:r}=Ve(),{selectedText:a,context:l,position:i,showIntentButtons:v,clear:f,selectedStart:u,selectedEnd:p}=Et(),{currentInsight:d,currentReasoning:c,isGenerating:y,error:x,generate:w}=ot(),{stashItems:h}=Hn(),{insightConversations:m,selectedConversation:b,loadInsightHistory:k,clearReplayState:$,selectConversation:I,isReplayMode:S,toggleReplayMode:A,renderHistoryHighlights:R,removeHistoryHighlights:V}=hg(),{history:G}=zn(),{isMetaViewActive:F,isAnalyzing:Q,analyzeArticle:K,toggleMetaView:ee}=Wo(),{enabledLenses:W,renderHighlightsByType:z}=Vo(),{isAnnotationModeActive:q,annotations:Z}=Fo(),J=B(!1),re=U("insight-panel-expanded",()=>!1),fe=B(null),{fetchPreferences:Ge}=cg(),un=B(!1),at=B(null),vt=U("current-article-id",()=>null),Pe=me(),{user:Ze}=pt(),{connect:Yo,disconnect:Xo,onAnalysisComplete:Jo,onMetaAnalysisComplete:Qo,onLensComplete:Zo,onTaskFailed:es}=Go(),{renderSparks:Tt}=bg(),Lt=B(null),ts=M(()=>d.value),ns=M(()=>c.value),os=M(()=>y.value),ss=M(()=>x.value),mt=U("current-request-global",()=>{}),rs=U("use-reasoning",()=>!1),He=B("insight"),jn=M(()=>h.value.length),Ae=B(!1),fn=U("is-restoring-from-history",()=>!1);oe(()=>a.value,N=>{if(fn.value){Ae.value=!1,fn.value=!1;return}N&&N.length>0&&!v.value?Ae.value=!0:Ae.value=!1});const as=()=>{Ae.value=!1,v.value=!0},ls=()=>{Ae.value=!1,f()},{register:is}=yg();Qe(()=>{Xo()});const cs=async N=>{try{const H=await $fetch(`${Pe.public.apiBase}/api/v1/articles/${N}`);r(H.content,H.title),vt.value=Number(N),console.log("✅ 从示例文章加载:",H.title),await Be();try{const X=await $fetch(`${Pe.public.apiBase}/api/v1/articles/${N}/analysis-report`);Lt.value=X.report_data,await Tt(X.report_data),console.log("✨ 火花已渲染（示例文章）")}catch{console.log("ℹ️ 该文章暂无分析报告")}}catch(H){console.error("❌ 加载示例文章失败:",H)}},ds=async N=>{if(r(N),Ze.value?.id)try{const H=await $fetch(`${Pe.public.apiBase}/api/v1/articles/save-with-analysis`,{method:"POST",body:{title:o.value||"未命名文章",content:N}});if(vt.value=H.article.id,console.log("✅ 文章已保存, ID:",H.article.id),H.analysis.status==="completed"){console.log("📊 检测到已有分析报告，正在加载...");const X=await $fetch(`${Pe.public.apiBase}/api/v1/articles/${H.article.id}/analysis-report`);Lt.value=X.report_data,await Tt(X.report_data),console.log("✨ 火花已渲染（来自缓存）")}else console.log("🔄 正在后台分析文章，分析完成后将自动渲染火花..."),Jo(H.article.id,async X=>{console.log(`📬 收到分析完成通知，文章 ID: ${X}`);try{const ae=await $fetch(`${Pe.public.apiBase}/api/v1/articles/${X}/analysis-report`);Lt.value=ae.report_data,await Tt(ae.report_data),console.log("✨ 火花已渲染");const pe=(ae.report_data.concept_sparks?.length||0)+(ae.report_data.argument_sparks?.length||0);pe>0&&console.log(`🎉 已为您发现 ${pe} 个高价值洞察点`)}catch(ae){console.error("❌ 获取分析报告失败:",ae)}});!at.value&&Ze.value?.id?Ge(Ze.value.id).then(X=>{at.value=X,X.auto_meta_analysis&&vt.value&&(console.log("🔍 自动触发元视角分析..."),$fetch(`${Pe.public.apiBase}/api/v1/meta-analysis/analyze`,{method:"POST",body:{title:o.value||"未命名文章",author:"未知作者",full_text:N}}).then(ae=>{ae.status==="completed"?console.log("✅ 元视角分析完成（来自缓存）"):ae.status==="pending"&&console.log("🔄 元视角分析已提交，任务ID:",ae.task_id)}).catch(ae=>{console.error("❌ 元视角分析失败:",ae)}))}).catch(X=>{console.warn("获取分析偏好失败:",X)}):at.value?.auto_meta_analysis&&(console.log("🔍 自动触发元视角分析..."),$fetch(`${Pe.public.apiBase}/api/v1/meta-analysis/analyze`,{method:"POST",body:{title:o.value||"未命名文章",author:"未知作者",full_text:N}}).then(X=>{X.status==="completed"?console.log("✅ 元视角分析完成（来自缓存）"):X.status==="pending"&&console.log("🔄 元视角分析已提交，任务ID:",X.task_id)}).catch(X=>{console.error("❌ 元视角分析失败:",X)})),H.article.is_new||(await k(H.article.id),console.log("📚 已加载历史洞察"))}catch(H){console.error("❌ 保存文章失败:",H)}},us=async(N,H,X)=>{re.value||ht();const ae=U("use-reasoning",()=>!1),pe={selected_text:a.value,context:l.value,intent:N,custom_question:H,use_reasoning:ae.value,include_full_text:X||!1};X&&t.value&&(pe.full_text=t.value),mt.value=pe;const{clearConversation:ze}=Gt();ze(),console.log("🆕 生成新洞察，清空对话历史"),await w(pe),f(),Ae.value=!1},fs=N=>{re.value||ht(),d.value=N.insight,mt.value=void 0,He.value="insight",N.articleTitle&&N.articleTitle!==o.value&&console.log("该记录来自另一篇文章:",N.articleTitle)},ps=N=>{fn.value=!0,re.value||ht(),a.value=N.selected_text;const H=N.context_before||"",X=N.context_after||"";l.value=H+N.selected_text+X,u.value=N.selected_start,p.value=N.selected_end;const{conversationHistory:ae,clearConversation:pe}=Gt();pe();const ze=N.messages,je=ze.find(De=>De.role==="assistant");mt.value={selected_text:N.selected_text,context:l.value,intent:N.intent,custom_question:N.question||void 0,selected_start:N.selected_start??void 0,selected_end:N.selected_end??void 0,use_reasoning:!!je?.reasoning},je&&(d.value=je.content,c.value=je.reasoning||"");const bt=ze.slice(2);bt.length>0?(ae.value=bt.map(De=>({role:De.role,content:De.content,reasoning:De.reasoning,timestamp:new Date(De.timestamp).getTime(),insight_id:De.insight_id})),console.log("🔄 已恢复完整对话（",bt.length,"条追问消息）")):console.log("🔄 这是初始洞察，没有追问记录"),I(null),He.value="insight",console.log("🔄 已恢复对话，可以继续提问")},gs=N=>{re.value||ht(),d.value=N.insight,c.value=N.reasoning||"",mt.value={selected_text:N.selectedText,context:N.context,intent:N.intent,custom_question:N.customQuestion,use_reasoning:!!N.reasoning},He.value="insight",console.log("📖 查看暂存项:",N.selectedText.substring(0,30),"...")},vs=N=>{at.value=N,console.log("✅ 分析偏好设置已更新:",N)},ht=()=>{re.value=!re.value},ms=()=>{A();const N=document.getElementById("article-content-container");N&&(S.value?R(N,m.value):V(N))},hs=async()=>{if(F.value)ee();else try{await K(o.value||"未命名文章","未知作者",new Date().toISOString(),t.value,Ze.value?.id,void 0),ee()}catch(N){console.error("元信息分析失败:",N),ee()}};Ds({title:"InsightReader - 划词即问，即刻理解",meta:[{name:"description",content:"最好的阅读辅助工具，使用 AI 帮你深度理解文章内容"}]}),oe(()=>vt.value,async N=>{N?(await k(N),m.value.length>0&&console.log(`📚 文章 ${N} 有 ${m.value.length} 个对话链`)):$()});const bs=qs();return ge(async()=>{Yo(),Ze.value?.id&&!at.value&&Ge(Ze.value.id).then(H=>{at.value=H,console.log("✅ 用户偏好设置已预加载")}).catch(H=>{console.warn("预加载用户偏好失败:",H)}),Qo(async(H,X)=>{console.log(`📬 收到元视角分析完成通知，文章 ID: ${H}`);const ae=U("meta-analysis-data",()=>null),pe=U("meta-view-analyzing",()=>!1);ae.value=X,pe.value=!1,console.log("✅ 元视角分析结果已更新"),X.generated_title&&(o.value=X.generated_title,console.log("✅ 已更新AI生成的标题:",X.generated_title))}),Zo(async(H,X)=>{console.log(`📬 收到 ${H} 透镜分析完成通知`);const ae=U("lens-results"),pe=U("loading-lenses");ae.value.set(H,X);const ze=new Set(pe.value);if(ze.delete(H),pe.value=ze,console.log(`🔄 加载状态已更新，剩余加载中的透镜: ${pe.value.size}`),W.value.has(H)){const je=document.querySelector(".article-content");je&&(z(je,X.highlights,H),console.log(`✨ ${H} 透镜高亮已应用`))}console.log(`✅ ${H} 透镜结果已保存，共 ${X.highlights?.length||0} 个高亮`)}),es((H,X)=>{console.error(`❌ ${H} 任务失败:`,X);const pe={article_analysis:"文章分析",article_reanalysis:"文章重新分析",meta_analysis:"元视角分析",thinking_lens_argument_structure:"论证结构透镜",thinking_lens_author_stance:"作者意图透镜"}[H]||"分析";console.log(`⚠️ ${pe}失败: ${X}`)}),is("escape",()=>{(v.value||Ae.value)&&(f(),Ae.value=!1)});const N=bs.query.articleId;if(N)try{const H=await $fetch(`${Pe.public.apiBase}/api/v1/articles/${N}`);r(H.content,H.title),vt.value=Number(N),console.log("✅ 从历史记录加载文章:",H.title),await Be();try{const X=await $fetch(`${Pe.public.apiBase}/api/v1/articles/${N}/analysis-report`);Lt.value=X.report_data,await Tt(X.report_data),console.log("✨ 火花已渲染（历史文章）")}catch{console.log("ℹ️ 该文章暂无分析报告")}}catch(H){console.error("❌ 加载历史文章失败:",H)}}),(N,H)=>{const X=As,ae=Si,pe=Gi,ze=Du,je=nf,bt=Yf,De=np,ys=sp,xs=_p,ws=Pp,_s=Up,ks=Kp,Cs=ig,$s=mg;return _(),C("div",xg,[H[10]||(H[10]=n("div",{class:"fixed inset-0 overflow-hidden pointer-events-none z-0"},[n("div",{class:"absolute -top-40 -right-40 w-80 h-80 bg-emerald-400/10 rounded-full blur-3xl"}),n("div",{class:"absolute -bottom-40 -left-40 w-80 h-80 bg-slate-400/10 rounded-full blur-3xl"}),n("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-zinc-400/5 rounded-full blur-3xl"})],-1)),n("div",wg,[O(X,{onOpenSettings:H[0]||(H[0]=lt=>un.value=!0)}),g(s)?(_(),j(De,{key:1,ref_key:"readerLayoutRef",ref:fe},{left:T(()=>[O(pe,{content:g(t),title:g(o)},null,8,["content","title"]),g(s)?(_(),j(ze,{key:0,"article-content":g(t)},null,8,["article-content"])):L("",!0)]),right:T(()=>[n("div",_g,[n("div",kg,[n("button",{onClick:H[1]||(H[1]=lt=>He.value="insight"),class:D(["flex-1 px-4 py-3 text-sm font-medium transition-all",[g(He)==="insight"?"text-emerald-700 border-b-2 border-emerald-600 bg-emerald-50/50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"]])},[...H[7]||(H[7]=[n("span",{class:"flex items-center justify-center gap-2"},[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})]),n("span",null,"AI 洞察")],-1)])],2),n("button",{onClick:H[2]||(H[2]=lt=>He.value="stash"),class:D(["flex-1 px-4 py-3 text-sm font-medium transition-all relative",[g(He)==="stash"?"text-amber-700 border-b-2 border-amber-600 bg-amber-50/50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"]])},[n("span",Cg,[H[8]||(H[8]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})],-1)),H[9]||(H[9]=n("span",null,"暂存",-1)),g(jn)>0?(_(),C("span",$g,E(g(jn)),1)):L("",!0)])],2)])]),n("div",Sg,[xe(O(je,{insight:g(ts),reasoning:g(ns),"is-loading":g(os),error:g(ss),"current-request":g(mt),"use-reasoning":g(rs)},null,8,["insight","reasoning","is-loading","error","current-request","use-reasoning"]),[[qt,g(He)==="insight"]]),xe(O(bt,{onViewItem:gs},null,512),[[qt,g(He)==="stash"]])])]),_:1},512)):(_(),j(ae,{key:0,onSubmit:ds,onArticleClick:cs})),O(ys,{show:g(Ae),position:g(i),onClick:as,onClose:ls},null,8,["show","position"]),O(xs,{show:g(v),position:g(i),"selected-text":g(a),onSelect:us,onClose:g(f)},null,8,["show","position","selected-text","onClose"]),O(ws,{"is-open":g(J),onClose:H[3]||(H[3]=lt=>J.value=!1),onSelect:fs},null,8,["is-open"]),g(s)?(_(),j(_s,{key:2,"is-insight-panel-expanded":g(re),"insight-count":g(m).length,"is-replay-mode":g(S),"history-count":g(G).length,"is-meta-view-active":g(F),"is-meta-analyzing":g(Q),onToggleInsightPanel:ht,onToggleReplay:ms,onOpenHistory:H[4]||(H[4]=lt=>J.value=!0),onToggleMetaView:hs},null,8,["is-insight-panel-expanded","insight-count","is-replay-mode","history-count","is-meta-view-active","is-meta-analyzing"])):L("",!0),g(s)?(_(),j(ks,{key:3,"is-active":g(q),annotations:g(Z)},null,8,["is-active","annotations"])):L("",!0),O(Cs,{"selected-item":g(b),onClose:H[5]||(H[5]=lt=>g(I)(null)),onContinueChat:ps},null,8,["selected-item"]),O($s,{"is-open":g(un),"user-id":g(Ze)?.id||0,onClose:H[6]||(H[6]=lt=>un.value=!1),onPreferencesUpdated:vs},null,8,["is-open","user-id"])])])}}});export{Og as default};
